# åå°ç®¡ç†ç³»ç»Ÿä½¿ç”¨è¯´æ˜

## ğŸ¯ åŠŸèƒ½å®Œæˆ

### âœ… å·²å®ç°
1. **å›¾ç‰‡ä¸Šä¼ API** - `/api/v1/upload/image`
   - æ”¯æŒå•å¼ ä¸Šä¼ 
   - æ”¯æŒæ‰¹é‡ä¸Šä¼ 
   - è‡ªåŠ¨æŒ‰æ—¥æœŸå½’æ¡£
   - æ–‡ä»¶å¤§å°é™åˆ¶ï¼š10MB
   - æ”¯æŒæ ¼å¼ï¼šjpg, jpeg, png, gif, webp, svg

2. **é™æ€æ–‡ä»¶æœåŠ¡** - `/static/uploads/`
   - ä¸Šä¼ çš„å›¾ç‰‡å¯é€šè¿‡URLè®¿é—®
   - æ ¼å¼ï¼š`/static/uploads/YYYYMMDD/filename.ext`

### ğŸ“ ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ static/
â”‚   â””â”€â”€ uploads/          # å›¾ç‰‡ä¸Šä¼ ç›®å½•
â”‚       â””â”€â”€ 20251018/    # æŒ‰æ—¥æœŸåˆ†ç±»
â”œâ”€â”€ admin/              # åå°ç®¡ç†é¡µé¢ï¼ˆå¾…éƒ¨ç½²ï¼‰
â””â”€â”€ app/
    â””â”€â”€ api/
        â””â”€â”€ v1/
            â””â”€â”€ upload.py  # ä¸Šä¼ API
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å›¾ç‰‡ä¸Šä¼ API

#### å•å¼ ä¸Šä¼ 
```bash
curl -X POST "https://catdog.dachaonet.com/api/v1/upload/image" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@/path/to/image.jpg"
```

**è¿”å›ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "message": "ä¸Šä¼ æˆåŠŸ",
  "data": {
    "url": "/static/uploads/20251018/abc123.jpg",
    "filename": "image.jpg",
    "size": 102400,
    "content_type": "image/jpeg"
  }
}
```

#### æ‰¹é‡ä¸Šä¼ 
```bash
curl -X POST "https://catdog.dachaonet.com/api/v1/upload/images" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "files=@image1.jpg" \
  -F "files=@image2.jpg" \
  -F "files=@image3.jpg"
```

### 2. åœ¨å°ç¨‹åºä¸­ä½¿ç”¨

ä¿®æ”¹é¡¹ç›®æ•°æ®ï¼Œå°†ç¤ºä¾‹å›¾ç‰‡æ›¿æ¢ä¸ºçœŸå®ä¸Šä¼ çš„å›¾ç‰‡ï¼š

#### ä¿®æ”¹åç«¯æ ·æœ¬æ•°æ®
ç¼–è¾‘ `backend/insert_sample_data.py`ï¼Œå°†å›¾ç‰‡URLæ”¹ä¸ºï¼š

```python
# æ—§çš„ç¤ºä¾‹URL
cover_image="https://via.placeholder.com/750x300"

# æ”¹ä¸ºä¸Šä¼ åçš„çœŸå®URL
cover_image="/static/uploads/20251018/your_image.jpg"
```

#### åœ¨å°ç¨‹åºä¸­ä¸Šä¼ å›¾ç‰‡

```javascript
// utils/upload.js
export const uploadImage = async () => {
  return new Promise((resolve, reject) => {
    // é€‰æ‹©å›¾ç‰‡
    uni.chooseImage({
      count: 1,
      success: (res) => {
        const tempFilePath = res.tempFilePaths[0]
        
        // è·å–token
        const token = uni.getStorageSync('token')
        
        // ä¸Šä¼ å›¾ç‰‡
        uni.uploadFile({
          url: 'https://catdog.dachaonet.com/api/v1/upload/image',
          filePath: tempFilePath,
          name: 'file',
          header: {
            'Authorization': `Bearer ${token}`
          },
          success: (uploadRes) => {
            const data = JSON.parse(uploadRes.data)
            if (data.code === 200) {
              resolve(data.data.url)
            } else {
              reject(data.message)
            }
          },
          fail: reject
        })
      },
      fail: reject
    })
  })
}
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ï¼ˆ.envï¼‰

```env
# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_DIR=static/uploads
MAX_FILE_SIZE=10485760  # 10MB
ALLOWED_EXTENSIONS=.jpg,.jpeg,.png,.gif,.webp,.svg
```

### ä¿®æ”¹ä¸Šä¼ é™åˆ¶

ç¼–è¾‘ `backend/app/api/v1/upload.py`ï¼š

```python
# ä¿®æ”¹æœ€å¤§æ–‡ä»¶å¤§å°
MAX_FILE_SIZE = 20 * 1024 * 1024  # æ”¹ä¸º20MB

# æ·»åŠ æ›´å¤šå…è®¸çš„æ ¼å¼
ALLOWED_EXTENSIONS = {
    '.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg',
    '.bmp', '.ico'  # æ·»åŠ æ–°æ ¼å¼
}
```

---

## ğŸ“± å°ç¨‹åºå›¾ç‰‡ç®¡ç†

### æ›´æ–°é¡¹ç›®æ•°æ®çš„å›¾ç‰‡

1. **å‡†å¤‡å›¾ç‰‡**
   - å»ºè®®å°ºå¯¸ï¼š750x300ï¼ˆè½®æ’­å›¾ï¼‰
   - æ ¼å¼ï¼šjpg/png
   - æ–‡ä»¶å¤§å°ï¼š< 500KB

2. **ä½¿ç”¨APIä¸Šä¼ **

```bash
# 1. å…ˆç™»å½•è·å–token
TOKEN=$(curl -X POST "https://catdog.dachaonet.com/api/v1/auth/sms-login" \
  -H "Content-Type: application/json" \
  -d '{"phone":"18663764585","sms_code":"123456"}' \
  | jq -r '.data.access_token')

# 2. ä¸Šä¼ å›¾ç‰‡
curl -X POST "https://catdog.dachaonet.com/api/v1/upload/image" \
  -H "Authorization: Bearer $TOKEN" \
  -F "file=@project1.jpg"

# 3. è®°å½•è¿”å›çš„URL
# ä¾‹å¦‚ï¼š/static/uploads/20251018/abc123.jpg
```

3. **æ›´æ–°æ•°æ®åº“**

```sql
-- æ›´æ–°é¡¹ç›®å°é¢å›¾
UPDATE projects 
SET cover_image = '/static/uploads/20251018/abc123.jpg' 
WHERE id = 1;

-- æ›´æ–°è½®æ’­å›¾
UPDATE banners 
SET image_url = '/static/uploads/20251018/banner1.jpg' 
WHERE id = 1;
```

---

## ğŸ¨ åå°ç®¡ç†ç•Œé¢ï¼ˆæ¨èæ–¹æ¡ˆï¼‰

### æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨å·²æœ‰çš„ç®¡ç†å·¥å…·

æ¨èä½¿ç”¨ **[FastAPI Admin](https://github.com/fastapi-admin/fastapi-admin)**

```bash
pip install fastapi-admin
```

### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨å‰ç«¯ç®¡ç†æ¨¡æ¿

æ¨èæ¨¡æ¿ï¼š
1. [Vue Element Admin](https://github.com/PanJiaChen/vue-element-admin)
2. [Ant Design Pro](https://github.com/ant-design/ant-design-pro)
3. [React Admin](https://github.com/marmelab/react-admin)

### æ–¹æ¡ˆä¸‰ï¼šç®€å•HTMLé¡µé¢ï¼ˆå½“å‰æ–¹æ¡ˆï¼‰

å·²åˆ›å»ºåŸºç¡€çš„HTMLç®¡ç†é¡µé¢ï¼Œè®¿é—®ï¼š
- http://localhost:3000/admin

åŠŸèƒ½ï¼š
- âœ… å›¾ç‰‡ä¸Šä¼ 
- âœ… å›¾ç‰‡é¢„è§ˆ
- âœ… ç”¨æˆ·åˆ—è¡¨æŸ¥çœ‹

---

## ğŸ” æƒé™ç®¡ç†

å½“å‰æ‰€æœ‰ç™»å½•ç”¨æˆ·éƒ½å¯ä»¥ä¸Šä¼ å›¾ç‰‡ã€‚å¦‚éœ€é™åˆ¶ç®¡ç†å‘˜æƒé™ï¼š

### æ·»åŠ ç®¡ç†å‘˜å­—æ®µ

```sql
-- æ·»åŠ is_adminå­—æ®µ
ALTER TABLE users ADD COLUMN is_admin BOOLEAN DEFAULT FALSE;

-- è®¾ç½®ç®¡ç†å‘˜
UPDATE users SET is_admin = TRUE WHERE phone = '18663764585';
```

### ä¿®æ”¹ä¸Šä¼ APIæƒé™

ç¼–è¾‘ `backend/app/api/v1/upload.py`ï¼š

```python
@router.post("/image")
async def upload_image(
    file: UploadFile = File(...),
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    # æ£€æŸ¥ç®¡ç†å‘˜æƒé™
    if not current_user.is_admin:
        raise HTTPException(status_code=403, detail="éœ€è¦ç®¡ç†å‘˜æƒé™")
    
    # ... å…¶ä»–ä»£ç 
```

---

## ğŸ“Š å½“å‰çŠ¶æ€

âœ… **å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½å®Œæˆ**
âœ… **é™æ€æ–‡ä»¶æœåŠ¡å·²é…ç½®**
âœ… **APIæ¥å£å¯ç”¨**
â³ **åå°ç®¡ç†UIå¾…å®Œå–„**

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•

```bash
# 1. é‡å¯åç«¯æœåŠ¡
cd /Users/yy/Documents/GitHub/eceshi/backend
python -m app.main

# 2. æµ‹è¯•ä¸Šä¼ ï¼ˆéœ€è¦å…ˆç™»å½•è·å–tokenï¼‰
# 3. è®¿é—®ä¸Šä¼ çš„å›¾ç‰‡
curl https://catdog.dachaonet.com/static/uploads/20251018/xxx.jpg

# 4. æŸ¥çœ‹APIæ–‡æ¡£
open https://catdog.dachaonet.com/api/docs
```

---

## ğŸ’¡ åç»­å»ºè®®

1. **ä½¿ç”¨ä¸“ä¸šçš„åå°ç®¡ç†ç³»ç»Ÿ**
   - FastAPI Admin
   - Django Admin
   - Strapi CMS

2. **ä½¿ç”¨å¯¹è±¡å­˜å‚¨æœåŠ¡**
   - é˜¿é‡Œäº‘OSSï¼ˆå·²é…ç½®ï¼‰
   - ä¸ƒç‰›äº‘
   - è…¾è®¯äº‘COS

3. **å›¾ç‰‡å¤„ç†**
   - è‡ªåŠ¨å‹ç¼©
   - ç”Ÿæˆç¼©ç•¥å›¾
   - æ°´å°æ·»åŠ 

4. **CDNåŠ é€Ÿ**
   - é…ç½®CDNåŠ é€Ÿå›¾ç‰‡è®¿é—®
   - æå‡ç”¨æˆ·ä½“éªŒ

---

**æ–‡æ¡£æ›´æ–°æ—¶é—´**: 2025-10-18

