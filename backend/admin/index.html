<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§‘ç ”æ£€æµ‹æœåŠ¡å¹³å° - åå°ç®¡ç†</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/element-plus"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-plus/dist/index.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB',
                'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .login-box {
            width: 450px;
            padding: 40px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        .admin-layout {
            height: 100vh;
        }
        .admin-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            background: #001529;
            color: white;
            height: 60px;
        }
        .admin-header h2 {
            margin: 0;
            font-size: 18px;
        }
        .admin-container {
            height: calc(100vh - 60px);
        }
        .admin-aside {
            background: #001529;
            color: white;
        }
        .admin-aside .el-menu {
            border-right: none;
            background-color: #001529;
        }
        .admin-main {
            background: #f0f2f5;
            overflow-y: auto;
            padding: 20px;
        }
        .page-header {
            background: white;
            padding: 16px 24px;
            margin-bottom: 16px;
            border-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.03);
        }
        .page-header h3 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
            color: #262626;
        }
        .content-card {
            background: white;
            border-radius: 4px;
            padding: 24px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.03);
            margin-bottom: 16px;
        }
        .image-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        .image-item {
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            overflow: hidden;
            transition: all 0.3s;
        }
        .image-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        .image-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        .image-item-footer {
            padding: 8px;
            background: #f5f5f5;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .stat-card {
            padding: 20px;
            border-radius: 8px;
            color: white;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .stat-icon {
            font-size: 36px;
            opacity: 0.9;
        }
        .stat-info {
            flex: 1;
        }
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            line-height: 1.2;
        }
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 4px;
        }
        .stat-sub {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ç™»å½•é¡µé¢ -->
        <div v-if="!token" class="login-container">
            <div class="login-box">
                <h2 style="text-align: center; margin-bottom: 30px;">ğŸ”¬ åå°ç®¡ç†ç™»å½•</h2>
                
                <el-tabs v-model="loginType">
                    <!-- ç®¡ç†å‘˜ç™»å½• -->
                    <el-tab-pane label="ç®¡ç†å‘˜ç™»å½•" name="admin">
                        <el-form :model="adminLoginForm" @submit.prevent="handleAdminLogin">
                            <el-form-item label="ç”¨æˆ·å">
                                <el-input v-model="adminLoginForm.username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å"></el-input>
                            </el-form-item>
                            <el-form-item label="å¯†ç ">
                                <el-input 
                                    v-model="adminLoginForm.password" 
                                    type="password" 
                                    placeholder="è¯·è¾“å…¥å¯†ç "
                                    show-password
                                    @keyup.enter="handleAdminLogin"></el-input>
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" @click="handleAdminLogin" style="width: 100%;" :loading="loading">
                                    ç™»å½•
                                </el-button>
                            </el-form-item>
                            <el-alert title="é»˜è®¤è´¦å·: admin / 123456" type="info" :closable="false" show-icon />
                        </el-form>
                    </el-tab-pane>
                    
                    <!-- çŸ­ä¿¡ç™»å½• -->
                    <el-tab-pane label="çŸ­ä¿¡ç™»å½•" name="sms">
                        <el-form :model="loginForm" @submit.prevent="handleLogin">
                            <el-form-item label="æ‰‹æœºå·">
                                <el-input v-model="loginForm.phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·"></el-input>
                            </el-form-item>
                            <el-form-item label="éªŒè¯ç ">
                                <el-input v-model="loginForm.sms_code" placeholder="è¯·è¾“å…¥éªŒè¯ç ">
                                    <template #append>
                                        <el-button @click="sendSms" :disabled="countdown > 0">
                                            {{ countdown > 0 ? `${countdown}ç§’åé‡è¯•` : 'è·å–éªŒè¯ç ' }}
                                        </el-button>
                                    </template>
                                </el-input>
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" @click="handleLogin" style="width: 100%;" :loading="loading">
                                    ç™»å½•
                                </el-button>
                            </el-form-item>
                        </el-form>
                    </el-tab-pane>
                </el-tabs>
            </div>
        </div>

        <!-- åå°ç®¡ç†ä¸»ç•Œé¢ -->
        <el-container v-else class="admin-layout">
            <!-- é¡¶éƒ¨ -->
            <el-header class="admin-header" height="60px">
                <div>
                    <h2>ğŸ”¬ ç§‘ç ”æ£€æµ‹æœåŠ¡å¹³å° - åå°ç®¡ç†</h2>
                </div>
                <div>
                    <el-dropdown>
                        <span style="cursor: pointer; color: white;">
                            {{ userInfo.nickname || 'ç®¡ç†å‘˜' }}
                            <el-icon style="margin-left: 5px;"><arrow-down /></el-icon>
                        </span>
                        <template #dropdown>
                            <el-dropdown-menu>
                                <el-dropdown-item @click="logout">
                                    <el-icon><switch-button /></el-icon>
                                    é€€å‡ºç™»å½•
                                </el-dropdown-item>
                            </el-dropdown-menu>
                        </template>
                    </el-dropdown>
                </div>
            </el-header>

            <!-- ä¸»ä½“ -->
            <el-container class="admin-container">
                <!-- å·¦ä¾§èœå• -->
                <el-aside class="admin-aside" width="200px">
                    <el-menu
                        :default-active="activeMenu"
                        background-color="#001529"
                        text-color="#fff"
                        active-text-color="#409EFF"
                        @select="handleMenuSelect">
                        <el-menu-item index="dashboard">
                            <el-icon><data-line /></el-icon>
                            <span>æ•°æ®é¢æ¿</span>
                        </el-menu-item>
                        <el-menu-item index="users">
                            <el-icon><user /></el-icon>
                            <span>ç”¨æˆ·ç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="orders">
                            <el-icon><document /></el-icon>
                            <span>è®¢å•ç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="projects">
                            <el-icon><picture /></el-icon>
                            <span>é¡¹ç›®ç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="categories">
                            <el-icon><folder /></el-icon>
                            <span>åˆ†ç±»ç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="coupons">
                            <el-icon><ticket /></el-icon>
                            <span>ä¼˜æƒ åˆ¸ç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="recharges">
                            <el-icon><wallet /></el-icon>
                            <span>å……å€¼ç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="points">
                            <el-icon><present /></el-icon>
                            <span>ç§¯åˆ†å•†å“</span>
                        </el-menu-item>
                        <el-menu-item index="reviews">
                            <el-icon><chat-line-square /></el-icon>
                            <span>è¯„ä»·ç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="groups">
                            <el-icon><office-building /></el-icon>
                            <span>å›¢ä½“ç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="invites">
                            <el-icon><share /></el-icon>
                            <span>é‚€è¯·ç®¡ç†</span>
                        </el-menu-item>
                        <el-sub-menu index="marketing">
                            <template #title>
                                <el-icon><goods /></el-icon>
                                <span>è¥é”€ç®¡ç†</span>
                            </template>
                            <el-menu-item index="coupons">ä¼˜æƒ åˆ¸ç®¡ç†</el-menu-item>
                            <el-menu-item index="discounts">æŠ˜æ‰£è®¾ç½®</el-menu-item>
                            <el-menu-item index="lottery">æŠ½å¥–æ´»åŠ¨</el-menu-item>
                            <el-menu-item index="qrcode">äºŒç»´ç æ¨å¹¿</el-menu-item>
                        </el-sub-menu>
                        <el-menu-item index="sales">
                            <el-icon><sell /></el-icon>
                            <span>é”€å”®ç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="laboratory">
                            <el-icon><office-building /></el-icon>
                            <span>å®éªŒå®¤ç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="equipment">
                            <el-icon><cpu /></el-icon>
                            <span>ä»ªå™¨ç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="finance">
                            <el-icon><money /></el-icon>
                            <span>è´¢åŠ¡ç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="invoice">
                            <el-icon><document-checked /></el-icon>
                            <span>å‘ç¥¨ç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="customer_service">
                            <el-icon><service /></el-icon>
                            <span>å®¢æœç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="banners">
                            <el-icon><picture-filled /></el-icon>
                            <span>è½®æ’­å›¾ç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="announcements">
                            <el-icon><bell /></el-icon>
                            <span>å…¬å‘Šç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="help">
                            <el-icon><question-filled /></el-icon>
                            <span>å¸®åŠ©ä¸­å¿ƒ</span>
                        </el-menu-item>
                        <el-menu-item index="franchise">
                            <el-icon><connection /></el-icon>
                            <span>åŠ ç›Ÿç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="analytics">
                            <el-icon><trend-charts /></el-icon>
                            <span>æ•°æ®åˆ†æ</span>
                        </el-menu-item>
                        <el-menu-item index="permissions">
                            <el-icon><lock /></el-icon>
                            <span>æƒé™ç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="settings">
                            <el-icon><setting /></el-icon>
                            <span>ç³»ç»Ÿè®¾ç½®</span>
                        </el-menu-item>
                    </el-menu>
                </el-aside>

                <!-- å³ä¾§å†…å®¹ -->
                <el-main class="admin-main">
                    <!-- æ•°æ®é¢æ¿ -->
                    <div v-show="activeMenu === 'dashboard'">
                        <div class="page-header">
                            <h3>ğŸ“Š æ•°æ®é¢æ¿</h3>
                        </div>
                        
                        <!-- ç»Ÿè®¡å¡ç‰‡ -->
                        <el-row :gutter="16" style="margin-bottom: 16px;">
                            <el-col :span="6">
                                <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                    <div class="stat-icon">ğŸ‘¥</div>
                                    <div class="stat-info">
                                        <div class="stat-value">{{ dashboardData.users?.total || 0 }}</div>
                                        <div class="stat-label">æ€»ç”¨æˆ·æ•°</div>
                                        <div class="stat-sub">ä»Šæ—¥æ–°å¢: {{ dashboardData.users?.today || 0 }}</div>
                                    </div>
                                </div>
                            </el-col>
                            <el-col :span="6">
                                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                    <div class="stat-icon">ğŸ“¦</div>
                                    <div class="stat-info">
                                        <div class="stat-value">{{ dashboardData.orders?.total || 0 }}</div>
                                        <div class="stat-label">æ€»è®¢å•æ•°</div>
                                        <div class="stat-sub">å¾…å¤„ç†: {{ dashboardData.orders?.pending || 0 }}</div>
                                    </div>
                                </div>
                            </el-col>
                            <el-col :span="6">
                                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                    <div class="stat-icon">ğŸ’°</div>
                                    <div class="stat-info">
                                        <div class="stat-value">Â¥{{ (dashboardData.revenue?.total || 0).toFixed(2) }}</div>
                                        <div class="stat-label">æ€»æ”¶å…¥</div>
                                        <div class="stat-sub">ä»Šæ—¥: Â¥{{ (dashboardData.revenue?.today || 0).toFixed(2) }}</div>
                                    </div>
                                </div>
                            </el-col>
                            <el-col :span="6">
                                <div class="stat-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                                    <div class="stat-icon">ğŸ”¬</div>
                                    <div class="stat-info">
                                        <div class="stat-value">{{ dashboardData.projects?.total || 0 }}</div>
                                        <div class="stat-label">æ£€æµ‹é¡¹ç›®</div>
                                        <div class="stat-sub">åœ¨æ¶: {{ dashboardData.projects?.active || 0 }}</div>
                                    </div>
                                </div>
                            </el-col>
                        </el-row>

                        <el-row :gutter="16">
                            <el-col :span="16">
                                <div class="content-card">
                                    <h4 style="margin-bottom: 16px;">ğŸ“ˆ è¿‘7å¤©è®¢å•è¶‹åŠ¿</h4>
                                    <div style="display: flex; height: 200px; align-items: flex-end; gap: 12px;">
                                        <div v-for="item in dashboardData.trends?.orders || []" :key="item.date" 
                                            style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                            <div :style="{
                                                width: '100%',
                                                height: Math.max((item.count / maxOrderCount) * 160, 5) + 'px',
                                                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                                                borderRadius: '4px 4px 0 0',
                                                transition: 'height 0.3s'
                                            }"></div>
                                            <div style="font-size: 12px; color: #666; margin-top: 8px;">{{ item.date }}</div>
                                            <div style="font-size: 12px; color: #333; font-weight: 600;">{{ item.count }}</div>
                                        </div>
                                    </div>
                                </div>
                            </el-col>
                            <el-col :span="8">
                                <div class="content-card">
                                    <h4 style="margin-bottom: 16px;">ğŸ“Š è®¢å•çŠ¶æ€åˆ†å¸ƒ</h4>
                                    <div v-for="item in dashboardData.order_status_distribution || []" :key="item.status" 
                                        style="margin-bottom: 12px;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                            <span>{{ getOrderStatusText(item.status) }}</span>
                                            <span style="font-weight: 600;">{{ item.count }}</span>
                                        </div>
                                        <el-progress 
                                            :percentage="totalOrders > 0 ? (item.count / totalOrders * 100) : 0" 
                                            :show-text="false"
                                            :color="getOrderStatusColor(item.status)">
                                        </el-progress>
                                    </div>
                                </div>
                            </el-col>
                        </el-row>

                        <el-row :gutter="16" style="margin-top: 16px;">
                            <el-col :span="12">
                                <div class="content-card">
                                    <h4 style="margin-bottom: 16px;">ğŸ’³ å……å€¼ç»Ÿè®¡</h4>
                                    <el-descriptions :column="1" border size="small">
                                        <el-descriptions-item label="ç´¯è®¡å……å€¼">Â¥{{ (dashboardData.recharge?.total || 0).toFixed(2) }}</el-descriptions-item>
                                        <el-descriptions-item label="å¾…å¤„ç†å……å€¼">{{ dashboardData.recharge?.pending_count || 0 }} ç¬”</el-descriptions-item>
                                    </el-descriptions>
                                </div>
                            </el-col>
                            <el-col :span="12">
                                <div class="content-card">
                                    <h4 style="margin-bottom: 16px;">ğŸ“… æœ¬æœˆæ•°æ®</h4>
                                    <el-descriptions :column="1" border size="small">
                                        <el-descriptions-item label="æ–°å¢ç”¨æˆ·">{{ dashboardData.users?.this_month || 0 }}</el-descriptions-item>
                                        <el-descriptions-item label="æ–°å¢è®¢å•">{{ dashboardData.orders?.this_month || 0 }}</el-descriptions-item>
                                        <el-descriptions-item label="æœ¬æœˆæ”¶å…¥">Â¥{{ (dashboardData.revenue?.this_month || 0).toFixed(2) }}</el-descriptions-item>
                                    </el-descriptions>
                                </div>
                            </el-col>
                        </el-row>
                    </div>

                    <!-- ç”¨æˆ·ç®¡ç† -->
                    <div v-show="activeMenu === 'users'">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>ğŸ‘¥ ç”¨æˆ·ç®¡ç†</h3>
                            <el-button type="success" @click="exportUsers"><el-icon><download /></el-icon> å¯¼å‡ºExcel</el-button>
                        </div>

                        <div class="content-card">
                            <div style="margin-bottom: 20px;">
                                <el-input 
                                    v-model="userSearch" 
                                    placeholder="æœç´¢æ‰‹æœºå·æˆ–æ˜µç§°"
                                    style="width: 300px; margin-right: 10px;"
                                    @change="loadUsers">
                                    <template #prefix>
                                        <el-icon><search /></el-icon>
                                    </template>
                                </el-input>
                                <el-button type="primary" @click="loadUsers">æœç´¢</el-button>
                                <el-button @click="userSearch=''; loadUsers()">é‡ç½®</el-button>
                            </div>

                            <el-table :data="users" style="width: 100%" v-loading="usersLoading">
                                <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                <el-table-column label="å¤´åƒ" width="80">
                                    <template #default="scope">
                                        <el-avatar 
                                            :size="40" 
                                            :src="scope.row.avatar ? baseUrl + scope.row.avatar : undefined">
                                            {{ scope.row.nickname ? scope.row.nickname[0] : '?' }}
                                        </el-avatar>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="nickname" label="æ˜µç§°" width="120"></el-table-column>
                                <el-table-column prop="phone" label="æ‰‹æœºå·" width="130">
                                    <template #default="scope">
                                        {{ scope.row.phone || 'æœªç»‘å®š' }}
                                    </template>
                                </el-table-column>
                                <el-table-column label="ç™»å½•æ–¹å¼" width="100">
                                    <template #default="scope">
                                        <el-tag v-if="scope.row.wechat_openid" type="success" size="small">å¾®ä¿¡</el-tag>
                                        <el-tag v-if="scope.row.phone" type="info" size="small">æ‰‹æœº</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="credit_limit" label="ä¿¡ç”¨é¢åº¦" width="100">
                                    <template #default="scope">
                                        Â¥{{ scope.row.credit_limit }}
                                    </template>
                                </el-table-column>
                                <el-table-column prop="total_spent" label="ç´¯è®¡æ¶ˆè´¹" width="100">
                                    <template #default="scope">
                                        Â¥{{ scope.row.total_spent }}
                                    </template>
                                </el-table-column>
                                <el-table-column prop="total_orders" label="è®¢å•æ•°" width="80"></el-table-column>
                                <el-table-column label="çŠ¶æ€" width="80">
                                    <template #default="scope">
                                        <el-tag 
                                            :type="scope.row.status === 'active' ? 'success' : 'danger'" 
                                            size="small">
                                            {{ getStatusText(scope.row.status) }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="created_at" label="æ³¨å†Œæ—¶é—´" width="170">
                                    <template #default="scope">
                                        {{ formatDate(scope.row.created_at) }}
                                    </template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="200" fixed="right">
                                    <template #default="scope">
                                        <el-button type="primary" size="small" @click="viewUser(scope.row)">
                                            æŸ¥çœ‹
                                        </el-button>
                                        <el-button 
                                            v-if="scope.row.status === 'active'"
                                            type="danger" 
                                            size="small" 
                                            @click="updateUserStatus(scope.row.id, 'banned')">
                                            ç¦ç”¨
                                        </el-button>
                                        <el-button 
                                            v-else
                                            type="success" 
                                            size="small" 
                                            @click="updateUserStatus(scope.row.id, 'active')">
                                            æ¿€æ´»
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <el-pagination
                                v-model:current-page="userPage"
                                v-model:page-size="userPageSize"
                                :page-sizes="[10, 20, 50, 100]"
                                :total="userTotal"
                                layout="total, sizes, prev, pager, next, jumper"
                                @size-change="loadUsers"
                                @current-change="loadUsers"
                                style="margin-top: 20px; justify-content: center;">
                            </el-pagination>

                            <!-- ç”¨æˆ·è¯¦æƒ…å¯¹è¯æ¡† -->
                            <el-dialog v-model="userDialogVisible" title="ç”¨æˆ·è¯¦æƒ…" width="700px">
                                <div v-if="selectedUser" style="display: flex; gap: 20px;">
                                    <!-- å·¦ä¾§å¤´åƒ -->
                                    <div style="flex-shrink: 0; text-align: center;">
                                        <el-avatar 
                                            :size="120" 
                                            :src="selectedUser.avatar ? baseUrl + selectedUser.avatar : undefined"
                                            style="margin-bottom: 12px;">
                                            {{ selectedUser.nickname ? selectedUser.nickname[0] : '?' }}
                                        </el-avatar>
                                        <div>
                                            <el-button size="small" @click="avatarUploadVisible = true; currentEditUserId = selectedUser.id">
                                                ä¿®æ”¹å¤´åƒ
                                            </el-button>
                                        </div>
                                    </div>
                                    
                                    <!-- å³ä¾§è¯¦æƒ… -->
                                    <div style="flex: 1;">
                                        <el-descriptions :column="2" border>
                                            <el-descriptions-item label="ç”¨æˆ·ID">{{ selectedUser.id }}</el-descriptions-item>
                                            <el-descriptions-item label="æ˜µç§°">{{ selectedUser.nickname }}</el-descriptions-item>
                                            <el-descriptions-item label="æ‰‹æœºå·">{{ selectedUser.phone || 'æœªç»‘å®š' }}</el-descriptions-item>
                                            <el-descriptions-item label="é‚®ç®±">{{ selectedUser.email || 'æœªå¡«å†™' }}</el-descriptions-item>
                                            <el-descriptions-item label="å¾®ä¿¡OpenID" :span="2">
                                                {{ selectedUser.wechat_openid || 'æœªç»‘å®š' }}
                                            </el-descriptions-item>
                                            <el-descriptions-item label="å®åè®¤è¯">
                                                <el-tag :type="selectedUser.is_certified ? 'success' : 'info'" size="small">
                                                    {{ selectedUser.is_certified ? 'å·²è®¤è¯' : 'æœªè®¤è¯' }}
                                                </el-tag>
                                            </el-descriptions-item>
                                            <el-descriptions-item label="ä¼šå‘˜ç­‰çº§">
                                                {{ getMemberLevelText(selectedUser.membership_level) }}
                                            </el-descriptions-item>
                                            <el-descriptions-item label="ä¿¡ç”¨é¢åº¦">Â¥{{ selectedUser.credit_limit }}</el-descriptions-item>
                                            <el-descriptions-item label="å·²ç”¨é¢åº¦">Â¥{{ selectedUser.used_credit }}</el-descriptions-item>
                                            <el-descriptions-item label="é¢„ä»˜ä½™é¢">Â¥{{ selectedUser.prepaid_balance }}</el-descriptions-item>
                                            <el-descriptions-item label="ç§¯åˆ†ä½™é¢">{{ selectedUser.points_balance }}</el-descriptions-item>
                                            <el-descriptions-item label="ç´¯è®¡æ¶ˆè´¹">Â¥{{ selectedUser.total_spent }}</el-descriptions-item>
                                            <el-descriptions-item label="è®¢å•æ€»æ•°">{{ selectedUser.total_orders }}</el-descriptions-item>
                                            <el-descriptions-item label="è´¦æˆ·çŠ¶æ€">
                                                <el-tag :type="selectedUser.status === 'active' ? 'success' : 'danger'" size="small">
                                                    {{ getStatusText(selectedUser.status) }}
                                                </el-tag>
                                            </el-descriptions-item>
                                            <el-descriptions-item label="æ³¨å†Œæ—¶é—´">{{ formatDate(selectedUser.created_at) }}</el-descriptions-item>
                                            <el-descriptions-item label="æœ€åç™»å½•">{{ formatDate(selectedUser.last_login_at) }}</el-descriptions-item>
                                        </el-descriptions>
                                    </div>
                                </div>
                            </el-dialog>

                            <!-- ä¿®æ”¹å¤´åƒå¯¹è¯æ¡† -->
                            <el-dialog v-model="avatarUploadVisible" title="ä¿®æ”¹ç”¨æˆ·å¤´åƒ" width="400px">
                                <el-upload
                                    drag
                                    :action="uploadUrl"
                                    :headers="uploadHeaders"
                                    :on-success="handleAvatarUploadSuccess"
                                    :before-upload="beforeUpload"
                                    accept="image/*">
                                    <el-icon class="el-icon--upload"><upload-filled /></el-icon>
                                    <div class="el-upload__text">
                                        å°†å¤´åƒæ‹–åˆ°æ­¤å¤„ï¼Œæˆ–<em>ç‚¹å‡»ä¸Šä¼ </em>
                                    </div>
                                    <template #tip>
                                        <div class="el-upload__tip">
                                            å»ºè®®å°ºå¯¸ 200x200pxï¼Œæ”¯æŒ jpg/png æ ¼å¼
                                        </div>
                                    </template>
                                </el-upload>
                            </el-dialog>
                        </div>
                    </div>

                    <!-- é¡¹ç›®ç®¡ç† -->
                    <div v-show="activeMenu === 'projects'">
                        <div class="page-header">
                            <h3>ğŸ“¸ é¡¹ç›®ç®¡ç†</h3>
                        </div>
                        
                        <div class="content-card">
                            <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <el-input 
                                        v-model="projectSearch" 
                                        placeholder="æœç´¢é¡¹ç›®åç§°æˆ–ç¼–å·"
                                        style="width: 300px; margin-right: 10px;"
                                        @change="loadProjects">
                                        <template #prefix>
                                            <el-icon><search /></el-icon>
                                        </template>
                                    </el-input>
                                    <el-select v-model="projectCategoryFilter" placeholder="é€‰æ‹©åˆ†ç±»" style="width: 150px; margin-right: 10px;" @change="loadProjects" clearable>
                                        <el-option v-for="cat in categories" :key="cat.id" :label="cat.name" :value="cat.id"></el-option>
                                    </el-select>
                                    <el-button type="primary" @click="loadProjects">æœç´¢</el-button>
                                    <el-button @click="projectSearch=''; projectCategoryFilter=null; loadProjects()">é‡ç½®</el-button>
                                </div>
                                <el-button type="primary" @click="showProjectDialog()">
                                    <el-icon><plus /></el-icon> æ·»åŠ é¡¹ç›®
                                </el-button>
                            </div>

                            <el-table :data="projects" style="width: 100%" v-loading="projectsLoading">
                                <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                <el-table-column label="å°é¢" width="80">
                                    <template #default="scope">
                                        <el-image 
                                            v-if="scope.row.cover_image"
                                            :src="scope.row.cover_image" 
                                            style="width: 60px; height: 60px; border-radius: 4px;"
                                            fit="cover"
                                            :preview-src-list="[scope.row.cover_image]">
                                        </el-image>
                                        <span v-else style="color: #ccc;">æ— </span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="project_no" label="ç¼–å·" width="100"></el-table-column>
                                <el-table-column prop="name" label="é¡¹ç›®åç§°" width="200" show-overflow-tooltip></el-table-column>
                                <el-table-column prop="category_name" label="åˆ†ç±»" width="120"></el-table-column>
                                <el-table-column label="ä»·æ ¼" width="120">
                                    <template #default="scope">
                                        <div>Â¥{{ scope.row.current_price }}</div>
                                        <div style="font-size: 12px; color: #999; text-decoration: line-through;">Â¥{{ scope.row.original_price }}</div>
                                    </template>
                                </el-table-column>
                                <el-table-column label="æ ‡ç­¾" width="120">
                                    <template #default="scope">
                                        <el-tag v-if="scope.row.is_hot" type="danger" size="small" style="margin-right: 5px;">çƒ­é—¨</el-tag>
                                        <el-tag v-if="scope.row.is_recommended" type="warning" size="small">æ¨è</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="ç»Ÿè®¡" width="100">
                                    <template #default="scope">
                                        <div style="font-size: 12px;">æµè§ˆ: {{ scope.row.view_count }}</div>
                                        <div style="font-size: 12px;">é¢„çº¦: {{ scope.row.booking_count }}</div>
                                    </template>
                                </el-table-column>
                                <el-table-column label="çŠ¶æ€" width="80">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.status === 'active' ? 'success' : 'info'" size="small">
                                            {{ scope.row.status === 'active' ? 'ä¸Šæ¶' : 'ä¸‹æ¶' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="240" fixed="right">
                                    <template #default="scope">
                                        <el-button type="primary" size="small" @click="showProjectDialog(scope.row)">ç¼–è¾‘</el-button>
                                        <el-button 
                                            v-if="scope.row.status === 'active'"
                                            type="warning" 
                                            size="small" 
                                            @click="updateProjectStatus(scope.row.id, 'inactive')">
                                            ä¸‹æ¶
                                        </el-button>
                                        <el-button 
                                            v-else
                                            type="success" 
                                            size="small" 
                                            @click="updateProjectStatus(scope.row.id, 'active')">
                                            ä¸Šæ¶
                                        </el-button>
                                        <el-button type="danger" size="small" @click="deleteProject(scope.row.id)">åˆ é™¤</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <el-pagination
                                v-model:current-page="projectPage"
                                v-model:page-size="projectPageSize"
                                :page-sizes="[10, 20, 50]"
                                :total="projectTotal"
                                layout="total, sizes, prev, pager, next, jumper"
                                @size-change="loadProjects"
                                @current-change="loadProjects"
                                style="margin-top: 20px; justify-content: center;">
                            </el-pagination>

                            <!-- æ·»åŠ /ç¼–è¾‘é¡¹ç›®å¯¹è¯æ¡† -->
                            <el-dialog 
                                v-model="projectDialogVisible" 
                                :title="projectForm.id ? 'ç¼–è¾‘é¡¹ç›®' : 'æ·»åŠ é¡¹ç›®'" 
                                width="600px">
                                <el-form :model="projectForm" label-width="120px">
                                    <el-form-item label="é¡¹ç›®ç¼–å·" required>
                                        <el-input v-model="projectForm.project_no" placeholder="å¦‚: PRJ001" :disabled="!!projectForm.id"></el-input>
                                    </el-form-item>
                                    <el-form-item label="é¡¹ç›®åç§°" required>
                                        <el-input v-model="projectForm.name" placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°"></el-input>
                                    </el-form-item>
                                    <el-form-item label="åˆ†ç±»" required>
                                        <el-select v-model="projectForm.category_id" placeholder="è¯·é€‰æ‹©åˆ†ç±»" style="width: 100%;">
                                            <el-option v-for="cat in categories" :key="cat.id" :label="cat.name" :value="cat.id"></el-option>
                                        </el-select>
                                    </el-form-item>
                                    <el-form-item label="åŸä»·" required>
                                        <el-input-number v-model="projectForm.original_price" :min="0" :precision="2" style="width: 100%;"></el-input-number>
                                    </el-form-item>
                                    <el-form-item label="ç°ä»·" required>
                                        <el-input-number v-model="projectForm.current_price" :min="0" :precision="2" style="width: 100%;"></el-input-number>
                                    </el-form-item>
                                    <el-form-item label="å•ä½">
                                        <el-input v-model="projectForm.unit" placeholder="å¦‚: æ ·å“ã€æ¬¡"></el-input>
                                    </el-form-item>
                                    <el-form-item label="æœåŠ¡å‘¨æœŸ">
                                        <div style="display: flex; gap: 10px; align-items: center;">
                                            <el-input-number v-model="projectForm.service_cycle_min" :min="1" placeholder="æœ€çŸ­"></el-input-number>
                                            <span>~</span>
                                            <el-input-number v-model="projectForm.service_cycle_max" :min="1" placeholder="æœ€é•¿"></el-input-number>
                                            <span>å·¥ä½œæ—¥</span>
                                        </div>
                                    </el-form-item>
                                    <el-form-item label="ä»ªå™¨åç§°">
                                        <el-input v-model="projectForm.equipment_name" placeholder="è¯·è¾“å…¥ä»ªå™¨åç§°"></el-input>
                                    </el-form-item>
                                    <el-form-item label="é¡¹ç›®ä»‹ç»">
                                        <el-input v-model="projectForm.introduction" type="textarea" :rows="3" placeholder="è¯·è¾“å…¥é¡¹ç›®ä»‹ç»"></el-input>
                                    </el-form-item>
                                    <el-form-item label="æ ·å“è¦æ±‚">
                                        <el-input v-model="projectForm.sample_requirements" type="textarea" :rows="3" placeholder="è¯·è¾“å…¥æ ·å“è¦æ±‚"></el-input>
                                    </el-form-item>
                                    <el-form-item label="å°é¢å›¾">
                                        <div>
                                            <el-input v-model="projectForm.cover_image" placeholder="å›¾ç‰‡URL" style="margin-bottom: 10px;"></el-input>
                                            <el-upload
                                                :action="uploadUrl"
                                                :headers="uploadHeaders"
                                                :on-success="handleProjectImageUpload"
                                                :show-file-list="false"
                                                accept="image/*">
                                                <el-button size="small" type="primary">ä¸Šä¼ å°é¢å›¾</el-button>
                                            </el-upload>
                                            <el-image 
                                                v-if="projectForm.cover_image"
                                                :src="projectForm.cover_image" 
                                                style="width: 100px; height: 100px; margin-top: 10px;"
                                                fit="cover">
                                            </el-image>
                                        </div>
                                    </el-form-item>
                                    <el-form-item label="æ ‡ç­¾">
                                        <el-checkbox v-model="projectForm.is_hot">çƒ­é—¨</el-checkbox>
                                        <el-checkbox v-model="projectForm.is_recommended">æ¨è</el-checkbox>
                                    </el-form-item>
                                    <el-form-item label="æ’åº">
                                        <el-input-number v-model="projectForm.sort_order" :min="0"></el-input-number>
                                    </el-form-item>
                                </el-form>
                                <template #footer>
                                    <el-button @click="projectDialogVisible = false">å–æ¶ˆ</el-button>
                                    <el-button type="primary" @click="saveProject" :loading="loading">ä¿å­˜</el-button>
                                </template>
                            </el-dialog>
                        </div>
                    </div>

                    <!-- è®¢å•ç®¡ç† -->
                    <div v-show="activeMenu === 'orders'">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>ğŸ“¦ è®¢å•ç®¡ç†</h3>
                            <div>
                                <el-button type="success" @click="exportOrders"><el-icon><download /></el-icon> å¯¼å‡ºExcel</el-button>
                                <el-button type="info" @click="printOrders"><el-icon><printer /></el-icon> æ‰“å°</el-button>
                            </div>
                        </div>
                        <div class="content-card">
                            <div style="margin-bottom: 16px; display: flex; justify-content: space-between;">
                                <div style="display: flex; gap: 10px;">
                                    <el-input
                                        v-model="orderSearch"
                                        placeholder="æœç´¢è®¢å•å·/ç”¨æˆ·æ‰‹æœºå·"
                                        style="width: 300px;"
                                        clearable
                                        @change="loadOrders">
                                        <template #prefix>
                                            <el-icon><search /></el-icon>
                                        </template>
                                    </el-input>
                                    <el-select v-model="orderStatusFilter" placeholder="è®¢å•çŠ¶æ€" style="width: 150px;" @change="loadOrders" clearable>
                                        <el-option label="å¾…æ”¯ä»˜" value="unpaid"></el-option>
                                        <el-option label="å·²æ”¯ä»˜" value="paid"></el-option>
                                        <el-option label="å·²ç¡®è®¤" value="confirmed"></el-option>
                                        <el-option label="å®éªŒä¸­" value="testing"></el-option>
                                        <el-option label="å·²å®Œæˆ" value="completed"></el-option>
                                        <el-option label="å·²å–æ¶ˆ" value="cancelled"></el-option>
                                    </el-select>
                                    <el-select v-model="orderAssigneeFilter" placeholder="æŒ‡æ´¾äººå‘˜" style="width: 150px;" @change="loadOrders" clearable>
                                        <el-option v-for="staff in labStaffList" :key="staff.id" :label="staff.name" :value="staff.id"></el-option>
                                    </el-select>
                                    <el-button type="primary" @click="loadOrders">æœç´¢</el-button>
                                    <el-button @click="orderSearch=''; orderStatusFilter=null; orderAssigneeFilter=null; loadOrders()">é‡ç½®</el-button>
                                </div>
                            </div>

                            <el-table :data="orders" style="width: 100%" v-loading="ordersLoading" @selection-change="handleOrderSelectionChange">
                                <el-table-column type="selection" width="50"></el-table-column>
                                <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                <el-table-column prop="order_no" label="è®¢å•å·" width="180"></el-table-column>
                                <el-table-column label="ç”¨æˆ·" width="130">
                                    <template #default="scope">
                                        <div>{{ scope.row.user_nickname }}</div>
                                        <div style="font-size: 12px; color: #999;">{{ scope.row.user_phone }}</div>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="project_name" label="æ£€æµ‹é¡¹ç›®" width="150" show-overflow-tooltip></el-table-column>
                                <el-table-column label="æ ·å“" width="120">
                                    <template #default="scope">
                                        <div>{{ scope.row.sample_name }}</div>
                                        <div style="font-size: 12px; color: #999;">Ã—{{ scope.row.quantity }}</div>
                                    </template>
                                </el-table-column>
                                <el-table-column label="é‡‘é¢" width="100">
                                    <template #default="scope">
                                        <span style="color: #ff4d4f; font-weight: 600;">Â¥{{ scope.row.total_amount }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="æŒ‡æ´¾" width="100">
                                    <template #default="scope">
                                        <span v-if="scope.row.assignee_name" style="color: #409eff;">{{ scope.row.assignee_name }}</span>
                                        <span v-else style="color: #999;">æœªæŒ‡æ´¾</span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="çŠ¶æ€" width="90">
                                    <template #default="scope">
                                        <el-tag :type="getOrderStatusType(scope.row.status)" size="small">
                                            {{ getOrderStatusText(scope.row.status) }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="åˆ›å»ºæ—¶é—´" width="150">
                                    <template #default="scope">
                                        {{ formatDateTime(scope.row.created_at) }}
                                    </template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="220" fixed="right">
                                    <template #default="scope">
                                        <el-button link type="primary" size="small" @click="viewOrderDetail(scope.row)">è¯¦æƒ…</el-button>
                                        <el-button link type="success" size="small" @click="showAssignDialog(scope.row)">æŒ‡æ´¾</el-button>
                                        <el-button link type="warning" size="small" @click="showOrderStatusDialog(scope.row)">æ”¹çŠ¶æ€</el-button>
                                        <el-button link type="info" size="small" @click="printOrderDetail(scope.row)">æ‰“å°</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <div style="margin-top: 16px; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <el-button type="primary" :disabled="selectedOrders.length === 0" @click="batchAssign">
                                        æ‰¹é‡æŒ‡æ´¾ ({{ selectedOrders.length }})
                                    </el-button>
                                </div>
                                <el-pagination
                                    v-model:current-page="orderPage"
                                    v-model:page-size="orderPageSize"
                                    :page-sizes="[10, 20, 50, 100]"
                                    :total="orderTotal"
                                    layout="total, sizes, prev, pager, next, jumper"
                                    @size-change="loadOrders"
                                    @current-change="loadOrders">
                                </el-pagination>
                            </div>
                        </div>
                        <!-- è®¢å•æŒ‡æ´¾å¯¹è¯æ¡† -->
                        <el-dialog v-model="assignDialogVisible" title="è®¢å•æŒ‡æ´¾" width="450px">
                            <el-form :model="assignForm" label-width="100px">
                                <el-form-item label="æŒ‡æ´¾è®¢å•">
                                    <span v-if="assignForm.order_no">{{ assignForm.order_no }}</span>
                                    <span v-else>å·²é€‰æ‹© {{ selectedOrders.length }} ä¸ªè®¢å•</span>
                                </el-form-item>
                                <el-form-item label="æŒ‡æ´¾ç»™" required>
                                    <el-select v-model="assignForm.assignee_id" placeholder="é€‰æ‹©å®éªŒäººå‘˜" style="width: 100%;">
                                        <el-option v-for="staff in labStaffList" :key="staff.id" :label="staff.name + ' (' + staff.department + ')'" :value="staff.id"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="å¤‡æ³¨">
                                    <el-input v-model="assignForm.remark" type="textarea" :rows="2" placeholder="å¯æ·»åŠ æŒ‡æ´¾è¯´æ˜"></el-input>
                                </el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="assignDialogVisible = false">å–æ¶ˆ</el-button>
                                <el-button type="primary" @click="confirmAssign">ç¡®è®¤æŒ‡æ´¾</el-button>
                            </template>
                        </el-dialog>
                    </div>

                    <!-- åˆ†ç±»ç®¡ç† -->
                    <div v-show="activeMenu === 'categories'">
                        <div class="page-header">
                            <h3>ğŸ“‚ åˆ†ç±»ç®¡ç†</h3>
                        </div>
                        <div class="content-card">
                            <div style="margin-bottom: 16px; display: flex; justify-content: space-between;">
                                <div>
                                    <el-input v-model="categorySearch" placeholder="æœç´¢åˆ†ç±»åç§°" style="width: 250px;" clearable @change="loadCategories">
                                        <template #prefix><el-icon><search /></el-icon></template>
                                    </el-input>
                                    <el-button type="primary" @click="loadCategories" style="margin-left: 10px;">æœç´¢</el-button>
                                </div>
                                <el-button type="primary" @click="showCategoryDialog()"><el-icon><plus /></el-icon> æ·»åŠ åˆ†ç±»</el-button>
                            </div>
                            <el-table :data="categoryList" v-loading="categoryLoading">
                                <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                <el-table-column label="å›¾æ ‡" width="80">
                                    <template #default="scope">
                                        <el-image v-if="scope.row.icon" :src="scope.row.icon" style="width: 40px; height: 40px;" fit="cover"></el-image>
                                        <span v-else style="color: #ccc;">-</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="name" label="åç§°" width="150"></el-table-column>
                                <el-table-column prop="code" label="ç¼–ç " width="120"></el-table-column>
                                <el-table-column prop="sort_order" label="æ’åº" width="80"></el-table-column>
                                <el-table-column label="çƒ­é—¨" width="80">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.is_hot ? 'danger' : 'info'" size="small">{{ scope.row.is_hot ? 'æ˜¯' : 'å¦' }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="çŠ¶æ€" width="80">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.is_active ? 'success' : 'info'" size="small">{{ scope.row.is_active ? 'å¯ç”¨' : 'ç¦ç”¨' }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="180">
                                    <template #default="scope">
                                        <el-button link type="primary" size="small" @click="showCategoryDialog(scope.row)">ç¼–è¾‘</el-button>
                                        <el-button link type="danger" size="small" @click="deleteCategory(scope.row.id)">åˆ é™¤</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                            <el-pagination v-model:current-page="categoryPage" v-model:page-size="categoryPageSize" :total="categoryTotal"
                                layout="total, prev, pager, next" @current-change="loadCategories" style="margin-top: 16px; justify-content: center;">
                            </el-pagination>
                        </div>
                        <!-- åˆ†ç±»å¯¹è¯æ¡† -->
                        <el-dialog v-model="categoryDialogVisible" :title="categoryForm.id ? 'ç¼–è¾‘åˆ†ç±»' : 'æ·»åŠ åˆ†ç±»'" width="500px">
                            <el-form :model="categoryForm" label-width="80px">
                                <el-form-item label="åç§°" required><el-input v-model="categoryForm.name"></el-input></el-form-item>
                                <el-form-item label="ç¼–ç "><el-input v-model="categoryForm.code" placeholder="å¦‚: SEM"></el-input></el-form-item>
                                <el-form-item label="å›¾æ ‡"><el-input v-model="categoryForm.icon" placeholder="å›¾æ ‡URL"></el-input></el-form-item>
                                <el-form-item label="æ’åº"><el-input-number v-model="categoryForm.sort_order" :min="0"></el-input-number></el-form-item>
                                <el-form-item label="çƒ­é—¨"><el-switch v-model="categoryForm.is_hot"></el-switch></el-form-item>
                                <el-form-item label="æè¿°"><el-input v-model="categoryForm.description" type="textarea" :rows="2"></el-input></el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="categoryDialogVisible = false">å–æ¶ˆ</el-button>
                                <el-button type="primary" @click="saveCategory" :loading="loading">ä¿å­˜</el-button>
                            </template>
                        </el-dialog>
                    </div>

                    <!-- ä¼˜æƒ åˆ¸ç®¡ç† -->
                    <div v-show="activeMenu === 'coupons'">
                        <div class="page-header">
                            <h3>ğŸ ä¼˜æƒ åˆ¸ç®¡ç†</h3>
                        </div>
                        <div class="content-card">
                            <div style="margin-bottom: 16px; display: flex; justify-content: space-between;">
                                <div>
                                    <el-input v-model="couponSearch" placeholder="æœç´¢ä¼˜æƒ åˆ¸åç§°" style="width: 250px;" clearable @change="loadCoupons">
                                        <template #prefix><el-icon><search /></el-icon></template>
                                    </el-input>
                                    <el-button type="primary" @click="loadCoupons" style="margin-left: 10px;">æœç´¢</el-button>
                                </div>
                                <div>
                                    <el-button type="success" @click="showSendCouponDialog()"><el-icon><promotion /></el-icon> å®šå‘å‘åˆ¸</el-button>
                                    <el-button type="primary" @click="showCouponDialog()"><el-icon><plus /></el-icon> æ·»åŠ ä¼˜æƒ åˆ¸</el-button>
                                </div>
                            </div>
                            <el-table :data="couponList" v-loading="couponLoading">
                                <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                <el-table-column prop="name" label="åç§°" width="150"></el-table-column>
                                <el-table-column label="ç±»å‹" width="100">
                                    <template #default="scope">
                                        <el-tag size="small">{{ getCouponTypeText(scope.row.type) }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="ä¼˜æƒ " width="120">
                                    <template #default="scope">
                                        <span v-if="scope.row.type === 'cash'">Â¥{{ scope.row.cash_amount }}</span>
                                        <span v-else-if="scope.row.type === 'discount'">{{ (scope.row.discount_rate * 10).toFixed(1) }}æŠ˜</span>
                                        <span v-else>æ»¡{{ scope.row.full_amount }}å‡{{ scope.row.reduction_amount }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="å‘æ”¾/é¢†å–" width="100">
                                    <template #default="scope">{{ scope.row.received_quantity }}/{{ scope.row.total_quantity || 'ä¸é™' }}</template>
                                </el-table-column>
                                <el-table-column prop="valid_days" label="æœ‰æ•ˆæœŸ" width="80">
                                    <template #default="scope">{{ scope.row.valid_days }}å¤©</template>
                                </el-table-column>
                                <el-table-column label="çŠ¶æ€" width="80">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.status === 'active' ? 'success' : 'info'" size="small">{{ scope.row.status === 'active' ? 'å¯é¢†' : 'å·²ä¸‹æ¶' }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="200">
                                    <template #default="scope">
                                        <el-button link type="success" size="small" @click="sendCouponToUser(scope.row)">å‘æ”¾</el-button>
                                        <el-button link type="primary" size="small" @click="showCouponDialog(scope.row)">ç¼–è¾‘</el-button>
                                        <el-button link type="danger" size="small" @click="deleteCoupon(scope.row.id)">ä¸‹æ¶</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                            <el-pagination v-model:current-page="couponPage" v-model:page-size="couponPageSize" :total="couponTotal"
                                layout="total, prev, pager, next" @current-change="loadCoupons" style="margin-top: 16px; justify-content: center;">
                            </el-pagination>
                        </div>
                        <!-- å®šå‘å‘åˆ¸å¯¹è¯æ¡† -->
                        <el-dialog v-model="sendCouponDialogVisible" title="å®šå‘å‘æ”¾ä¼˜æƒ åˆ¸" width="600px">
                            <el-form :model="sendCouponForm" label-width="120px">
                                <el-form-item label="é€‰æ‹©ä¼˜æƒ åˆ¸" required>
                                    <el-select v-model="sendCouponForm.coupon_id" placeholder="è¯·é€‰æ‹©ä¼˜æƒ åˆ¸" style="width: 100%;">
                                        <el-option v-for="c in couponList" :key="c.id" :label="c.name + ' (' + getCouponTypeText(c.type) + ')'" :value="c.id"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="å‘æ”¾æ–¹å¼" required>
                                    <el-radio-group v-model="sendCouponForm.send_type">
                                        <el-radio label="phone">æŒ‰æ‰‹æœºå·å‘æ”¾</el-radio>
                                        <el-radio label="group">æŒ‰ç”¨æˆ·åˆ†ç»„å‘æ”¾</el-radio>
                                        <el-radio label="all">å‘æ”¾ç»™æ‰€æœ‰ç”¨æˆ·</el-radio>
                                    </el-radio-group>
                                </el-form-item>
                                <el-form-item label="æ‰‹æœºå·åˆ—è¡¨" v-if="sendCouponForm.send_type === 'phone'">
                                    <el-input v-model="sendCouponForm.phones" type="textarea" :rows="4" placeholder="è¯·è¾“å…¥æ‰‹æœºå·ï¼Œå¤šä¸ªæ‰‹æœºå·ç”¨é€—å·æˆ–æ¢è¡Œåˆ†éš”"></el-input>
                                    <div style="font-size: 12px; color: #999; margin-top: 4px;">æ”¯æŒé€—å·ã€ç©ºæ ¼æˆ–æ¢è¡Œåˆ†éš”</div>
                                </el-form-item>
                                <el-form-item label="ç”¨æˆ·åˆ†ç»„" v-if="sendCouponForm.send_type === 'group'">
                                    <el-select v-model="sendCouponForm.user_group" style="width: 100%;">
                                        <el-option label="æ–°ç”¨æˆ·ï¼ˆæ³¨å†Œ7å¤©å†…ï¼‰" value="new"></el-option>
                                        <el-option label="æ´»è·ƒç”¨æˆ·ï¼ˆ30å¤©å†…æœ‰è®¢å•ï¼‰" value="active"></el-option>
                                        <el-option label="æ²‰ç¡ç”¨æˆ·ï¼ˆ60å¤©æœªä¸‹å•ï¼‰" value="inactive"></el-option>
                                        <el-option label="VIPç”¨æˆ·ï¼ˆæ¶ˆè´¹æ»¡1000å…ƒï¼‰" value="vip"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="å‘æ”¾æ•°é‡">
                                    <el-input-number v-model="sendCouponForm.quantity" :min="1" :max="10"></el-input-number>
                                    <span style="margin-left: 8px;">å¼ /äºº</span>
                                </el-form-item>
                                <el-form-item label="å‘æ”¾è¯´æ˜">
                                    <el-input v-model="sendCouponForm.remark" placeholder="å¦‚ï¼šæ–°å¹´æ´»åŠ¨èµ é€"></el-input>
                                </el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="sendCouponDialogVisible = false">å–æ¶ˆ</el-button>
                                <el-button type="primary" @click="confirmSendCoupon">ç¡®è®¤å‘æ”¾</el-button>
                            </template>
                        </el-dialog>
                        <!-- ä¼˜æƒ åˆ¸å¯¹è¯æ¡† -->
                        <el-dialog v-model="couponDialogVisible" :title="couponForm.id ? 'ç¼–è¾‘ä¼˜æƒ åˆ¸' : 'æ·»åŠ ä¼˜æƒ åˆ¸'" width="550px">
                            <el-form :model="couponForm" label-width="100px">
                                <el-form-item label="åç§°" required><el-input v-model="couponForm.name"></el-input></el-form-item>
                                <el-form-item label="ç±»å‹" required>
                                    <el-select v-model="couponForm.type" style="width: 100%;">
                                        <el-option label="ä»£é‡‘åˆ¸" value="cash"></el-option>
                                        <el-option label="æŠ˜æ‰£åˆ¸" value="discount"></el-option>
                                        <el-option label="æ»¡å‡åˆ¸" value="full_reduction"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="ä»£é‡‘é‡‘é¢" v-if="couponForm.type === 'cash'">
                                    <el-input-number v-model="couponForm.cash_amount" :min="0" :precision="2" style="width: 100%;"></el-input-number>
                                </el-form-item>
                                <el-form-item label="æŠ˜æ‰£ç‡" v-if="couponForm.type === 'discount'">
                                    <el-input-number v-model="couponForm.discount_rate" :min="0.1" :max="0.99" :step="0.1" :precision="2" style="width: 100%;"></el-input-number>
                                    <div style="font-size: 12px; color: #999;">å¦‚0.9è¡¨ç¤º9æŠ˜</div>
                                </el-form-item>
                                <el-form-item label="æ»¡å‡é—¨æ§›" v-if="couponForm.type === 'full_reduction'">
                                    <el-input-number v-model="couponForm.full_amount" :min="0" :precision="2" style="width: 100%;"></el-input-number>
                                </el-form-item>
                                <el-form-item label="å‡å…é‡‘é¢" v-if="couponForm.type === 'full_reduction'">
                                    <el-input-number v-model="couponForm.reduction_amount" :min="0" :precision="2" style="width: 100%;"></el-input-number>
                                </el-form-item>
                                <el-form-item label="æœ€ä½æ¶ˆè´¹"><el-input-number v-model="couponForm.min_order_amount" :min="0" :precision="2" style="width: 100%;"></el-input-number></el-form-item>
                                <el-form-item label="å‘æ”¾æ•°é‡"><el-input-number v-model="couponForm.total_quantity" :min="0" style="width: 100%;"></el-input-number><div style="font-size: 12px; color: #999;">0è¡¨ç¤ºä¸é™é‡</div></el-form-item>
                                <el-form-item label="æœ‰æ•ˆå¤©æ•°"><el-input-number v-model="couponForm.valid_days" :min="1" style="width: 100%;"></el-input-number></el-form-item>
                                <el-form-item label="æè¿°"><el-input v-model="couponForm.description" type="textarea" :rows="2"></el-input></el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="couponDialogVisible = false">å–æ¶ˆ</el-button>
                                <el-button type="primary" @click="saveCoupon" :loading="loading">ä¿å­˜</el-button>
                            </template>
                        </el-dialog>
                    </div>

                    <!-- å……å€¼ç®¡ç† -->
                    <div v-show="activeMenu === 'recharges'">
                        <div class="page-header">
                            <h3>ğŸ’° å……å€¼ç®¡ç†</h3>
                        </div>
                        <div class="content-card">
                            <div style="margin-bottom: 16px; display: flex; gap: 10px;">
                                <el-input v-model="rechargeSearch" placeholder="æœç´¢å……å€¼å•å·/æ‰‹æœºå·" style="width: 250px;" clearable @change="loadRecharges">
                                    <template #prefix><el-icon><search /></el-icon></template>
                                </el-input>
                                <el-select v-model="rechargeStatusFilter" placeholder="çŠ¶æ€ç­›é€‰" style="width: 120px;" clearable @change="loadRecharges">
                                    <el-option label="å¾…æ”¯ä»˜" value="pending"></el-option>
                                    <el-option label="æˆåŠŸ" value="success"></el-option>
                                    <el-option label="å¤±è´¥" value="failed"></el-option>
                                    <el-option label="å·²é€€æ¬¾" value="refunded"></el-option>
                                </el-select>
                                <el-button type="primary" @click="loadRecharges">æœç´¢</el-button>
                                <el-button @click="rechargeSearch=''; rechargeStatusFilter=null; loadRecharges()">é‡ç½®</el-button>
                            </div>
                            <el-table :data="rechargeList" v-loading="rechargeLoading">
                                <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                <el-table-column prop="recharge_no" label="å……å€¼å•å·" width="180"></el-table-column>
                                <el-table-column label="ç”¨æˆ·" width="150">
                                    <template #default="scope">
                                        <div>{{ scope.row.user_nickname }}</div>
                                        <div style="font-size: 12px; color: #999;">{{ scope.row.user_phone }}</div>
                                    </template>
                                </el-table-column>
                                <el-table-column label="å……å€¼é‡‘é¢" width="100">
                                    <template #default="scope"><span style="color: #ff4d4f; font-weight: 600;">Â¥{{ scope.row.amount }}</span></template>
                                </el-table-column>
                                <el-table-column label="å®é™…åˆ°è´¦" width="100">
                                    <template #default="scope"><span style="color: #52c41a;">Â¥{{ scope.row.actual_amount }}</span></template>
                                </el-table-column>
                                <el-table-column label="èµ é€" width="80">
                                    <template #default="scope">Â¥{{ scope.row.bonus_amount || 0 }}</template>
                                </el-table-column>
                                <el-table-column label="æ–¹å¼" width="80">
                                    <template #default="scope">
                                        <el-tag size="small" :type="scope.row.payment_method === 'wechat' ? 'success' : 'primary'">{{ scope.row.payment_method === 'wechat' ? 'å¾®ä¿¡' : 'æ”¯ä»˜å®' }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="çŠ¶æ€" width="80">
                                    <template #default="scope">
                                        <el-tag :type="getRechargeStatusType(scope.row.status)" size="small">{{ getRechargeStatusText(scope.row.status) }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="æ—¶é—´" width="160">
                                    <template #default="scope">{{ formatDateTime(scope.row.created_at) }}</template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="120">
                                    <template #default="scope">
                                        <el-button v-if="scope.row.status === 'pending'" link type="success" size="small" @click="updateRechargeStatus(scope.row.id, 'success')">ç¡®è®¤</el-button>
                                        <el-button v-if="scope.row.status === 'pending'" link type="danger" size="small" @click="updateRechargeStatus(scope.row.id, 'failed')">å¤±è´¥</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                            <el-pagination v-model:current-page="rechargePage" v-model:page-size="rechargePageSize" :total="rechargeTotal"
                                layout="total, prev, pager, next" @current-change="loadRecharges" style="margin-top: 16px; justify-content: center;">
                            </el-pagination>
                        </div>
                    </div>

                    <!-- ç§¯åˆ†å•†å“ç®¡ç† -->
                    <div v-show="activeMenu === 'points'">
                        <div class="page-header">
                            <h3>ğŸ¯ ç§¯åˆ†å•†å“ç®¡ç†</h3>
                        </div>
                        <div class="content-card">
                            <div style="margin-bottom: 16px; display: flex; justify-content: space-between;">
                                <div style="display: flex; gap: 10px;">
                                    <el-input v-model="pointsGoodsSearch" placeholder="æœç´¢å•†å“åç§°" style="width: 200px;" clearable @change="loadPointsGoods">
                                        <template #prefix><el-icon><search /></el-icon></template>
                                    </el-input>
                                    <el-select v-model="pointsGoodsCategoryFilter" placeholder="åˆ†ç±»" style="width: 120px;" clearable @change="loadPointsGoods">
                                        <el-option label="ä¼˜æƒ åˆ¸" value="ä¼˜æƒ åˆ¸"></el-option>
                                        <el-option label="äº¬ä¸œEå¡" value="äº¬ä¸œEå¡"></el-option>
                                        <el-option label="å®ç‰©ç¤¼" value="å®ç‰©ç¤¼"></el-option>
                                    </el-select>
                                    <el-button type="primary" @click="loadPointsGoods">æœç´¢</el-button>
                                </div>
                                <el-button type="primary" @click="showPointsGoodsDialog()"><el-icon><plus /></el-icon> æ·»åŠ å•†å“</el-button>
                            </div>
                            <el-table :data="pointsGoodsList" v-loading="pointsGoodsLoading">
                                <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                <el-table-column label="å›¾ç‰‡" width="80">
                                    <template #default="scope">
                                        <el-image v-if="scope.row.image" :src="scope.row.image" style="width: 50px; height: 50px;" fit="cover"></el-image>
                                        <span v-else style="color: #ccc;">-</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="name" label="å•†å“åç§°" width="180"></el-table-column>
                                <el-table-column label="ç§¯åˆ†" width="100">
                                    <template #default="scope"><span style="color: #ff9500; font-weight: 600;">{{ scope.row.points }}</span></template>
                                </el-table-column>
                                <el-table-column prop="category" label="åˆ†ç±»" width="100"></el-table-column>
                                <el-table-column prop="stock" label="åº“å­˜" width="80"></el-table-column>
                                <el-table-column label="çŠ¶æ€" width="80">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.is_active ? 'success' : 'info'" size="small">{{ scope.row.is_active ? 'ä¸Šæ¶' : 'ä¸‹æ¶' }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="160">
                                    <template #default="scope">
                                        <el-button link type="primary" size="small" @click="showPointsGoodsDialog(scope.row)">ç¼–è¾‘</el-button>
                                        <el-button link :type="scope.row.is_active ? 'warning' : 'success'" size="small" @click="togglePointsGoodsStatus(scope.row)">
                                            {{ scope.row.is_active ? 'ä¸‹æ¶' : 'ä¸Šæ¶' }}
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                            <el-pagination v-model:current-page="pointsGoodsPage" v-model:page-size="pointsGoodsPageSize" :total="pointsGoodsTotal"
                                layout="total, prev, pager, next" @current-change="loadPointsGoods" style="margin-top: 16px; justify-content: center;">
                            </el-pagination>
                        </div>
                        <!-- ç§¯åˆ†å•†å“å¯¹è¯æ¡† -->
                        <el-dialog v-model="pointsGoodsDialogVisible" :title="pointsGoodsForm.id ? 'ç¼–è¾‘å•†å“' : 'æ·»åŠ å•†å“'" width="500px">
                            <el-form :model="pointsGoodsForm" label-width="80px">
                                <el-form-item label="åç§°" required><el-input v-model="pointsGoodsForm.name"></el-input></el-form-item>
                                <el-form-item label="ç§¯åˆ†" required><el-input-number v-model="pointsGoodsForm.points" :min="1" style="width: 100%;"></el-input-number></el-form-item>
                                <el-form-item label="åˆ†ç±»" required>
                                    <el-select v-model="pointsGoodsForm.category" style="width: 100%;">
                                        <el-option label="ä¼˜æƒ åˆ¸" value="ä¼˜æƒ åˆ¸"></el-option>
                                        <el-option label="äº¬ä¸œEå¡" value="äº¬ä¸œEå¡"></el-option>
                                        <el-option label="å®ç‰©ç¤¼" value="å®ç‰©ç¤¼"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="åº“å­˜"><el-input-number v-model="pointsGoodsForm.stock" :min="0" style="width: 100%;"></el-input-number></el-form-item>
                                <el-form-item label="å›¾ç‰‡"><el-input v-model="pointsGoodsForm.image" placeholder="å›¾ç‰‡URL"></el-input></el-form-item>
                                <el-form-item label="æè¿°"><el-input v-model="pointsGoodsForm.description" type="textarea" :rows="2"></el-input></el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="pointsGoodsDialogVisible = false">å–æ¶ˆ</el-button>
                                <el-button type="primary" @click="savePointsGoods" :loading="loading">ä¿å­˜</el-button>
                            </template>
                        </el-dialog>
                    </div>

                    <!-- è¯„ä»·ç®¡ç† -->
                    <div v-show="activeMenu === 'reviews'">
                        <div class="page-header">
                            <h3>â­ è¯„ä»·ç®¡ç†</h3>
                        </div>
                        <div class="content-card">
                            <div style="margin-bottom: 16px;">
                                <el-select v-model="reviewStatusFilter" placeholder="çŠ¶æ€ç­›é€‰" style="width: 120px;" clearable @change="loadReviews">
                                    <el-option label="å·²å‘å¸ƒ" value="published"></el-option>
                                    <el-option label="å·²éšè—" value="hidden"></el-option>
                                </el-select>
                                <el-button type="primary" @click="loadReviews" style="margin-left: 10px;">æœç´¢</el-button>
                            </div>
                            <el-table :data="reviewList" v-loading="reviewLoading">
                                <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                <el-table-column prop="user_nickname" label="ç”¨æˆ·" width="100"></el-table-column>
                                <el-table-column prop="project_name" label="é¡¹ç›®" width="180" show-overflow-tooltip></el-table-column>
                                <el-table-column label="è¯„åˆ†" width="120">
                                    <template #default="scope">
                                        <el-rate v-model="scope.row.rating" disabled text-color="#ff9900"></el-rate>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="content" label="å†…å®¹" show-overflow-tooltip></el-table-column>
                                <el-table-column label="çŠ¶æ€" width="80">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.status === 'published' ? 'success' : 'info'" size="small">{{ scope.row.status === 'published' ? 'æ˜¾ç¤º' : 'éšè—' }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="æ—¶é—´" width="160">
                                    <template #default="scope">{{ formatDateTime(scope.row.created_at) }}</template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="160">
                                    <template #default="scope">
                                        <el-button link type="primary" size="small" @click="replyReview(scope.row)">å›å¤</el-button>
                                        <el-button link :type="scope.row.status === 'published' ? 'warning' : 'success'" size="small" @click="toggleReviewStatus(scope.row)">
                                            {{ scope.row.status === 'published' ? 'éšè—' : 'æ˜¾ç¤º' }}
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                            <el-pagination v-model:current-page="reviewPage" v-model:page-size="reviewPageSize" :total="reviewTotal"
                                layout="total, prev, pager, next" @current-change="loadReviews" style="margin-top: 16px; justify-content: center;">
                            </el-pagination>
                        </div>
                    </div>

                    <!-- å›¢ä½“ç®¡ç† -->
                    <div v-show="activeMenu === 'groups'">
                        <div class="page-header">
                            <h3>ğŸ‘¥ å›¢ä½“ç®¡ç†</h3>
                        </div>
                        <div class="content-card">
                            <div style="margin-bottom: 16px; display: flex; gap: 10px;">
                                <el-input v-model="groupSearch" placeholder="æœç´¢å›¢ä½“åç§°/é‚€è¯·ç " style="width: 250px;" clearable @change="loadGroups">
                                    <template #prefix><el-icon><search /></el-icon></template>
                                </el-input>
                                <el-button type="primary" @click="loadGroups">æœç´¢</el-button>
                            </div>
                            <el-table :data="groupList" v-loading="groupLoading">
                                <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                <el-table-column prop="name" label="å›¢ä½“åç§°" width="150"></el-table-column>
                                <el-table-column prop="owner_name" label="è´Ÿè´£äºº" width="100"></el-table-column>
                                <el-table-column prop="owner_phone" label="è”ç³»ç”µè¯" width="120"></el-table-column>
                                <el-table-column prop="university" label="æ‰€å±é«˜æ ¡" width="150"></el-table-column>
                                <el-table-column prop="invite_code" label="é‚€è¯·ç " width="100"></el-table-column>
                                <el-table-column prop="member_count" label="æˆå‘˜æ•°" width="80"></el-table-column>
                                <el-table-column label="ç´¯è®¡æ¶ˆè´¹" width="100">
                                    <template #default="scope">Â¥{{ scope.row.total_spent }}</template>
                                </el-table-column>
                                <el-table-column label="è®¤è¯" width="80">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.is_certified ? 'success' : 'info'" size="small">{{ scope.row.is_certified ? 'å·²è®¤è¯' : 'æœªè®¤è¯' }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="çŠ¶æ€" width="80">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.status === 'active' ? 'success' : 'danger'" size="small">{{ scope.row.status === 'active' ? 'æ­£å¸¸' : 'ç¦ç”¨' }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="160">
                                    <template #default="scope">
                                        <el-button link :type="scope.row.is_certified ? 'warning' : 'success'" size="small" @click="toggleGroupCertify(scope.row)">
                                            {{ scope.row.is_certified ? 'å–æ¶ˆè®¤è¯' : 'è®¤è¯' }}
                                        </el-button>
                                        <el-button link :type="scope.row.status === 'active' ? 'danger' : 'success'" size="small" @click="toggleGroupStatus(scope.row)">
                                            {{ scope.row.status === 'active' ? 'ç¦ç”¨' : 'å¯ç”¨' }}
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                            <el-pagination v-model:current-page="groupPage" v-model:page-size="groupPageSize" :total="groupTotal"
                                layout="total, prev, pager, next" @current-change="loadGroups" style="margin-top: 16px; justify-content: center;">
                            </el-pagination>
                        </div>
                    </div>

                    <!-- é‚€è¯·ç®¡ç† -->
                    <div v-show="activeMenu === 'invites'">
                        <div class="page-header">
                            <h3>ğŸ”— é‚€è¯·ç®¡ç†</h3>
                        </div>
                        <el-tabs v-model="inviteTab">
                            <el-tab-pane label="é‚€è¯·è®°å½•" name="records">
                                <div class="content-card">
                                    <div style="margin-bottom: 16px;">
                                        <el-input v-model="inviteSearch" placeholder="æœç´¢æ‰‹æœºå·" style="width: 250px;" clearable @change="loadInvites"></el-input>
                                        <el-button type="primary" @click="loadInvites" style="margin-left: 10px;">æœç´¢</el-button>
                                    </div>
                                    <el-table :data="inviteList" v-loading="inviteLoading">
                                        <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                        <el-table-column label="é‚€è¯·äºº" width="150">
                                            <template #default="scope">
                                                <div>{{ scope.row.inviter_name }}</div>
                                                <div style="font-size: 12px; color: #999;">{{ scope.row.inviter_phone }}</div>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="è¢«é‚€è¯·äºº" width="150">
                                            <template #default="scope">
                                                <div>{{ scope.row.invitee_name }}</div>
                                                <div style="font-size: 12px; color: #999;">{{ scope.row.invitee_phone }}</div>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="å¥–åŠ±" width="100">
                                            <template #default="scope"><span style="color: #ff4d4f;">Â¥{{ scope.row.reward_amount }}</span></template>
                                        </el-table-column>
                                        <el-table-column label="é¦–å•é‡‘é¢" width="100">
                                            <template #default="scope">Â¥{{ scope.row.first_order_amount || 0 }}</template>
                                        </el-table-column>
                                        <el-table-column label="çŠ¶æ€" width="100">
                                            <template #default="scope">
                                                <el-tag :type="getInviteStatusType(scope.row.status)" size="small">{{ getInviteStatusText(scope.row.status) }}</el-tag>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="é‚€è¯·æ—¶é—´" width="160">
                                            <template #default="scope">{{ formatDateTime(scope.row.invited_at) }}</template>
                                        </el-table-column>
                                    </el-table>
                                    <el-pagination v-model:current-page="invitePage" v-model:page-size="invitePageSize" :total="inviteTotal"
                                        layout="total, prev, pager, next" @current-change="loadInvites" style="margin-top: 16px; justify-content: center;">
                                    </el-pagination>
                                </div>
                            </el-tab-pane>
                            <el-tab-pane label="æç°å®¡æ ¸" name="withdraws">
                                <div class="content-card">
                                    <div style="margin-bottom: 16px;">
                                        <el-select v-model="withdrawStatusFilter" placeholder="çŠ¶æ€ç­›é€‰" style="width: 120px;" clearable @change="loadWithdraws">
                                            <el-option label="å¾…å®¡æ ¸" value="pending"></el-option>
                                            <el-option label="å·²é€šè¿‡" value="approved"></el-option>
                                            <el-option label="å·²æ‹’ç»" value="rejected"></el-option>
                                        </el-select>
                                        <el-button type="primary" @click="loadWithdraws" style="margin-left: 10px;">æœç´¢</el-button>
                                    </div>
                                    <el-table :data="withdrawList" v-loading="withdrawLoading">
                                        <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                        <el-table-column label="ç”¨æˆ·" width="150">
                                            <template #default="scope">
                                                <div>{{ scope.row.user_nickname }}</div>
                                                <div style="font-size: 12px; color: #999;">{{ scope.row.user_phone }}</div>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="é‡‘é¢" width="100">
                                            <template #default="scope"><span style="color: #ff4d4f; font-weight: 600;">Â¥{{ scope.row.amount }}</span></template>
                                        </el-table-column>
                                        <el-table-column label="è´¦æˆ·" width="180">
                                            <template #default="scope">
                                                <div>{{ scope.row.account_type === 'alipay' ? 'æ”¯ä»˜å®' : scope.row.account_type === 'wechat' ? 'å¾®ä¿¡' : 'é“¶è¡Œå¡' }}</div>
                                                <div style="font-size: 12px; color: #999;">{{ scope.row.account_name }} {{ scope.row.account_number }}</div>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="çŠ¶æ€" width="100">
                                            <template #default="scope">
                                                <el-tag :type="getWithdrawStatusType(scope.row.status)" size="small">{{ getWithdrawStatusText(scope.row.status) }}</el-tag>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="ç”³è¯·æ—¶é—´" width="160">
                                            <template #default="scope">{{ formatDateTime(scope.row.created_at) }}</template>
                                        </el-table-column>
                                        <el-table-column label="æ“ä½œ" width="150">
                                            <template #default="scope">
                                                <template v-if="scope.row.status === 'pending'">
                                                    <el-button link type="success" size="small" @click="reviewWithdraw(scope.row.id, 'approve')">é€šè¿‡</el-button>
                                                    <el-button link type="danger" size="small" @click="reviewWithdraw(scope.row.id, 'reject')">æ‹’ç»</el-button>
                                                </template>
                                                <span v-else style="color: #999;">å·²å¤„ç†</span>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                    <el-pagination v-model:current-page="withdrawPage" v-model:page-size="withdrawPageSize" :total="withdrawTotal"
                                        layout="total, prev, pager, next" @current-change="loadWithdraws" style="margin-top: 16px; justify-content: center;">
                                    </el-pagination>
                                </div>
                            </el-tab-pane>
                        </el-tabs>
                    </div>

                    <!-- ç³»ç»Ÿè®¾ç½® -->
                    <div v-show="activeMenu === 'settings'">
                        <div class="page-header">
                            <h3>âš™ï¸ ç³»ç»Ÿè®¾ç½®</h3>
                        </div>
                        <div class="content-card">
                            <el-descriptions title="ç³»ç»Ÿä¿¡æ¯" :column="2" border>
                                <el-descriptions-item label="ç³»ç»Ÿåç§°">ç§‘ç ”æ£€æµ‹æœåŠ¡å¹³å°</el-descriptions-item>
                                <el-descriptions-item label="ç‰ˆæœ¬">v2.0.0</el-descriptions-item>
                                <el-descriptions-item label="åç«¯åœ°å€">{{ baseUrl }}</el-descriptions-item>
                                <el-descriptions-item label="å½“å‰ç®¡ç†å‘˜">{{ userInfo.nickname }}</el-descriptions-item>
                            </el-descriptions>
                            <el-divider></el-divider>
                            <h4 style="margin-bottom: 16px;">ç§¯åˆ†è®¾ç½®</h4>
                            <el-form :model="pointsSettings" label-width="150px" style="max-width: 500px;">
                                <el-form-item label="æ¶ˆè´¹è¿”ç§¯åˆ†æ¯”ä¾‹">
                                    <el-input-number v-model="pointsSettings.ratio" :min="0" :max="100" :precision="2"></el-input-number>
                                    <span style="margin-left: 8px;">% ï¼ˆæ¶ˆè´¹é‡‘é¢çš„ç™¾åˆ†æ¯”ï¼‰</span>
                                </el-form-item>
                                <el-form-item label="ç§¯åˆ†æŠµæ‰£æ¯”ä¾‹">
                                    <el-input-number v-model="pointsSettings.deductionRatio" :min="1" :max="1000"></el-input-number>
                                    <span style="margin-left: 8px;">ç§¯åˆ† = 1å…ƒ</span>
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @click="savePointsSettings">ä¿å­˜è®¾ç½®</el-button>
                                </el-form-item>
                            </el-form>
                        </div>
                    </div>

                    <!-- æƒé™ç®¡ç† -->
                    <div v-show="activeMenu === 'permissions'">
                        <div class="page-header">
                            <h3>ğŸ” æƒé™ç®¡ç†</h3>
                        </div>
                        <el-tabs v-model="permissionTab">
                            <el-tab-pane label="è§’è‰²ç®¡ç†" name="roles">
                                <div class="content-card">
                                    <div style="margin-bottom: 16px; display: flex; justify-content: space-between;">
                                        <el-input v-model="roleSearch" placeholder="æœç´¢è§’è‰²åç§°" style="width: 250px;" clearable></el-input>
                                        <el-button type="primary" @click="showRoleDialog()"><el-icon><plus /></el-icon> æ·»åŠ è§’è‰²</el-button>
                                    </div>
                                    <el-table :data="roleList" v-loading="roleLoading">
                                        <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                        <el-table-column prop="name" label="è§’è‰²åç§°" width="150"></el-table-column>
                                        <el-table-column prop="code" label="è§’è‰²ç¼–ç " width="120"></el-table-column>
                                        <el-table-column prop="description" label="æè¿°"></el-table-column>
                                        <el-table-column prop="user_count" label="ç”¨æˆ·æ•°" width="80"></el-table-column>
                                        <el-table-column label="çŠ¶æ€" width="80">
                                            <template #default="scope">
                                                <el-tag :type="scope.row.is_active ? 'success' : 'info'" size="small">{{ scope.row.is_active ? 'å¯ç”¨' : 'ç¦ç”¨' }}</el-tag>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="æ“ä½œ" width="200">
                                            <template #default="scope">
                                                <el-button link type="primary" size="small" @click="showRoleDialog(scope.row)">ç¼–è¾‘</el-button>
                                                <el-button link type="warning" size="small" @click="showRolePermissions(scope.row)">æƒé™</el-button>
                                                <el-button link type="danger" size="small" @click="deleteRole(scope.row.id)" v-if="!scope.row.is_system">åˆ é™¤</el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                </div>
                            </el-tab-pane>
                            <el-tab-pane label="å‘˜å·¥è´¦å·" name="staff">
                                <div class="content-card">
                                    <div style="margin-bottom: 16px; display: flex; justify-content: space-between;">
                                        <div style="display: flex; gap: 10px;">
                                            <el-input v-model="staffSearch" placeholder="æœç´¢æ‰‹æœºå·/å§“å" style="width: 200px;" clearable></el-input>
                                            <el-select v-model="staffRoleFilter" placeholder="è§’è‰²ç­›é€‰" style="width: 120px;" clearable>
                                                <el-option v-for="role in roleList" :key="role.id" :label="role.name" :value="role.id"></el-option>
                                            </el-select>
                                        </div>
                                        <el-button type="primary" @click="showStaffDialog()"><el-icon><plus /></el-icon> æ·»åŠ å‘˜å·¥</el-button>
                                    </div>
                                    <el-table :data="staffList" v-loading="staffLoading">
                                        <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                        <el-table-column prop="name" label="å§“å" width="100"></el-table-column>
                                        <el-table-column prop="phone" label="æ‰‹æœºå·" width="130"></el-table-column>
                                        <el-table-column prop="role_name" label="è§’è‰²" width="100"></el-table-column>
                                        <el-table-column prop="department" label="éƒ¨é—¨" width="100"></el-table-column>
                                        <el-table-column label="çŠ¶æ€" width="80">
                                            <template #default="scope">
                                                <el-tag :type="scope.row.is_active ? 'success' : 'info'" size="small">{{ scope.row.is_active ? 'åœ¨èŒ' : 'ç¦»èŒ' }}</el-tag>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="æœ€åç™»å½•" width="160">
                                            <template #default="scope">{{ formatDateTime(scope.row.last_login_at) || 'ä»æœªç™»å½•' }}</template>
                                        </el-table-column>
                                        <el-table-column label="æ“ä½œ" width="200">
                                            <template #default="scope">
                                                <el-button link type="primary" size="small" @click="showStaffDialog(scope.row)">ç¼–è¾‘</el-button>
                                                <el-button link type="warning" size="small" @click="resetStaffPassword(scope.row)">é‡ç½®å¯†ç </el-button>
                                                <el-button link :type="scope.row.is_active ? 'danger' : 'success'" size="small" @click="toggleStaffStatus(scope.row)">
                                                    {{ scope.row.is_active ? 'ç¦ç”¨' : 'å¯ç”¨' }}
                                                </el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                </div>
                            </el-tab-pane>
                        </el-tabs>
                        <!-- è§’è‰²å¯¹è¯æ¡† -->
                        <el-dialog v-model="roleDialogVisible" :title="roleForm.id ? 'ç¼–è¾‘è§’è‰²' : 'æ·»åŠ è§’è‰²'" width="500px">
                            <el-form :model="roleForm" label-width="80px">
                                <el-form-item label="è§’è‰²åç§°" required><el-input v-model="roleForm.name" placeholder="å¦‚ï¼šé”€å”®"></el-input></el-form-item>
                                <el-form-item label="è§’è‰²ç¼–ç " required><el-input v-model="roleForm.code" placeholder="å¦‚ï¼šsales"></el-input></el-form-item>
                                <el-form-item label="æè¿°"><el-input v-model="roleForm.description" type="textarea" :rows="2"></el-input></el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="roleDialogVisible = false">å–æ¶ˆ</el-button>
                                <el-button type="primary" @click="saveRole">ä¿å­˜</el-button>
                            </template>
                        </el-dialog>
                        <!-- å‘˜å·¥å¯¹è¯æ¡† -->
                        <el-dialog v-model="staffDialogVisible" :title="staffForm.id ? 'ç¼–è¾‘å‘˜å·¥' : 'æ·»åŠ å‘˜å·¥'" width="500px">
                            <el-form :model="staffForm" label-width="80px">
                                <el-form-item label="å§“å" required><el-input v-model="staffForm.name"></el-input></el-form-item>
                                <el-form-item label="æ‰‹æœºå·" required><el-input v-model="staffForm.phone"></el-input></el-form-item>
                                <el-form-item label="è§’è‰²" required>
                                    <el-select v-model="staffForm.role_id" style="width: 100%;">
                                        <el-option v-for="role in roleList" :key="role.id" :label="role.name" :value="role.id"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="éƒ¨é—¨"><el-input v-model="staffForm.department"></el-input></el-form-item>
                                <el-form-item label="åˆå§‹å¯†ç " v-if="!staffForm.id"><el-input v-model="staffForm.password" type="password" show-password></el-input></el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="staffDialogVisible = false">å–æ¶ˆ</el-button>
                                <el-button type="primary" @click="saveStaff">ä¿å­˜</el-button>
                            </template>
                        </el-dialog>
                        <!-- æƒé™é…ç½®å¯¹è¯æ¡† -->
                        <el-dialog v-model="permissionDialogVisible" title="é…ç½®æƒé™" width="600px">
                            <div v-if="currentRole">
                                <h4 style="margin-bottom: 16px;">{{ currentRole.name }} - æƒé™é…ç½®</h4>
                                <el-tree
                                    ref="permissionTree"
                                    :data="permissionTree"
                                    show-checkbox
                                    node-key="id"
                                    :default-checked-keys="currentRole.permissions || []"
                                    :props="{ label: 'name', children: 'children' }">
                                </el-tree>
                            </div>
                            <template #footer>
                                <el-button @click="permissionDialogVisible = false">å–æ¶ˆ</el-button>
                                <el-button type="primary" @click="saveRolePermissions">ä¿å­˜</el-button>
                            </template>
                        </el-dialog>
                    </div>

                    <!-- é”€å”®ç®¡ç† -->
                    <div v-show="activeMenu === 'sales'">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>ğŸ“Š é”€å”®ç®¡ç†</h3>
                            <el-button type="primary" @click="exportSalesData"><el-icon><download /></el-icon> å¯¼å‡ºæŠ¥è¡¨</el-button>
                        </div>
                        <el-row :gutter="16" style="margin-bottom: 16px;">
                            <el-col :span="6">
                                <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                    <div class="stat-icon">ğŸ’°</div>
                                    <div class="stat-info">
                                        <div class="stat-value">Â¥{{ salesData.totalRevenue || 0 }}</div>
                                        <div class="stat-label">æ€»é”€å”®é¢</div>
                                    </div>
                                </div>
                            </el-col>
                            <el-col :span="6">
                                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                    <div class="stat-icon">ğŸ“¦</div>
                                    <div class="stat-info">
                                        <div class="stat-value">{{ salesData.totalOrders || 0 }}</div>
                                        <div class="stat-label">æ€»è®¢å•æ•°</div>
                                    </div>
                                </div>
                            </el-col>
                            <el-col :span="6">
                                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                    <div class="stat-icon">ğŸ‘¥</div>
                                    <div class="stat-info">
                                        <div class="stat-value">{{ salesData.newCustomers || 0 }}</div>
                                        <div class="stat-label">æ–°å®¢æˆ·æ•°</div>
                                    </div>
                                </div>
                            </el-col>
                            <el-col :span="6">
                                <div class="stat-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                                    <div class="stat-icon">ğŸ“ˆ</div>
                                    <div class="stat-info">
                                        <div class="stat-value">{{ salesData.conversionRate || 0 }}%</div>
                                        <div class="stat-label">è½¬åŒ–ç‡</div>
                                    </div>
                                </div>
                            </el-col>
                        </el-row>
                        <div class="content-card">
                            <div style="margin-bottom: 16px; display: flex; justify-content: space-between;">
                                <div style="display: flex; gap: 10px;">
                                    <el-date-picker v-model="salesDateRange" type="daterange" range-separator="è‡³" start-placeholder="å¼€å§‹æ—¥æœŸ" end-placeholder="ç»“æŸæ—¥æœŸ" @change="loadSalesData"></el-date-picker>
                                    <el-select v-model="salesStaffFilter" placeholder="é”€å”®äººå‘˜" style="width: 150px;" clearable @change="loadSalesData">
                                        <el-option v-for="s in salesStaffList" :key="s.id" :label="s.name" :value="s.id"></el-option>
                                    </el-select>
                                </div>
                            </div>
                            <h4 style="margin-bottom: 16px;">é”€å”®äººå‘˜ä¸šç»©æ’å</h4>
                            <el-table :data="salesRanking" v-loading="salesLoading">
                                <el-table-column type="index" label="æ’å" width="80"></el-table-column>
                                <el-table-column prop="name" label="é”€å”®äººå‘˜" width="120"></el-table-column>
                                <el-table-column prop="department" label="éƒ¨é—¨" width="100"></el-table-column>
                                <el-table-column label="é”€å”®é¢" width="150">
                                    <template #default="scope"><span style="color: #ff4d4f; font-weight: 600;">Â¥{{ scope.row.revenue }}</span></template>
                                </el-table-column>
                                <el-table-column prop="order_count" label="è®¢å•æ•°" width="100"></el-table-column>
                                <el-table-column prop="customer_count" label="å®¢æˆ·æ•°" width="100"></el-table-column>
                                <el-table-column label="å®Œæˆç‡" width="150">
                                    <template #default="scope">
                                        <el-progress :percentage="scope.row.completion_rate" :color="scope.row.completion_rate >= 100 ? '#67c23a' : '#409eff'"></el-progress>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </div>
                    </div>

                    <!-- å®éªŒå®¤ç®¡ç† -->
                    <div v-show="activeMenu === 'laboratory'">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>ğŸ”¬ å®éªŒå®¤ç®¡ç†</h3>
                            <el-button type="primary" @click="showLabDialog()"><el-icon><plus /></el-icon> æ·»åŠ å®éªŒå®¤</el-button>
                        </div>
                        <div class="content-card">
                            <el-table :data="labList" v-loading="labLoading">
                                <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                <el-table-column prop="name" label="å®éªŒå®¤åç§°" width="180"></el-table-column>
                                <el-table-column prop="director" label="è´Ÿè´£äºº" width="100"></el-table-column>
                                <el-table-column prop="phone" label="è”ç³»ç”µè¯" width="130"></el-table-column>
                                <el-table-column prop="location" label="ä½ç½®" width="150"></el-table-column>
                                <el-table-column prop="equipment_count" label="è®¾å¤‡æ•°" width="80"></el-table-column>
                                <el-table-column label="å½“å‰ä»»åŠ¡" width="100">
                                    <template #default="scope"><el-tag type="warning" size="small">{{ scope.row.current_tasks || 0 }}ä¸ª</el-tag></template>
                                </el-table-column>
                                <el-table-column label="çŠ¶æ€" width="80">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.status === 'active' ? 'success' : scope.row.status === 'busy' ? 'warning' : 'info'" size="small">
                                            {{ scope.row.status === 'active' ? 'ç©ºé—²' : scope.row.status === 'busy' ? 'å¿™ç¢Œ' : 'ç»´æŠ¤ä¸­' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="200">
                                    <template #default="scope">
                                        <el-button link type="primary" size="small" @click="showLabDialog(scope.row)">ç¼–è¾‘</el-button>
                                        <el-button link type="success" size="small" @click="viewLabTasks(scope.row)">ä»»åŠ¡</el-button>
                                        <el-button link type="danger" size="small" @click="deleteLab(scope.row.id)">åˆ é™¤</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </div>
                        <!-- å®éªŒå®¤å¯¹è¯æ¡† -->
                        <el-dialog v-model="labDialogVisible" :title="labForm.id ? 'ç¼–è¾‘å®éªŒå®¤' : 'æ·»åŠ å®éªŒå®¤'" width="550px">
                            <el-form :model="labForm" label-width="100px">
                                <el-form-item label="å®éªŒå®¤åç§°" required><el-input v-model="labForm.name"></el-input></el-form-item>
                                <el-form-item label="è´Ÿè´£äºº" required><el-input v-model="labForm.director"></el-input></el-form-item>
                                <el-form-item label="è”ç³»ç”µè¯"><el-input v-model="labForm.phone"></el-input></el-form-item>
                                <el-form-item label="ä½ç½®"><el-input v-model="labForm.location"></el-input></el-form-item>
                                <el-form-item label="çŠ¶æ€">
                                    <el-select v-model="labForm.status" style="width: 100%;">
                                        <el-option label="ç©ºé—²" value="active"></el-option>
                                        <el-option label="å¿™ç¢Œ" value="busy"></el-option>
                                        <el-option label="ç»´æŠ¤ä¸­" value="maintenance"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="æè¿°"><el-input v-model="labForm.description" type="textarea" :rows="2"></el-input></el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="labDialogVisible = false">å–æ¶ˆ</el-button>
                                <el-button type="primary" @click="saveLab">ä¿å­˜</el-button>
                            </template>
                        </el-dialog>
                    </div>

                    <!-- ä»ªå™¨ç®¡ç† -->
                    <div v-show="activeMenu === 'equipment'">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>ğŸ”§ æµ‹è¯•ä»ªå™¨ç®¡ç†</h3>
                            <el-button type="primary" @click="showEquipmentDialog()"><el-icon><plus /></el-icon> æ·»åŠ ä»ªå™¨</el-button>
                        </div>
                        <div class="content-card">
                            <div style="margin-bottom: 16px; display: flex; gap: 10px;">
                                <el-input v-model="equipmentSearch" placeholder="æœç´¢ä»ªå™¨åç§°/ç¼–å·" style="width: 250px;" clearable></el-input>
                                <el-select v-model="equipmentCategoryFilter" placeholder="åˆ†ç±»ç­›é€‰" style="width: 150px;" clearable>
                                    <el-option label="ææ–™è¡¨å¾" value="ææ–™è¡¨å¾"></el-option>
                                    <el-option label="ç¦»å­æµ‹è¯•" value="ç¦»å­æµ‹è¯•"></el-option>
                                    <el-option label="ç»„ç»‡æˆåˆ†" value="ç»„ç»‡æˆåˆ†"></el-option>
                                    <el-option label="ç”Ÿç‰©ç§‘å­¦" value="ç”Ÿç‰©ç§‘å­¦"></el-option>
                                    <el-option label="ç¯å¢ƒæ£€æµ‹" value="ç¯å¢ƒæ£€æµ‹"></el-option>
                                    <el-option label="æ¨¡æ‹Ÿè®¡ç®—" value="æ¨¡æ‹Ÿè®¡ç®—"></el-option>
                                    <el-option label="æ•°æ®åˆ†æ" value="æ•°æ®åˆ†æ"></el-option>
                                    <el-option label="ææ–™åŠ å·¥" value="ææ–™åŠ å·¥"></el-option>
                                    <el-option label="è®ºæ–‡æœåŠ¡" value="è®ºæ–‡æœåŠ¡"></el-option>
                                </el-select>
                                <el-button type="primary" @click="loadEquipment">æœç´¢</el-button>
                            </div>
                            <el-table :data="equipmentList" v-loading="equipmentLoading">
                                <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                <el-table-column label="å›¾ç‰‡" width="80">
                                    <template #default="scope">
                                        <el-image v-if="scope.row.image" :src="scope.row.image" style="width: 50px; height: 50px;" fit="cover"></el-image>
                                        <span v-else style="color: #ccc;">-</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="equipment_no" label="ç¼–å·" width="100"></el-table-column>
                                <el-table-column prop="name" label="ä»ªå™¨åç§°" width="180"></el-table-column>
                                <el-table-column prop="category" label="åˆ†ç±»" width="100"></el-table-column>
                                <el-table-column prop="lab_name" label="æ‰€å±å®éªŒå®¤" width="120"></el-table-column>
                                <el-table-column prop="brand" label="å“ç‰Œ/å‹å·" width="120"></el-table-column>
                                <el-table-column label="çŠ¶æ€" width="80">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.status === 'available' ? 'success' : scope.row.status === 'in_use' ? 'warning' : 'danger'" size="small">
                                            {{ scope.row.status === 'available' ? 'å¯ç”¨' : scope.row.status === 'in_use' ? 'ä½¿ç”¨ä¸­' : 'ç»´ä¿®ä¸­' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="180">
                                    <template #default="scope">
                                        <el-button link type="primary" size="small" @click="showEquipmentDialog(scope.row)">ç¼–è¾‘</el-button>
                                        <el-button link type="warning" size="small" @click="showEquipmentMaintenance(scope.row)">ç»´æŠ¤</el-button>
                                        <el-button link type="danger" size="small" @click="deleteEquipment(scope.row.id)">åˆ é™¤</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </div>
                        <!-- ä»ªå™¨å¯¹è¯æ¡† -->
                        <el-dialog v-model="equipmentDialogVisible" :title="equipmentForm.id ? 'ç¼–è¾‘ä»ªå™¨' : 'æ·»åŠ ä»ªå™¨'" width="600px">
                            <el-form :model="equipmentForm" label-width="100px">
                                <el-form-item label="ä»ªå™¨ç¼–å·" required><el-input v-model="equipmentForm.equipment_no" placeholder="å¦‚: EQ001"></el-input></el-form-item>
                                <el-form-item label="ä»ªå™¨åç§°" required><el-input v-model="equipmentForm.name"></el-input></el-form-item>
                                <el-form-item label="åˆ†ç±»" required>
                                    <el-select v-model="equipmentForm.category" style="width: 100%;">
                                        <el-option label="ææ–™è¡¨å¾" value="ææ–™è¡¨å¾"></el-option>
                                        <el-option label="ç¦»å­æµ‹è¯•" value="ç¦»å­æµ‹è¯•"></el-option>
                                        <el-option label="ç»„ç»‡æˆåˆ†" value="ç»„ç»‡æˆåˆ†"></el-option>
                                        <el-option label="ç”Ÿç‰©ç§‘å­¦" value="ç”Ÿç‰©ç§‘å­¦"></el-option>
                                        <el-option label="ç¯å¢ƒæ£€æµ‹" value="ç¯å¢ƒæ£€æµ‹"></el-option>
                                        <el-option label="æ¨¡æ‹Ÿè®¡ç®—" value="æ¨¡æ‹Ÿè®¡ç®—"></el-option>
                                        <el-option label="æ•°æ®åˆ†æ" value="æ•°æ®åˆ†æ"></el-option>
                                        <el-option label="ææ–™åŠ å·¥" value="ææ–™åŠ å·¥"></el-option>
                                        <el-option label="è®ºæ–‡æœåŠ¡" value="è®ºæ–‡æœåŠ¡"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="æ‰€å±å®éªŒå®¤">
                                    <el-select v-model="equipmentForm.lab_id" style="width: 100%;">
                                        <el-option v-for="lab in labList" :key="lab.id" :label="lab.name" :value="lab.id"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="å“ç‰Œ/å‹å·"><el-input v-model="equipmentForm.brand"></el-input></el-form-item>
                                <el-form-item label="å›¾ç‰‡"><el-input v-model="equipmentForm.image" placeholder="å›¾ç‰‡URL"></el-input></el-form-item>
                                <el-form-item label="æè¿°"><el-input v-model="equipmentForm.description" type="textarea" :rows="2"></el-input></el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="equipmentDialogVisible = false">å–æ¶ˆ</el-button>
                                <el-button type="primary" @click="saveEquipment">ä¿å­˜</el-button>
                            </template>
                        </el-dialog>
                    </div>

                    <!-- è´¢åŠ¡ç®¡ç† -->
                    <div v-show="activeMenu === 'finance'">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>ğŸ’° è´¢åŠ¡ç®¡ç†</h3>
                            <el-button type="primary" @click="exportFinanceData"><el-icon><download /></el-icon> å¯¼å‡ºæŠ¥è¡¨</el-button>
                        </div>
                        <el-row :gutter="16" style="margin-bottom: 16px;">
                            <el-col :span="6">
                                <div class="stat-card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                                    <div class="stat-icon">ğŸ’µ</div>
                                    <div class="stat-info">
                                        <div class="stat-value">Â¥{{ financeData.totalIncome || 0 }}</div>
                                        <div class="stat-label">æ€»æ”¶å…¥</div>
                                    </div>
                                </div>
                            </el-col>
                            <el-col :span="6">
                                <div class="stat-card" style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);">
                                    <div class="stat-icon">ğŸ’¸</div>
                                    <div class="stat-info">
                                        <div class="stat-value">Â¥{{ financeData.totalExpense || 0 }}</div>
                                        <div class="stat-label">æ€»æ”¯å‡º</div>
                                    </div>
                                </div>
                            </el-col>
                            <el-col :span="6">
                                <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                    <div class="stat-icon">ğŸ“Š</div>
                                    <div class="stat-info">
                                        <div class="stat-value">Â¥{{ financeData.netProfit || 0 }}</div>
                                        <div class="stat-label">å‡€åˆ©æ¶¦</div>
                                    </div>
                                </div>
                            </el-col>
                            <el-col :span="6">
                                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                    <div class="stat-icon">â³</div>
                                    <div class="stat-info">
                                        <div class="stat-value">Â¥{{ financeData.pendingAmount || 0 }}</div>
                                        <div class="stat-label">å¾…ç»“ç®—</div>
                                    </div>
                                </div>
                            </el-col>
                        </el-row>
                        <el-tabs v-model="financeTab">
                            <el-tab-pane label="æ”¶å…¥æ˜ç»†" name="income">
                                <div class="content-card">
                                    <div style="margin-bottom: 16px; display: flex; gap: 10px;">
                                        <el-date-picker v-model="financeDateRange" type="daterange" range-separator="è‡³" start-placeholder="å¼€å§‹æ—¥æœŸ" end-placeholder="ç»“æŸæ—¥æœŸ"></el-date-picker>
                                        <el-select v-model="incomeTypeFilter" placeholder="æ”¶å…¥ç±»å‹" style="width: 150px;" clearable>
                                            <el-option label="è®¢å•æ”¶å…¥" value="order"></el-option>
                                            <el-option label="å……å€¼æ”¶å…¥" value="recharge"></el-option>
                                            <el-option label="å…¶ä»–æ”¶å…¥" value="other"></el-option>
                                        </el-select>
                                        <el-button type="primary" @click="loadIncomeList">æœç´¢</el-button>
                                    </div>
                                    <el-table :data="incomeList" v-loading="financeLoading">
                                        <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                        <el-table-column prop="order_no" label="å…³è”å•å·" width="180"></el-table-column>
                                        <el-table-column prop="type_text" label="ç±»å‹" width="100"></el-table-column>
                                        <el-table-column label="é‡‘é¢" width="120">
                                            <template #default="scope"><span style="color: #52c41a; font-weight: 600;">+Â¥{{ scope.row.amount }}</span></template>
                                        </el-table-column>
                                        <el-table-column prop="payment_method" label="æ”¯ä»˜æ–¹å¼" width="100"></el-table-column>
                                        <el-table-column prop="remark" label="å¤‡æ³¨"></el-table-column>
                                        <el-table-column label="æ—¶é—´" width="160">
                                            <template #default="scope">{{ formatDateTime(scope.row.created_at) }}</template>
                                        </el-table-column>
                                    </el-table>
                                </div>
                            </el-tab-pane>
                            <el-tab-pane label="æ”¯å‡ºæ˜ç»†" name="expense">
                                <div class="content-card">
                                    <div style="margin-bottom: 16px; display: flex; justify-content: space-between;">
                                        <div style="display: flex; gap: 10px;">
                                            <el-date-picker v-model="financeDateRange" type="daterange" range-separator="è‡³" start-placeholder="å¼€å§‹æ—¥æœŸ" end-placeholder="ç»“æŸæ—¥æœŸ"></el-date-picker>
                                            <el-button type="primary" @click="loadExpenseList">æœç´¢</el-button>
                                        </div>
                                        <el-button type="primary" @click="showExpenseDialog()"><el-icon><plus /></el-icon> æ·»åŠ æ”¯å‡º</el-button>
                                    </div>
                                    <el-table :data="expenseList" v-loading="financeLoading">
                                        <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                        <el-table-column prop="category" label="åˆ†ç±»" width="100"></el-table-column>
                                        <el-table-column label="é‡‘é¢" width="120">
                                            <template #default="scope"><span style="color: #ff4d4f; font-weight: 600;">-Â¥{{ scope.row.amount }}</span></template>
                                        </el-table-column>
                                        <el-table-column prop="description" label="æè¿°"></el-table-column>
                                        <el-table-column prop="handler" label="ç»åŠäºº" width="100"></el-table-column>
                                        <el-table-column label="æ—¶é—´" width="160">
                                            <template #default="scope">{{ formatDateTime(scope.row.created_at) }}</template>
                                        </el-table-column>
                                    </el-table>
                                </div>
                            </el-tab-pane>
                            <el-tab-pane label="ç»“ç®—ç®¡ç†" name="settlement">
                                <div class="content-card">
                                    <el-table :data="settlementList" v-loading="financeLoading">
                                        <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                        <el-table-column prop="partner_name" label="åˆä½œæ–¹" width="150"></el-table-column>
                                        <el-table-column label="å¾…ç»“ç®—é‡‘é¢" width="120">
                                            <template #default="scope"><span style="color: #ff4d4f; font-weight: 600;">Â¥{{ scope.row.amount }}</span></template>
                                        </el-table-column>
                                        <el-table-column prop="order_count" label="è®¢å•æ•°" width="80"></el-table-column>
                                        <el-table-column label="çŠ¶æ€" width="100">
                                            <template #default="scope">
                                                <el-tag :type="scope.row.status === 'pending' ? 'warning' : 'success'" size="small">{{ scope.row.status === 'pending' ? 'å¾…ç»“ç®—' : 'å·²ç»“ç®—' }}</el-tag>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="æ“ä½œ" width="150">
                                            <template #default="scope">
                                                <el-button v-if="scope.row.status === 'pending'" link type="primary" size="small" @click="confirmSettlement(scope.row)">ç¡®è®¤ç»“ç®—</el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                </div>
                            </el-tab-pane>
                        </el-tabs>
                    </div>

                    <!-- å‘ç¥¨ç®¡ç† -->
                    <div v-show="activeMenu === 'invoice'">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>ğŸ§¾ å‘ç¥¨ç®¡ç†</h3>
                            <el-button type="primary" @click="exportInvoiceData"><el-icon><download /></el-icon> å¯¼å‡ºæ•°æ®</el-button>
                        </div>
                        <el-tabs v-model="invoiceTab">
                            <el-tab-pane label="å¼€ç¥¨ç”³è¯·" name="applications">
                                <div class="content-card">
                                    <div style="margin-bottom: 16px; display: flex; gap: 10px;">
                                        <el-input v-model="invoiceSearch" placeholder="æœç´¢è®¢å•å·/ç”³è¯·äºº" style="width: 250px;" clearable></el-input>
                                        <el-select v-model="invoiceStatusFilter" placeholder="çŠ¶æ€ç­›é€‰" style="width: 120px;" clearable>
                                            <el-option label="å¾…å®¡æ ¸" value="pending"></el-option>
                                            <el-option label="å¼€ç¥¨ä¸­" value="processing"></el-option>
                                            <el-option label="å·²å¼€ç¥¨" value="completed"></el-option>
                                            <el-option label="å·²æ‹’ç»" value="rejected"></el-option>
                                        </el-select>
                                        <el-button type="primary" @click="loadInvoiceList">æœç´¢</el-button>
                                    </div>
                                    <el-table :data="invoiceList" v-loading="invoiceLoading">
                                        <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                        <el-table-column prop="invoice_no" label="å‘ç¥¨å·" width="150"></el-table-column>
                                        <el-table-column prop="order_no" label="è®¢å•å·" width="180"></el-table-column>
                                        <el-table-column prop="applicant" label="ç”³è¯·äºº" width="100"></el-table-column>
                                        <el-table-column prop="title" label="å‘ç¥¨æŠ¬å¤´" width="180"></el-table-column>
                                        <el-table-column prop="tax_no" label="ç¨å·" width="180"></el-table-column>
                                        <el-table-column label="é‡‘é¢" width="100">
                                            <template #default="scope"><span style="color: #ff4d4f; font-weight: 600;">Â¥{{ scope.row.amount }}</span></template>
                                        </el-table-column>
                                        <el-table-column label="ç±»å‹" width="80">
                                            <template #default="scope">
                                                <el-tag :type="scope.row.type === 'special' ? 'warning' : 'info'" size="small">{{ scope.row.type === 'special' ? 'ä¸“ç¥¨' : 'æ™®ç¥¨' }}</el-tag>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="çŠ¶æ€" width="80">
                                            <template #default="scope">
                                                <el-tag :type="getInvoiceStatusType(scope.row.status)" size="small">{{ getInvoiceStatusText(scope.row.status) }}</el-tag>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="æ“ä½œ" width="200">
                                            <template #default="scope">
                                                <template v-if="scope.row.status === 'pending'">
                                                    <el-button link type="success" size="small" @click="approveInvoice(scope.row)">å®¡æ ¸é€šè¿‡</el-button>
                                                    <el-button link type="danger" size="small" @click="rejectInvoice(scope.row)">æ‹’ç»</el-button>
                                                </template>
                                                <template v-else-if="scope.row.status === 'processing'">
                                                    <el-button link type="primary" size="small" @click="confirmInvoice(scope.row)">ç¡®è®¤å¼€ç¥¨</el-button>
                                                </template>
                                                <el-button link type="info" size="small" @click="viewInvoiceDetail(scope.row)">è¯¦æƒ…</el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                </div>
                            </el-tab-pane>
                            <el-tab-pane label="å¼€ç¥¨è®°å½•" name="records">
                                <div class="content-card">
                                    <el-table :data="invoiceRecordList" v-loading="invoiceLoading">
                                        <el-table-column prop="invoice_no" label="å‘ç¥¨å·" width="150"></el-table-column>
                                        <el-table-column prop="title" label="å‘ç¥¨æŠ¬å¤´" width="200"></el-table-column>
                                        <el-table-column label="é‡‘é¢" width="120">
                                            <template #default="scope">Â¥{{ scope.row.amount }}</template>
                                        </el-table-column>
                                        <el-table-column prop="type_text" label="ç±»å‹" width="80"></el-table-column>
                                        <el-table-column prop="handler" label="å¼€ç¥¨äºº" width="100"></el-table-column>
                                        <el-table-column label="å¼€ç¥¨æ—¶é—´" width="160">
                                            <template #default="scope">{{ formatDateTime(scope.row.invoice_at) }}</template>
                                        </el-table-column>
                                        <el-table-column label="æ“ä½œ" width="100">
                                            <template #default="scope">
                                                <el-button link type="primary" size="small" @click="downloadInvoice(scope.row)">ä¸‹è½½</el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                </div>
                            </el-tab-pane>
                        </el-tabs>
                    </div>

                    <!-- å®¢æœç®¡ç† -->
                    <div v-show="activeMenu === 'customer_service'">
                        <div class="page-header">
                            <h3>ğŸ’¬ å®¢æœç®¡ç†</h3>
                        </div>
                        <el-tabs v-model="csTab">
                            <el-tab-pane label="å’¨è¯¢åˆ—è¡¨" name="chats">
                                <div class="content-card">
                                    <div style="margin-bottom: 16px; display: flex; gap: 10px;">
                                        <el-input v-model="chatSearch" placeholder="æœç´¢ç”¨æˆ·/å†…å®¹" style="width: 250px;" clearable></el-input>
                                        <el-select v-model="chatStatusFilter" placeholder="çŠ¶æ€" style="width: 120px;" clearable>
                                            <el-option label="å¾…å›å¤" value="pending"></el-option>
                                            <el-option label="å¤„ç†ä¸­" value="processing"></el-option>
                                            <el-option label="å·²å®Œæˆ" value="completed"></el-option>
                                        </el-select>
                                        <el-button type="primary" @click="loadChatList">æœç´¢</el-button>
                                    </div>
                                    <el-table :data="chatList" v-loading="chatLoading">
                                        <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                        <el-table-column label="ç”¨æˆ·" width="150">
                                            <template #default="scope">
                                                <div>{{ scope.row.user_name }}</div>
                                                <div style="font-size: 12px; color: #999;">{{ scope.row.user_phone }}</div>
                                            </template>
                                        </el-table-column>
                                        <el-table-column prop="last_message" label="æœ€æ–°æ¶ˆæ¯" show-overflow-tooltip></el-table-column>
                                        <el-table-column prop="message_count" label="æ¶ˆæ¯æ•°" width="80"></el-table-column>
                                        <el-table-column label="çŠ¶æ€" width="80">
                                            <template #default="scope">
                                                <el-tag :type="scope.row.status === 'pending' ? 'danger' : scope.row.status === 'processing' ? 'warning' : 'success'" size="small">
                                                    {{ scope.row.status === 'pending' ? 'å¾…å›å¤' : scope.row.status === 'processing' ? 'å¤„ç†ä¸­' : 'å·²å®Œæˆ' }}
                                                </el-tag>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="æœ€åæ›´æ–°" width="160">
                                            <template #default="scope">{{ formatDateTime(scope.row.updated_at) }}</template>
                                        </el-table-column>
                                        <el-table-column label="æ“ä½œ" width="150">
                                            <template #default="scope">
                                                <el-button link type="primary" size="small" @click="openChatDialog(scope.row)">å›å¤</el-button>
                                                <el-button v-if="scope.row.status !== 'completed'" link type="success" size="small" @click="closeChat(scope.row)">å®Œæˆ</el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                </div>
                            </el-tab-pane>
                            <el-tab-pane label="å¸¸ç”¨è¯­ç®¡ç†" name="phrases">
                                <div class="content-card">
                                    <div style="margin-bottom: 16px; display: flex; justify-content: flex-end;">
                                        <el-button type="primary" @click="showPhraseDialog()"><el-icon><plus /></el-icon> æ·»åŠ å¸¸ç”¨è¯­</el-button>
                                    </div>
                                    <el-table :data="phraseList">
                                        <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                        <el-table-column prop="title" label="æ ‡é¢˜" width="150"></el-table-column>
                                        <el-table-column prop="content" label="å†…å®¹" show-overflow-tooltip></el-table-column>
                                        <el-table-column prop="category" label="åˆ†ç±»" width="100"></el-table-column>
                                        <el-table-column prop="use_count" label="ä½¿ç”¨æ¬¡æ•°" width="100"></el-table-column>
                                        <el-table-column label="æ“ä½œ" width="150">
                                            <template #default="scope">
                                                <el-button link type="primary" size="small" @click="showPhraseDialog(scope.row)">ç¼–è¾‘</el-button>
                                                <el-button link type="danger" size="small" @click="deletePhrase(scope.row.id)">åˆ é™¤</el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                </div>
                            </el-tab-pane>
                        </el-tabs>
                        <!-- å¸¸ç”¨è¯­å¯¹è¯æ¡† -->
                        <el-dialog v-model="phraseDialogVisible" :title="phraseForm.id ? 'ç¼–è¾‘å¸¸ç”¨è¯­' : 'æ·»åŠ å¸¸ç”¨è¯­'" width="500px">
                            <el-form :model="phraseForm" label-width="80px">
                                <el-form-item label="æ ‡é¢˜" required><el-input v-model="phraseForm.title"></el-input></el-form-item>
                                <el-form-item label="åˆ†ç±»">
                                    <el-select v-model="phraseForm.category" style="width: 100%;">
                                        <el-option label="é—®å€™è¯­" value="greeting"></el-option>
                                        <el-option label="å¸¸è§é—®é¢˜" value="faq"></el-option>
                                        <el-option label="å”®åæœåŠ¡" value="after_sales"></el-option>
                                        <el-option label="å…¶ä»–" value="other"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="å†…å®¹" required><el-input v-model="phraseForm.content" type="textarea" :rows="4"></el-input></el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="phraseDialogVisible = false">å–æ¶ˆ</el-button>
                                <el-button type="primary" @click="savePhrase">ä¿å­˜</el-button>
                            </template>
                        </el-dialog>
                        <!-- èŠå¤©å¯¹è¯æ¡† -->
                        <el-dialog v-model="chatDialogVisible" title="å®¢æœå¯¹è¯" width="600px">
                            <div v-if="currentChat" style="height: 400px; display: flex; flex-direction: column;">
                                <div style="flex: 1; overflow-y: auto; padding: 10px; background: #f5f5f5; border-radius: 4px;">
                                    <div v-for="msg in currentChat.messages" :key="msg.id" :style="{ textAlign: msg.is_staff ? 'right' : 'left', marginBottom: '10px' }">
                                        <div :style="{ display: 'inline-block', padding: '8px 12px', borderRadius: '8px', maxWidth: '70%', background: msg.is_staff ? '#409eff' : '#fff', color: msg.is_staff ? '#fff' : '#333' }">
                                            {{ msg.content }}
                                        </div>
                                        <div style="font-size: 12px; color: #999; margin-top: 4px;">{{ formatDateTime(msg.created_at) }}</div>
                                    </div>
                                </div>
                                <div style="margin-top: 10px; display: flex; gap: 10px;">
                                    <el-select v-model="selectedPhrase" placeholder="é€‰æ‹©å¸¸ç”¨è¯­" style="width: 200px;" @change="usePhrase" clearable>
                                        <el-option v-for="p in phraseList" :key="p.id" :label="p.title" :value="p.content"></el-option>
                                    </el-select>
                                    <el-input v-model="replyContent" placeholder="è¾“å…¥å›å¤å†…å®¹..." style="flex: 1;"></el-input>
                                    <el-button type="primary" @click="sendReply">å‘é€</el-button>
                                </div>
                            </div>
                        </el-dialog>
                    </div>

                    <!-- è½®æ’­å›¾ç®¡ç† -->
                    <div v-show="activeMenu === 'banners'">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>ğŸ–¼ï¸ è½®æ’­å›¾ç®¡ç†</h3>
                            <el-button type="primary" @click="showBannerDialog()"><el-icon><plus /></el-icon> æ·»åŠ è½®æ’­å›¾</el-button>
                        </div>
                        <div class="content-card">
                            <el-table :data="bannerList" v-loading="bannerLoading">
                                <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                <el-table-column label="å›¾ç‰‡" width="200">
                                    <template #default="scope">
                                        <el-image :src="scope.row.image" style="width: 150px; height: 60px;" fit="cover"></el-image>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="title" label="æ ‡é¢˜" width="150"></el-table-column>
                                <el-table-column prop="link" label="é“¾æ¥" show-overflow-tooltip></el-table-column>
                                <el-table-column prop="sort_order" label="æ’åº" width="80"></el-table-column>
                                <el-table-column label="çŠ¶æ€" width="80">
                                    <template #default="scope">
                                        <el-switch v-model="scope.row.is_active" @change="toggleBannerStatus(scope.row)"></el-switch>
                                    </template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="150">
                                    <template #default="scope">
                                        <el-button link type="primary" size="small" @click="showBannerDialog(scope.row)">ç¼–è¾‘</el-button>
                                        <el-button link type="danger" size="small" @click="deleteBanner(scope.row.id)">åˆ é™¤</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </div>
                        <!-- è½®æ’­å›¾å¯¹è¯æ¡† -->
                        <el-dialog v-model="bannerDialogVisible" :title="bannerForm.id ? 'ç¼–è¾‘è½®æ’­å›¾' : 'æ·»åŠ è½®æ’­å›¾'" width="550px">
                            <el-form :model="bannerForm" label-width="80px">
                                <el-form-item label="æ ‡é¢˜"><el-input v-model="bannerForm.title"></el-input></el-form-item>
                                <el-form-item label="å›¾ç‰‡" required>
                                    <el-input v-model="bannerForm.image" placeholder="å›¾ç‰‡URL"></el-input>
                                    <el-upload :action="uploadUrl" :headers="uploadHeaders" :on-success="handleBannerUpload" :show-file-list="false" accept="image/*" style="margin-top: 10px;">
                                        <el-button size="small" type="primary">ä¸Šä¼ å›¾ç‰‡</el-button>
                                    </el-upload>
                                    <el-image v-if="bannerForm.image" :src="bannerForm.image" style="width: 100%; max-height: 120px; margin-top: 10px;" fit="contain"></el-image>
                                </el-form-item>
                                <el-form-item label="é“¾æ¥"><el-input v-model="bannerForm.link" placeholder="ç‚¹å‡»è·³è½¬é“¾æ¥"></el-input></el-form-item>
                                <el-form-item label="æ’åº"><el-input-number v-model="bannerForm.sort_order" :min="0"></el-input-number></el-form-item>
                                <el-form-item label="å¯ç”¨"><el-switch v-model="bannerForm.is_active"></el-switch></el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="bannerDialogVisible = false">å–æ¶ˆ</el-button>
                                <el-button type="primary" @click="saveBanner">ä¿å­˜</el-button>
                            </template>
                        </el-dialog>
                    </div>

                    <!-- å…¬å‘Šç®¡ç† -->
                    <div v-show="activeMenu === 'announcements'">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>ğŸ“¢ å…¬å‘Šç®¡ç†</h3>
                            <el-button type="primary" @click="showAnnouncementDialog()"><el-icon><plus /></el-icon> å‘å¸ƒå…¬å‘Š</el-button>
                        </div>
                        <div class="content-card">
                            <el-table :data="announcementList" v-loading="announcementLoading">
                                <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                <el-table-column prop="title" label="æ ‡é¢˜" width="200"></el-table-column>
                                <el-table-column prop="content" label="å†…å®¹" show-overflow-tooltip></el-table-column>
                                <el-table-column label="ç±»å‹" width="80">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.type === 'important' ? 'danger' : scope.row.type === 'notice' ? 'warning' : 'info'" size="small">
                                            {{ scope.row.type === 'important' ? 'é‡è¦' : scope.row.type === 'notice' ? 'é€šçŸ¥' : 'æ™®é€š' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="çŠ¶æ€" width="80">
                                    <template #default="scope">
                                        <el-switch v-model="scope.row.is_active" @change="toggleAnnouncementStatus(scope.row)"></el-switch>
                                    </template>
                                </el-table-column>
                                <el-table-column label="å‘å¸ƒæ—¶é—´" width="160">
                                    <template #default="scope">{{ formatDateTime(scope.row.created_at) }}</template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="150">
                                    <template #default="scope">
                                        <el-button link type="primary" size="small" @click="showAnnouncementDialog(scope.row)">ç¼–è¾‘</el-button>
                                        <el-button link type="danger" size="small" @click="deleteAnnouncement(scope.row.id)">åˆ é™¤</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </div>
                        <!-- å…¬å‘Šå¯¹è¯æ¡† -->
                        <el-dialog v-model="announcementDialogVisible" :title="announcementForm.id ? 'ç¼–è¾‘å…¬å‘Š' : 'å‘å¸ƒå…¬å‘Š'" width="600px">
                            <el-form :model="announcementForm" label-width="80px">
                                <el-form-item label="æ ‡é¢˜" required><el-input v-model="announcementForm.title"></el-input></el-form-item>
                                <el-form-item label="ç±»å‹">
                                    <el-select v-model="announcementForm.type" style="width: 100%;">
                                        <el-option label="æ™®é€š" value="normal"></el-option>
                                        <el-option label="é€šçŸ¥" value="notice"></el-option>
                                        <el-option label="é‡è¦" value="important"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="å†…å®¹" required><el-input v-model="announcementForm.content" type="textarea" :rows="6"></el-input></el-form-item>
                                <el-form-item label="ç«‹å³å‘å¸ƒ"><el-switch v-model="announcementForm.is_active"></el-switch></el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="announcementDialogVisible = false">å–æ¶ˆ</el-button>
                                <el-button type="primary" @click="saveAnnouncement">ä¿å­˜</el-button>
                            </template>
                        </el-dialog>
                    </div>

                    <!-- å¸®åŠ©ä¸­å¿ƒ -->
                    <div v-show="activeMenu === 'help'">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>â“ å¸®åŠ©ä¸­å¿ƒ</h3>
                            <el-button type="primary" @click="showHelpDialog()"><el-icon><plus /></el-icon> æ·»åŠ æ–‡ç« </el-button>
                        </div>
                        <div class="content-card">
                            <div style="margin-bottom: 16px;">
                                <el-select v-model="helpCategoryFilter" placeholder="åˆ†ç±»ç­›é€‰" style="width: 150px;" clearable>
                                    <el-option label="ä½¿ç”¨æŒ‡å—" value="guide"></el-option>
                                    <el-option label="å¸¸è§é—®é¢˜" value="faq"></el-option>
                                    <el-option label="æœåŠ¡åè®®" value="agreement"></el-option>
                                </el-select>
                            </div>
                            <el-table :data="helpList" v-loading="helpLoading">
                                <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                <el-table-column prop="title" label="æ ‡é¢˜" width="250"></el-table-column>
                                <el-table-column prop="category_text" label="åˆ†ç±»" width="100"></el-table-column>
                                <el-table-column prop="view_count" label="é˜…è¯»é‡" width="100"></el-table-column>
                                <el-table-column prop="sort_order" label="æ’åº" width="80"></el-table-column>
                                <el-table-column label="çŠ¶æ€" width="80">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.is_active ? 'success' : 'info'" size="small">{{ scope.row.is_active ? 'æ˜¾ç¤º' : 'éšè—' }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="150">
                                    <template #default="scope">
                                        <el-button link type="primary" size="small" @click="showHelpDialog(scope.row)">ç¼–è¾‘</el-button>
                                        <el-button link type="danger" size="small" @click="deleteHelp(scope.row.id)">åˆ é™¤</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </div>
                        <!-- å¸®åŠ©æ–‡ç« å¯¹è¯æ¡† -->
                        <el-dialog v-model="helpDialogVisible" :title="helpForm.id ? 'ç¼–è¾‘æ–‡ç« ' : 'æ·»åŠ æ–‡ç« '" width="700px">
                            <el-form :model="helpForm" label-width="80px">
                                <el-form-item label="æ ‡é¢˜" required><el-input v-model="helpForm.title"></el-input></el-form-item>
                                <el-form-item label="åˆ†ç±»" required>
                                    <el-select v-model="helpForm.category" style="width: 100%;">
                                        <el-option label="ä½¿ç”¨æŒ‡å—" value="guide"></el-option>
                                        <el-option label="å¸¸è§é—®é¢˜" value="faq"></el-option>
                                        <el-option label="æœåŠ¡åè®®" value="agreement"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="å†…å®¹" required><el-input v-model="helpForm.content" type="textarea" :rows="10"></el-input></el-form-item>
                                <el-form-item label="æ’åº"><el-input-number v-model="helpForm.sort_order" :min="0"></el-input-number></el-form-item>
                                <el-form-item label="æ˜¾ç¤º"><el-switch v-model="helpForm.is_active"></el-switch></el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="helpDialogVisible = false">å–æ¶ˆ</el-button>
                                <el-button type="primary" @click="saveHelp">ä¿å­˜</el-button>
                            </template>
                        </el-dialog>
                    </div>

                    <!-- åŠ ç›Ÿç®¡ç† -->
                    <div v-show="activeMenu === 'franchise'">
                        <div class="page-header">
                            <h3>ğŸ¤ åŠ ç›Ÿç®¡ç†</h3>
                        </div>
                        <el-tabs v-model="franchiseTab">
                            <el-tab-pane label="åŠ ç›Ÿç”³è¯·" name="applications">
                                <div class="content-card">
                                    <div style="margin-bottom: 16px;">
                                        <el-select v-model="franchiseStatusFilter" placeholder="çŠ¶æ€ç­›é€‰" style="width: 120px;" clearable>
                                            <el-option label="å¾…å®¡æ ¸" value="pending"></el-option>
                                            <el-option label="å·²é€šè¿‡" value="approved"></el-option>
                                            <el-option label="å·²æ‹’ç»" value="rejected"></el-option>
                                        </el-select>
                                    </div>
                                    <el-table :data="franchiseApplicationList" v-loading="franchiseLoading">
                                        <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                        <el-table-column prop="company_name" label="å…¬å¸åç§°" width="180"></el-table-column>
                                        <el-table-column prop="contact_name" label="è”ç³»äºº" width="100"></el-table-column>
                                        <el-table-column prop="contact_phone" label="è”ç³»ç”µè¯" width="130"></el-table-column>
                                        <el-table-column prop="city" label="æ‰€åœ¨åŸå¸‚" width="120"></el-table-column>
                                        <el-table-column prop="business_type" label="ç»è¥ç±»å‹" width="100"></el-table-column>
                                        <el-table-column label="çŠ¶æ€" width="80">
                                            <template #default="scope">
                                                <el-tag :type="scope.row.status === 'pending' ? 'warning' : scope.row.status === 'approved' ? 'success' : 'danger'" size="small">
                                                    {{ scope.row.status === 'pending' ? 'å¾…å®¡æ ¸' : scope.row.status === 'approved' ? 'å·²é€šè¿‡' : 'å·²æ‹’ç»' }}
                                                </el-tag>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="ç”³è¯·æ—¶é—´" width="160">
                                            <template #default="scope">{{ formatDateTime(scope.row.created_at) }}</template>
                                        </el-table-column>
                                        <el-table-column label="æ“ä½œ" width="180">
                                            <template #default="scope">
                                                <template v-if="scope.row.status === 'pending'">
                                                    <el-button link type="success" size="small" @click="approveFranchise(scope.row)">é€šè¿‡</el-button>
                                                    <el-button link type="danger" size="small" @click="rejectFranchise(scope.row)">æ‹’ç»</el-button>
                                                </template>
                                                <el-button link type="primary" size="small" @click="viewFranchiseDetail(scope.row)">è¯¦æƒ…</el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                </div>
                            </el-tab-pane>
                            <el-tab-pane label="åŠ ç›Ÿå•†ç®¡ç†" name="franchisees">
                                <div class="content-card">
                                    <el-table :data="franchiseeList" v-loading="franchiseLoading">
                                        <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                        <el-table-column prop="company_name" label="å…¬å¸åç§°" width="180"></el-table-column>
                                        <el-table-column prop="contact_name" label="è”ç³»äºº" width="100"></el-table-column>
                                        <el-table-column prop="contact_phone" label="è”ç³»ç”µè¯" width="130"></el-table-column>
                                        <el-table-column label="ç´¯è®¡è®¢å•" width="100">
                                            <template #default="scope">{{ scope.row.order_count }}å•</template>
                                        </el-table-column>
                                        <el-table-column label="ç´¯è®¡é‡‘é¢" width="120">
                                            <template #default="scope"><span style="color: #ff4d4f;">Â¥{{ scope.row.total_amount }}</span></template>
                                        </el-table-column>
                                        <el-table-column label="çŠ¶æ€" width="80">
                                            <template #default="scope">
                                                <el-tag :type="scope.row.is_active ? 'success' : 'danger'" size="small">{{ scope.row.is_active ? 'æ­£å¸¸' : 'åœç”¨' }}</el-tag>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="åŠ ç›Ÿæ—¶é—´" width="160">
                                            <template #default="scope">{{ formatDateTime(scope.row.joined_at) }}</template>
                                        </el-table-column>
                                        <el-table-column label="æ“ä½œ" width="150">
                                            <template #default="scope">
                                                <el-button link type="primary" size="small" @click="editFranchisee(scope.row)">ç¼–è¾‘</el-button>
                                                <el-button link :type="scope.row.is_active ? 'danger' : 'success'" size="small" @click="toggleFranchiseeStatus(scope.row)">
                                                    {{ scope.row.is_active ? 'åœç”¨' : 'å¯ç”¨' }}
                                                </el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                </div>
                            </el-tab-pane>
                        </el-tabs>
                    </div>

                    <!-- æ•°æ®åˆ†æ -->
                    <div v-show="activeMenu === 'analytics'">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>ğŸ“ˆ æ•°æ®åˆ†æ</h3>
                            <el-button type="primary" @click="exportAnalyticsData"><el-icon><download /></el-icon> å¯¼å‡ºæŠ¥è¡¨</el-button>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <el-date-picker v-model="analyticsDateRange" type="daterange" range-separator="è‡³" start-placeholder="å¼€å§‹æ—¥æœŸ" end-placeholder="ç»“æŸæ—¥æœŸ" @change="loadAnalyticsData"></el-date-picker>
                        </div>
                        <el-row :gutter="16" style="margin-bottom: 16px;">
                            <el-col :span="16">
                                <div class="content-card">
                                    <h4 style="margin-bottom: 16px;">ğŸ“Š è®¢å•è¶‹åŠ¿</h4>
                                    <div style="display: flex; height: 250px; align-items: flex-end; gap: 8px; padding: 0 10px;">
                                        <div v-for="item in analyticsData.orderTrends || []" :key="item.date" style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                            <div :style="{ width: '100%', height: Math.max((item.count / maxAnalyticsOrderCount) * 200, 5) + 'px', background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', borderRadius: '4px 4px 0 0' }"></div>
                                            <div style="font-size: 11px; color: #666; margin-top: 6px; transform: rotate(-45deg); white-space: nowrap;">{{ item.date }}</div>
                                        </div>
                                    </div>
                                </div>
                            </el-col>
                            <el-col :span="8">
                                <div class="content-card">
                                    <h4 style="margin-bottom: 16px;">ğŸ”¬ é¡¹ç›®åˆ†ç±»å æ¯”</h4>
                                    <div v-for="item in analyticsData.categoryDistribution || []" :key="item.category" style="margin-bottom: 12px;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                            <span>{{ item.category }}</span>
                                            <span style="font-weight: 600;">{{ item.percentage }}%</span>
                                        </div>
                                        <el-progress :percentage="item.percentage" :show-text="false" :color="item.color"></el-progress>
                                    </div>
                                </div>
                            </el-col>
                        </el-row>
                        <el-row :gutter="16">
                            <el-col :span="12">
                                <div class="content-card">
                                    <h4 style="margin-bottom: 16px;">ğŸ‘¥ ç”¨æˆ·å¢é•¿</h4>
                                    <el-descriptions :column="2" border size="small">
                                        <el-descriptions-item label="æœ¬æœˆæ–°å¢">{{ analyticsData.userGrowth?.thisMonth || 0 }}</el-descriptions-item>
                                        <el-descriptions-item label="ä¸Šæœˆæ–°å¢">{{ analyticsData.userGrowth?.lastMonth || 0 }}</el-descriptions-item>
                                        <el-descriptions-item label="ç¯æ¯”å¢é•¿">
                                            <span :style="{ color: analyticsData.userGrowth?.growthRate >= 0 ? '#52c41a' : '#ff4d4f' }">
                                                {{ analyticsData.userGrowth?.growthRate >= 0 ? '+' : '' }}{{ analyticsData.userGrowth?.growthRate || 0 }}%
                                            </span>
                                        </el-descriptions-item>
                                        <el-descriptions-item label="æ´»è·ƒç”¨æˆ·">{{ analyticsData.userGrowth?.activeUsers || 0 }}</el-descriptions-item>
                                    </el-descriptions>
                                </div>
                            </el-col>
                            <el-col :span="12">
                                <div class="content-card">
                                    <h4 style="margin-bottom: 16px;">ğŸ’° æ”¶å…¥åˆ†æ</h4>
                                    <el-descriptions :column="2" border size="small">
                                        <el-descriptions-item label="æœ¬æœˆæ”¶å…¥">Â¥{{ analyticsData.revenueAnalysis?.thisMonth || 0 }}</el-descriptions-item>
                                        <el-descriptions-item label="ä¸Šæœˆæ”¶å…¥">Â¥{{ analyticsData.revenueAnalysis?.lastMonth || 0 }}</el-descriptions-item>
                                        <el-descriptions-item label="ç¯æ¯”å¢é•¿">
                                            <span :style="{ color: analyticsData.revenueAnalysis?.growthRate >= 0 ? '#52c41a' : '#ff4d4f' }">
                                                {{ analyticsData.revenueAnalysis?.growthRate >= 0 ? '+' : '' }}{{ analyticsData.revenueAnalysis?.growthRate || 0 }}%
                                            </span>
                                        </el-descriptions-item>
                                        <el-descriptions-item label="å¹³å‡å®¢å•ä»·">Â¥{{ analyticsData.revenueAnalysis?.avgOrderValue || 0 }}</el-descriptions-item>
                                    </el-descriptions>
                                </div>
                            </el-col>
                        </el-row>
                    </div>

                    <!-- æŠ˜æ‰£è®¾ç½® -->
                    <div v-show="activeMenu === 'discounts'">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>ğŸ·ï¸ æŠ˜æ‰£è®¾ç½®</h3>
                            <el-button type="primary" @click="showDiscountDialog()"><el-icon><plus /></el-icon> æ·»åŠ æŠ˜æ‰£</el-button>
                        </div>
                        <div class="content-card">
                            <el-table :data="discountList" v-loading="discountLoading">
                                <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                <el-table-column prop="name" label="æŠ˜æ‰£åç§°" width="150"></el-table-column>
                                <el-table-column label="æŠ˜æ‰£åŠ›åº¦" width="100">
                                    <template #default="scope"><span style="color: #ff4d4f; font-weight: 600;">{{ (scope.row.discount_rate * 10).toFixed(1) }}æŠ˜</span></template>
                                </el-table-column>
                                <el-table-column prop="apply_to" label="é€‚ç”¨èŒƒå›´" width="150"></el-table-column>
                                <el-table-column label="æœ‰æ•ˆæœŸ" width="200">
                                    <template #default="scope">{{ scope.row.start_date }} ~ {{ scope.row.end_date }}</template>
                                </el-table-column>
                                <el-table-column label="çŠ¶æ€" width="80">
                                    <template #default="scope">
                                        <el-switch v-model="scope.row.is_active" @change="toggleDiscountStatus(scope.row)"></el-switch>
                                    </template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="150">
                                    <template #default="scope">
                                        <el-button link type="primary" size="small" @click="showDiscountDialog(scope.row)">ç¼–è¾‘</el-button>
                                        <el-button link type="danger" size="small" @click="deleteDiscount(scope.row.id)">åˆ é™¤</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </div>
                        <!-- æŠ˜æ‰£å¯¹è¯æ¡† -->
                        <el-dialog v-model="discountDialogVisible" :title="discountForm.id ? 'ç¼–è¾‘æŠ˜æ‰£' : 'æ·»åŠ æŠ˜æ‰£'" width="550px">
                            <el-form :model="discountForm" label-width="100px">
                                <el-form-item label="æŠ˜æ‰£åç§°" required><el-input v-model="discountForm.name"></el-input></el-form-item>
                                <el-form-item label="æŠ˜æ‰£åŠ›åº¦" required>
                                    <el-input-number v-model="discountForm.discount_rate" :min="0.1" :max="0.99" :step="0.1" :precision="2"></el-input-number>
                                    <span style="margin-left: 8px;">å¦‚0.8è¡¨ç¤º8æŠ˜</span>
                                </el-form-item>
                                <el-form-item label="é€‚ç”¨èŒƒå›´">
                                    <el-select v-model="discountForm.apply_to" style="width: 100%;">
                                        <el-option label="å…¨éƒ¨é¡¹ç›®" value="all"></el-option>
                                        <el-option label="æŒ‡å®šåˆ†ç±»" value="category"></el-option>
                                        <el-option label="æŒ‡å®šé¡¹ç›®" value="project"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="æœ‰æ•ˆæœŸ" required>
                                    <el-date-picker v-model="discountForm.dateRange" type="daterange" range-separator="è‡³" start-placeholder="å¼€å§‹æ—¥æœŸ" end-placeholder="ç»“æŸæ—¥æœŸ" style="width: 100%;"></el-date-picker>
                                </el-form-item>
                                <el-form-item label="å¯ç”¨"><el-switch v-model="discountForm.is_active"></el-switch></el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="discountDialogVisible = false">å–æ¶ˆ</el-button>
                                <el-button type="primary" @click="saveDiscount">ä¿å­˜</el-button>
                            </template>
                        </el-dialog>
                    </div>

                    <!-- æŠ½å¥–æ´»åŠ¨ -->
                    <div v-show="activeMenu === 'lottery'">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>ğŸ° æŠ½å¥–æ´»åŠ¨</h3>
                            <el-button type="primary" @click="showLotteryDialog()"><el-icon><plus /></el-icon> åˆ›å»ºæ´»åŠ¨</el-button>
                        </div>
                        <div class="content-card">
                            <el-table :data="lotteryList" v-loading="lotteryLoading">
                                <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                <el-table-column prop="name" label="æ´»åŠ¨åç§°" width="180"></el-table-column>
                                <el-table-column label="æ´»åŠ¨æ—¶é—´" width="200">
                                    <template #default="scope">{{ scope.row.start_date }} ~ {{ scope.row.end_date }}</template>
                                </el-table-column>
                                <el-table-column prop="total_participants" label="å‚ä¸äººæ•°" width="100"></el-table-column>
                                <el-table-column prop="total_prizes" label="å‘æ”¾å¥–å“" width="100"></el-table-column>
                                <el-table-column label="çŠ¶æ€" width="80">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.status === 'active' ? 'success' : scope.row.status === 'pending' ? 'warning' : 'info'" size="small">
                                            {{ scope.row.status === 'active' ? 'è¿›è¡Œä¸­' : scope.row.status === 'pending' ? 'æœªå¼€å§‹' : 'å·²ç»“æŸ' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="200">
                                    <template #default="scope">
                                        <el-button link type="primary" size="small" @click="showLotteryDialog(scope.row)">ç¼–è¾‘</el-button>
                                        <el-button link type="success" size="small" @click="viewLotteryPrizes(scope.row)">å¥–å“</el-button>
                                        <el-button link type="warning" size="small" @click="viewLotteryRecords(scope.row)">è®°å½•</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </div>
                    </div>

                    <!-- äºŒç»´ç æ¨å¹¿ -->
                    <div v-show="activeMenu === 'qrcode'">
                        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h3>ğŸ“± äºŒç»´ç æ¨å¹¿</h3>
                            <el-button type="primary" @click="showQrcodeDialog()"><el-icon><plus /></el-icon> ç”ŸæˆäºŒç»´ç </el-button>
                        </div>
                        <div class="content-card">
                            <el-table :data="qrcodeList" v-loading="qrcodeLoading">
                                <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                <el-table-column label="äºŒç»´ç " width="100">
                                    <template #default="scope">
                                        <el-image :src="scope.row.qrcode_url" style="width: 60px; height: 60px;" fit="contain"></el-image>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="name" label="åç§°" width="150"></el-table-column>
                                <el-table-column prop="scene" label="åœºæ™¯" width="100"></el-table-column>
                                <el-table-column prop="scan_count" label="æ‰«ç æ¬¡æ•°" width="100"></el-table-column>
                                <el-table-column prop="register_count" label="æ³¨å†Œäººæ•°" width="100"></el-table-column>
                                <el-table-column label="åˆ›å»ºæ—¶é—´" width="160">
                                    <template #default="scope">{{ formatDateTime(scope.row.created_at) }}</template>
                                </el-table-column>
                                <el-table-column label="æ“ä½œ" width="200">
                                    <template #default="scope">
                                        <el-button link type="primary" size="small" @click="downloadQrcode(scope.row)">ä¸‹è½½</el-button>
                                        <el-button link type="success" size="small" @click="copyQrcodeLink(scope.row)">å¤åˆ¶é“¾æ¥</el-button>
                                        <el-button link type="danger" size="small" @click="deleteQrcode(scope.row.id)">åˆ é™¤</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </div>
                        <!-- äºŒç»´ç å¯¹è¯æ¡† -->
                        <el-dialog v-model="qrcodeDialogVisible" title="ç”Ÿæˆæ¨å¹¿äºŒç»´ç " width="500px">
                            <el-form :model="qrcodeForm" label-width="80px">
                                <el-form-item label="åç§°" required><el-input v-model="qrcodeForm.name" placeholder="å¦‚ï¼šçº¿ä¸‹å±•ä¼šæ¨å¹¿"></el-input></el-form-item>
                                <el-form-item label="åœºæ™¯" required>
                                    <el-select v-model="qrcodeForm.scene" style="width: 100%;">
                                        <el-option label="æ¨å¹¿æ³¨å†Œ" value="register"></el-option>
                                        <el-option label="æ´»åŠ¨é¡µé¢" value="activity"></el-option>
                                        <el-option label="æŒ‡å®šé¡¹ç›®" value="project"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="å…³è”å†…å®¹" v-if="qrcodeForm.scene === 'project'">
                                    <el-select v-model="qrcodeForm.target_id" style="width: 100%;">
                                        <el-option v-for="p in projects" :key="p.id" :label="p.name" :value="p.id"></el-option>
                                    </el-select>
                                </el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="qrcodeDialogVisible = false">å–æ¶ˆ</el-button>
                                <el-button type="primary" @click="generateQrcode">ç”Ÿæˆ</el-button>
                            </template>
                        </el-dialog>
                    </div>
                </el-main>
            </el-container>
        </el-container>
    </div>

    <script>
        const { createApp } = Vue
        const { ElMessage, ElMessageBox } = ElementPlus

        createApp({
            data() {
                return {
                    baseUrl: 'http://8.148.188.85:3000',
                    token: localStorage.getItem('admin_token') || '',
                    userInfo: JSON.parse(localStorage.getItem('admin_user') || '{}'),
                    loginType: 'admin',
                    adminLoginForm: { username: '', password: '' },
                    loginForm: { phone: '', sms_code: '' },
                    countdown: 0,
                    loading: false,
                    activeMenu: 'dashboard',
                    uploadedImages: [],
                    // ä»ªè¡¨ç›˜
                    dashboardData: {},
                    // ç”¨æˆ·ç®¡ç†
                    users: [],
                    usersLoading: false,
                    userSearch: '',
                    userPage: 1,
                    userPageSize: 20,
                    userTotal: 0,
                    userDialogVisible: false,
                    selectedUser: null,
                    avatarUploadVisible: false,
                    currentEditUserId: null,
                    // é¡¹ç›®ç®¡ç†
                    projects: [],
                    projectsLoading: false,
                    projectSearch: '',
                    projectCategoryFilter: null,
                    projectPage: 1,
                    projectPageSize: 20,
                    projectTotal: 0,
                    projectDialogVisible: false,
                    projectForm: { id: null, name: '', project_no: '', category_id: null, description: '', original_price: '', current_price: '', cover_image: '', is_hot: false, is_recommended: false, status: 'active' },
                    categories: [],
                    // è®¢å•ç®¡ç†
                    orders: [],
                    ordersLoading: false,
                    orderSearch: '',
                    orderStatusFilter: null,
                    orderAssigneeFilter: null,
                    orderPage: 1,
                    orderPageSize: 20,
                    orderTotal: 0,
                    selectedOrders: [],
                    assignDialogVisible: false,
                    assignForm: { order_no: '', order_ids: [], assignee_id: null, remark: '' },
                    labStaffList: [
                        { id: 1, name: 'å¼ å·¥', department: 'ææ–™è¡¨å¾å®éªŒå®¤' },
                        { id: 2, name: 'æå·¥', department: 'ç”Ÿç‰©ç§‘å­¦å®éªŒå®¤' },
                        { id: 3, name: 'ç‹å·¥', department: 'ç¯å¢ƒæ£€æµ‹å®éªŒå®¤' },
                        { id: 4, name: 'èµµå·¥', department: 'æ•°æ®åˆ†æç»„' }
                    ],
                    // åˆ†ç±»ç®¡ç†
                    categoryList: [],
                    categoryLoading: false,
                    categorySearch: '',
                    categoryPage: 1,
                    categoryPageSize: 20,
                    categoryTotal: 0,
                    categoryDialogVisible: false,
                    categoryForm: { id: null, name: '', code: '', icon: '', description: '', sort_order: 0, is_hot: false },
                    // ä¼˜æƒ åˆ¸ç®¡ç†
                    couponList: [],
                    couponLoading: false,
                    couponSearch: '',
                    couponPage: 1,
                    couponPageSize: 20,
                    couponTotal: 0,
                    couponDialogVisible: false,
                    couponForm: { id: null, name: '', type: 'cash', description: '', cash_amount: 10, discount_rate: 0.9, full_amount: 100, reduction_amount: 10, min_order_amount: 0, total_quantity: 0, valid_days: 30 },
                    sendCouponDialogVisible: false,
                    sendCouponForm: { coupon_id: null, send_type: 'phone', phones: '', user_group: '', quantity: 1, remark: '' },
                    // å……å€¼ç®¡ç†
                    rechargeList: [],
                    rechargeLoading: false,
                    rechargeSearch: '',
                    rechargeStatusFilter: null,
                    rechargePage: 1,
                    rechargePageSize: 20,
                    rechargeTotal: 0,
                    // ç§¯åˆ†å•†å“ç®¡ç†
                    pointsGoodsList: [],
                    pointsGoodsLoading: false,
                    pointsGoodsSearch: '',
                    pointsGoodsCategoryFilter: null,
                    pointsGoodsPage: 1,
                    pointsGoodsPageSize: 20,
                    pointsGoodsTotal: 0,
                    pointsGoodsDialogVisible: false,
                    pointsGoodsForm: { id: null, name: '', points: 100, category: 'ä¼˜æƒ åˆ¸', image: '', description: '', stock: 0, sort_order: 0 },
                    // è¯„ä»·ç®¡ç†
                    reviewList: [],
                    reviewLoading: false,
                    reviewStatusFilter: null,
                    reviewPage: 1,
                    reviewPageSize: 20,
                    reviewTotal: 0,
                    // å›¢ä½“ç®¡ç†
                    groupList: [],
                    groupLoading: false,
                    groupSearch: '',
                    groupPage: 1,
                    groupPageSize: 20,
                    groupTotal: 0,
                    // é‚€è¯·ç®¡ç†
                    inviteTab: 'records',
                    inviteList: [],
                    inviteLoading: false,
                    inviteSearch: '',
                    invitePage: 1,
                    invitePageSize: 20,
                    inviteTotal: 0,
                    withdrawList: [],
                    withdrawLoading: false,
                    withdrawStatusFilter: null,
                    withdrawPage: 1,
                    withdrawPageSize: 20,
                    withdrawTotal: 0,
                    // ç§¯åˆ†è®¾ç½®
                    pointsSettings: { ratio: 1, deductionRatio: 100 },
                    // æƒé™ç®¡ç†
                    permissionTab: 'roles',
                    roleList: [
                        { id: 1, name: 'é”€å”®', code: 'sales', description: 'é”€å”®äººå‘˜', user_count: 5, is_active: true, is_system: false },
                        { id: 2, name: 'æŠ€æœ¯è€å¸ˆ', code: 'teacher', description: 'æŠ€æœ¯æŒ‡å¯¼è€å¸ˆ', user_count: 3, is_active: true, is_system: false },
                        { id: 3, name: 'å®éªŒå®¤', code: 'lab', description: 'å®éªŒå®¤äººå‘˜', user_count: 8, is_active: true, is_system: false },
                        { id: 4, name: 'è´¢åŠ¡', code: 'finance', description: 'è´¢åŠ¡äººå‘˜', user_count: 2, is_active: true, is_system: false },
                        { id: 5, name: 'å®¢æœ', code: 'service', description: 'å®¢æœäººå‘˜', user_count: 4, is_active: true, is_system: false },
                        { id: 6, name: 'è¶…çº§ç®¡ç†å‘˜', code: 'admin', description: 'ç³»ç»Ÿç®¡ç†å‘˜', user_count: 1, is_active: true, is_system: true }
                    ],
                    roleLoading: false,
                    roleSearch: '',
                    roleDialogVisible: false,
                    roleForm: { id: null, name: '', code: '', description: '' },
                    staffList: [
                        { id: 1, name: 'å¼ ä¸‰', phone: '13800138001', role_id: 1, role_name: 'é”€å”®', department: 'é”€å”®éƒ¨', is_active: true, last_login_at: '2024-01-15 10:30:00' },
                        { id: 2, name: 'æå››', phone: '13800138002', role_id: 3, role_name: 'å®éªŒå®¤', department: 'æŠ€æœ¯éƒ¨', is_active: true, last_login_at: '2024-01-14 09:20:00' }
                    ],
                    staffLoading: false,
                    staffSearch: '',
                    staffRoleFilter: null,
                    staffDialogVisible: false,
                    staffForm: { id: null, name: '', phone: '', role_id: null, department: '', password: '' },
                    permissionDialogVisible: false,
                    currentRole: null,
                    permissionTree: [
                        { id: 'dashboard', name: 'æ•°æ®é¢æ¿', children: [] },
                        { id: 'users', name: 'ç”¨æˆ·ç®¡ç†', children: [{ id: 'users_view', name: 'æŸ¥çœ‹' }, { id: 'users_edit', name: 'ç¼–è¾‘' }] },
                        { id: 'orders', name: 'è®¢å•ç®¡ç†', children: [{ id: 'orders_view', name: 'æŸ¥çœ‹' }, { id: 'orders_edit', name: 'ç¼–è¾‘' }, { id: 'orders_assign', name: 'æŒ‡æ´¾' }] },
                        { id: 'projects', name: 'é¡¹ç›®ç®¡ç†', children: [{ id: 'projects_view', name: 'æŸ¥çœ‹' }, { id: 'projects_edit', name: 'ç¼–è¾‘' }] },
                        { id: 'finance', name: 'è´¢åŠ¡ç®¡ç†', children: [{ id: 'finance_view', name: 'æŸ¥çœ‹' }, { id: 'finance_edit', name: 'ç¼–è¾‘' }] },
                        { id: 'settings', name: 'ç³»ç»Ÿè®¾ç½®', children: [] }
                    ],
                    // é”€å”®ç®¡ç†
                    salesData: { totalRevenue: 128560, totalOrders: 356, newCustomers: 89, conversionRate: 23.5 },
                    salesLoading: false,
                    salesDateRange: null,
                    salesStaffFilter: null,
                    salesStaffList: [{ id: 1, name: 'å¼ ä¸‰' }, { id: 2, name: 'æå››' }, { id: 3, name: 'ç‹äº”' }],
                    salesRanking: [
                        { name: 'å¼ ä¸‰', department: 'é”€å”®éƒ¨', revenue: 45600, order_count: 128, customer_count: 45, completion_rate: 115 },
                        { name: 'æå››', department: 'é”€å”®éƒ¨', revenue: 38200, order_count: 96, customer_count: 32, completion_rate: 95 },
                        { name: 'ç‹äº”', department: 'é”€å”®éƒ¨', revenue: 28900, order_count: 72, customer_count: 28, completion_rate: 72 }
                    ],
                    // å®éªŒå®¤ç®¡ç†
                    labList: [
                        { id: 1, name: 'ææ–™è¡¨å¾å®éªŒå®¤', director: 'å¼ æ•™æˆ', phone: '13800138001', location: 'Aæ ‹301', equipment_count: 12, current_tasks: 5, status: 'busy' },
                        { id: 2, name: 'ç”Ÿç‰©ç§‘å­¦å®éªŒå®¤', director: 'æåšå£«', phone: '13800138002', location: 'Bæ ‹205', equipment_count: 8, current_tasks: 2, status: 'active' },
                        { id: 3, name: 'ç¯å¢ƒæ£€æµ‹å®éªŒå®¤', director: 'ç‹ç ”ç©¶å‘˜', phone: '13800138003', location: 'Cæ ‹102', equipment_count: 15, current_tasks: 0, status: 'maintenance' }
                    ],
                    labLoading: false,
                    labDialogVisible: false,
                    labForm: { id: null, name: '', director: '', phone: '', location: '', status: 'active', description: '' },
                    // ä»ªå™¨ç®¡ç†
                    equipmentList: [
                        { id: 1, equipment_no: 'EQ001', name: 'æ‰«æç”µå­æ˜¾å¾®é•œ', category: 'ææ–™è¡¨å¾', lab_id: 1, lab_name: 'ææ–™è¡¨å¾å®éªŒå®¤', brand: 'ZEISS EVO', image: '', status: 'available' },
                        { id: 2, equipment_no: 'EQ002', name: 'é€å°„ç”µå­æ˜¾å¾®é•œ', category: 'ææ–™è¡¨å¾', lab_id: 1, lab_name: 'ææ–™è¡¨å¾å®éªŒå®¤', brand: 'JEOL 2100', image: '', status: 'in_use' },
                        { id: 3, equipment_no: 'EQ003', name: 'Xå°„çº¿è¡å°„ä»ª', category: 'ç»„ç»‡æˆåˆ†', lab_id: 1, lab_name: 'ææ–™è¡¨å¾å®éªŒå®¤', brand: 'Bruker D8', image: '', status: 'available' }
                    ],
                    equipmentLoading: false,
                    equipmentSearch: '',
                    equipmentCategoryFilter: null,
                    equipmentDialogVisible: false,
                    equipmentForm: { id: null, equipment_no: '', name: '', category: '', lab_id: null, brand: '', image: '', description: '' },
                    // è´¢åŠ¡ç®¡ç†
                    financeData: { totalIncome: 256800, totalExpense: 85600, netProfit: 171200, pendingAmount: 32500 },
                    financeTab: 'income',
                    financeLoading: false,
                    financeDateRange: null,
                    incomeTypeFilter: null,
                    incomeList: [
                        { id: 1, order_no: 'ORD20240115001', type_text: 'è®¢å•æ”¶å…¥', amount: 1280, payment_method: 'å¾®ä¿¡æ”¯ä»˜', remark: 'æ£€æµ‹æœåŠ¡è´¹', created_at: '2024-01-15 14:30:00' },
                        { id: 2, order_no: 'RCH20240115001', type_text: 'å……å€¼æ”¶å…¥', amount: 5000, payment_method: 'æ”¯ä»˜å®', remark: 'é¢„ä»˜æ¬¾å……å€¼', created_at: '2024-01-15 10:20:00' }
                    ],
                    expenseList: [
                        { id: 1, category: 'è®¾å¤‡ç»´æŠ¤', amount: 3500, description: 'ç”µé•œç»´æŠ¤ä¿å…»', handler: 'æŠ€æœ¯éƒ¨', created_at: '2024-01-14 16:00:00' },
                        { id: 2, category: 'åŠå…¬è€—æ', amount: 800, description: 'æ‰“å°çº¸ã€å¢¨ç›’ç­‰', handler: 'è¡Œæ”¿éƒ¨', created_at: '2024-01-13 11:30:00' }
                    ],
                    settlementList: [
                        { id: 1, partner_name: 'åŒ—äº¬åˆä½œå®éªŒå®¤', amount: 15600, order_count: 23, status: 'pending' },
                        { id: 2, partner_name: 'ä¸Šæµ·æ£€æµ‹ä¸­å¿ƒ', amount: 8900, order_count: 12, status: 'settled' }
                    ],
                    // å‘ç¥¨ç®¡ç†
                    invoiceTab: 'applications',
                    invoiceLoading: false,
                    invoiceSearch: '',
                    invoiceStatusFilter: null,
                    invoiceList: [
                        { id: 1, invoice_no: '', order_no: 'ORD20240115001', applicant: 'å¼ ä¸‰', title: 'åŒ—äº¬ç§‘æŠ€æœ‰é™å…¬å¸', tax_no: '91110108MA01XXXXX', amount: 5680, type: 'special', status: 'pending', created_at: '2024-01-15 15:00:00' },
                        { id: 2, invoice_no: 'INV20240114001', order_no: 'ORD20240114002', applicant: 'æå››', title: 'æ¸…åå¤§å­¦', tax_no: '12100000400XXXXX', amount: 3200, type: 'normal', status: 'completed', created_at: '2024-01-14 10:30:00' }
                    ],
                    invoiceRecordList: [
                        { invoice_no: 'INV20240114001', title: 'æ¸…åå¤§å­¦', amount: 3200, type_text: 'æ™®ç¥¨', handler: 'è´¢åŠ¡-å°ç‹', invoice_at: '2024-01-14 16:00:00' }
                    ],
                    // å®¢æœç®¡ç†
                    csTab: 'chats',
                    chatList: [
                        { id: 1, user_name: 'å¼ å…ˆç”Ÿ', user_phone: '138****8001', last_message: 'è¯·é—®æ£€æµ‹æŠ¥å‘Šä»€ä¹ˆæ—¶å€™å‡ºï¼Ÿ', message_count: 5, status: 'pending', updated_at: '2024-01-15 16:30:00' },
                        { id: 2, user_name: 'æå¥³å£«', user_phone: '139****9002', last_message: 'å¥½çš„ï¼Œè°¢è°¢', message_count: 8, status: 'completed', updated_at: '2024-01-15 14:20:00' }
                    ],
                    chatLoading: false,
                    chatSearch: '',
                    chatStatusFilter: null,
                    phraseList: [
                        { id: 1, title: 'é—®å€™è¯­', content: 'æ‚¨å¥½ï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ï¼è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„ï¼Ÿ', category: 'greeting', use_count: 156 },
                        { id: 2, title: 'æ£€æµ‹å‘¨æœŸ', content: 'ä¸€èˆ¬æ£€æµ‹å‘¨æœŸä¸º5-7ä¸ªå·¥ä½œæ—¥ï¼ŒåŠ æ€¥æœåŠ¡å¯ç¼©çŸ­è‡³3ä¸ªå·¥ä½œæ—¥ã€‚', category: 'faq', use_count: 89 },
                        { id: 3, title: 'ç»“æŸè¯­', content: 'æ„Ÿè°¢æ‚¨çš„å’¨è¯¢ï¼Œç¥æ‚¨ç”Ÿæ´»æ„‰å¿«ï¼å¦‚æœ‰å…¶ä»–é—®é¢˜éšæ—¶è”ç³»æˆ‘ä»¬ã€‚', category: 'other', use_count: 120 }
                    ],
                    phraseDialogVisible: false,
                    phraseForm: { id: null, title: '', content: '', category: 'greeting' },
                    chatDialogVisible: false,
                    currentChat: null,
                    selectedPhrase: '',
                    replyContent: '',
                    // è½®æ’­å›¾ç®¡ç†
                    bannerList: [
                        { id: 1, image: 'https://via.placeholder.com/750x300?text=Banner1', title: 'æ–°ç”¨æˆ·ä¸“äº«ä¼˜æƒ ', link: '/promotion', sort_order: 1, is_active: true },
                        { id: 2, image: 'https://via.placeholder.com/750x300?text=Banner2', title: 'æ˜¥èŠ‚æ´»åŠ¨', link: '/activity', sort_order: 2, is_active: true }
                    ],
                    bannerLoading: false,
                    bannerDialogVisible: false,
                    bannerForm: { id: null, image: '', title: '', link: '', sort_order: 0, is_active: true },
                    // å…¬å‘Šç®¡ç†
                    announcementList: [
                        { id: 1, title: 'ç³»ç»Ÿå‡çº§å…¬å‘Š', content: 'ç³»ç»Ÿå°†äºæœ¬å‘¨å…­å‡Œæ™¨2ç‚¹è¿›è¡Œå‡çº§ç»´æŠ¤...', type: 'important', is_active: true, created_at: '2024-01-15 09:00:00' },
                        { id: 2, title: 'æ˜¥èŠ‚æ”¾å‡é€šçŸ¥', content: 'æ˜¥èŠ‚æœŸé—´æš‚åœæ¥å•ï¼Œå¹´åæ­£å¸¸æœåŠ¡...', type: 'notice', is_active: true, created_at: '2024-01-10 14:00:00' }
                    ],
                    announcementLoading: false,
                    announcementDialogVisible: false,
                    announcementForm: { id: null, title: '', content: '', type: 'normal', is_active: true },
                    // å¸®åŠ©ä¸­å¿ƒ
                    helpList: [
                        { id: 1, title: 'å¦‚ä½•ä¸‹å•ï¼Ÿ', category: 'guide', category_text: 'ä½¿ç”¨æŒ‡å—', view_count: 1256, sort_order: 1, is_active: true },
                        { id: 2, title: 'æ£€æµ‹æŠ¥å‘Šè¯´æ˜', category: 'faq', category_text: 'å¸¸è§é—®é¢˜', view_count: 896, sort_order: 2, is_active: true },
                        { id: 3, title: 'æœåŠ¡åè®®', category: 'agreement', category_text: 'æœåŠ¡åè®®', view_count: 562, sort_order: 3, is_active: true }
                    ],
                    helpLoading: false,
                    helpCategoryFilter: null,
                    helpDialogVisible: false,
                    helpForm: { id: null, title: '', content: '', category: 'guide', sort_order: 0, is_active: true },
                    // åŠ ç›Ÿç®¡ç†
                    franchiseTab: 'applications',
                    franchiseLoading: false,
                    franchiseStatusFilter: null,
                    franchiseApplicationList: [
                        { id: 1, company_name: 'æ·±åœ³æ£€æµ‹ç§‘æŠ€æœ‰é™å…¬å¸', contact_name: 'ç‹æ€»', contact_phone: '13800138001', city: 'æ·±åœ³', business_type: 'æ£€æµ‹æœåŠ¡', status: 'pending', created_at: '2024-01-15 11:00:00' },
                        { id: 2, company_name: 'æ­å·å®éªŒå®¤', contact_name: 'é™ˆç»ç†', contact_phone: '13800138002', city: 'æ­å·', business_type: 'å®éªŒå®¤', status: 'approved', created_at: '2024-01-10 09:30:00' }
                    ],
                    franchiseeList: [
                        { id: 1, company_name: 'æ­å·å®éªŒå®¤', contact_name: 'é™ˆç»ç†', contact_phone: '13800138002', order_count: 156, total_amount: 89600, is_active: true, joined_at: '2023-06-15 00:00:00' }
                    ],
                    // æ•°æ®åˆ†æ
                    analyticsDateRange: null,
                    analyticsData: {
                        orderTrends: [
                            { date: '01-09', count: 45 }, { date: '01-10', count: 52 }, { date: '01-11', count: 38 },
                            { date: '01-12', count: 65 }, { date: '01-13', count: 48 }, { date: '01-14', count: 72 }, { date: '01-15', count: 58 }
                        ],
                        categoryDistribution: [
                            { category: 'ææ–™è¡¨å¾', percentage: 35, color: '#409eff' },
                            { category: 'ç”Ÿç‰©ç§‘å­¦', percentage: 25, color: '#67c23a' },
                            { category: 'ç¯å¢ƒæ£€æµ‹', percentage: 20, color: '#e6a23c' },
                            { category: 'æ•°æ®åˆ†æ', percentage: 12, color: '#f56c6c' },
                            { category: 'å…¶ä»–', percentage: 8, color: '#909399' }
                        ],
                        userGrowth: { thisMonth: 256, lastMonth: 198, growthRate: 29.3, activeUsers: 1856 },
                        revenueAnalysis: { thisMonth: 128560, lastMonth: 98200, growthRate: 30.9, avgOrderValue: 361 }
                    },
                    // æŠ˜æ‰£è®¾ç½®
                    discountList: [
                        { id: 1, name: 'æ–°ç”¨æˆ·é¦–å•ä¼˜æƒ ', discount_rate: 0.9, apply_to: 'å…¨éƒ¨é¡¹ç›®', start_date: '2024-01-01', end_date: '2024-03-31', is_active: true },
                        { id: 2, name: 'ææ–™è¡¨å¾ä¸“äº«', discount_rate: 0.85, apply_to: 'ææ–™è¡¨å¾', start_date: '2024-01-15', end_date: '2024-02-15', is_active: true }
                    ],
                    discountLoading: false,
                    discountDialogVisible: false,
                    discountForm: { id: null, name: '', discount_rate: 0.9, apply_to: 'all', dateRange: null, is_active: true },
                    // æŠ½å¥–æ´»åŠ¨
                    lotteryList: [
                        { id: 1, name: 'æ–°æ˜¥æŠ½å¥–æ´»åŠ¨', start_date: '2024-01-20', end_date: '2024-02-10', total_participants: 1256, total_prizes: 89, status: 'pending' },
                        { id: 2, name: 'å‘¨å¹´åº†æ´»åŠ¨', start_date: '2023-12-01', end_date: '2023-12-31', total_participants: 3568, total_prizes: 256, status: 'ended' }
                    ],
                    lotteryLoading: false,
                    lotteryDialogVisible: false,
                    // äºŒç»´ç æ¨å¹¿
                    qrcodeList: [
                        { id: 1, qrcode_url: 'https://via.placeholder.com/100?text=QR1', name: 'çº¿ä¸‹å±•ä¼šæ¨å¹¿', scene: 'æ¨å¹¿æ³¨å†Œ', scan_count: 568, register_count: 89, created_at: '2024-01-10 10:00:00' },
                        { id: 2, qrcode_url: 'https://via.placeholder.com/100?text=QR2', name: 'å…¬ä¼—å·å¼•æµ', scene: 'æ´»åŠ¨é¡µé¢', scan_count: 1256, register_count: 156, created_at: '2024-01-05 14:30:00' }
                    ],
                    qrcodeLoading: false,
                    qrcodeDialogVisible: false,
                    qrcodeForm: { name: '', scene: 'register', target_id: null }
                }
            },
            computed: {
                uploadUrl() { return `${this.baseUrl}/api/v1/upload/image` },
                uploadHeaders() { return { 'Authorization': `Bearer ${this.token}` } },
                maxOrderCount() {
                    const orders = this.dashboardData.trends?.orders || []
                    return Math.max(...orders.map(o => o.count), 1)
                },
                totalOrders() {
                    return (this.dashboardData.order_status_distribution || []).reduce((sum, item) => sum + item.count, 0)
                },
                maxAnalyticsOrderCount() {
                    const orders = this.analyticsData.orderTrends || []
                    return Math.max(...orders.map(o => o.count), 1)
                }
            },
            mounted() {
                if (this.token) {
                    this.initializeData()
                }
            },
            methods: {
                // ==================== åˆå§‹åŒ–æ–¹æ³• ====================
                async initializeData() {
                    try {
                        // å¹¶è¡ŒåŠ è½½åŸºç¡€æ•°æ®
                        await Promise.all([
                            this.loadDashboard(),
                            this.loadCategoriesForSelect(),
                            this.loadLabStaff()
                        ])
                    } catch (error) {
                        console.error('åˆå§‹åŒ–æ•°æ®åŠ è½½å¤±è´¥', error)
                    }
                },
                handleMenuSelect(index) {
                    this.activeMenu = index
                    if (index === 'dashboard') this.loadDashboard()
                    else if (index === 'users' && this.users.length === 0) this.loadUsers()
                    else if (index === 'projects') this.loadProjects()
                    else if (index === 'orders') this.loadOrders()
                    else if (index === 'categories') this.loadCategories()
                    else if (index === 'coupons') this.loadCoupons()
                    else if (index === 'recharges') this.loadRecharges()
                    else if (index === 'points') this.loadPointsGoods()
                    else if (index === 'reviews') this.loadReviews()
                    else if (index === 'groups') this.loadGroups()
                    else if (index === 'invites') { this.loadInvites(); this.loadWithdraws() }
                    else if (index === 'permissions') this.loadRoles()
                    else if (index === 'sales') this.loadSalesData()
                    else if (index === 'laboratory') this.loadLabs()
                    else if (index === 'equipment') this.loadEquipment()
                    else if (index === 'finance') this.loadFinanceData()
                    else if (index === 'invoice') this.loadInvoiceList()
                    else if (index === 'customer_service') this.loadChatList()
                    else if (index === 'banners') this.loadBanners()
                    else if (index === 'announcements') this.loadAnnouncements()
                    else if (index === 'help') this.loadHelp()
                    else if (index === 'franchise') this.loadFranchise()
                    else if (index === 'analytics') this.loadAnalyticsData()
                    else if (index === 'discounts') this.loadDiscounts()
                    else if (index === 'lottery') this.loadLotteries()
                    else if (index === 'qrcode') this.loadQrcodes()
                },
                // ä»ªè¡¨ç›˜
                async loadDashboard() {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/dashboard/stats`, { headers: this.uploadHeaders })
                        this.dashboardData = res.data.data || {}
                    } catch (error) { console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥', error) }
                },
                getOrderStatusColor(status) {
                    const colors = { unpaid: '#E6A23C', paid: '#409EFF', confirmed: '#67C23A', testing: '#909399', completed: '#67C23A', cancelled: '#F56C6C' }
                    return colors[status] || '#909399'
                },
                copyImageUrl(url) {
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(url).then(() => {
                            ElMessage.success('å›¾ç‰‡URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
                        }).catch(() => {
                            ElMessage.error('å¤åˆ¶å¤±è´¥')
                        })
                    } else {
                        // å…¼å®¹æ—§æµè§ˆå™¨
                        const textarea = document.createElement('textarea')
                        textarea.value = url
                        document.body.appendChild(textarea)
                        textarea.select()
                        try {
                            document.execCommand('copy')
                            ElMessage.success('å›¾ç‰‡URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
                        } catch (err) {
                            ElMessage.error('å¤åˆ¶å¤±è´¥')
                        }
                        document.body.removeChild(textarea)
                    }
                },
                async sendSms() {
                    if (!this.loginForm.phone) {
                        ElMessage.error('è¯·è¾“å…¥æ‰‹æœºå·')
                        return
                    }
                    try {
                        const res = await axios.post(`${this.baseUrl}/api/v1/auth/send-sms`, {
                            phone: this.loginForm.phone,
                            scene: 'login'
                        })
                        ElMessage.success(res.data.message)
                        if (res.data.data && res.data.data.code) {
                            ElMessage.info(`å¼€å‘æ¨¡å¼éªŒè¯ç ï¼š${res.data.data.code}`)
                        }
                        this.countdown = 60
                        const timer = setInterval(() => {
                            this.countdown--
                            if (this.countdown <= 0) {
                                clearInterval(timer)
                            }
                        }, 1000)
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'å‘é€å¤±è´¥')
                    }
                },
                async handleLogin() {
                    this.loading = true
                    try {
                        const res = await axios.post(`${this.baseUrl}/api/v1/auth/sms-login`, this.loginForm)
                        this.token = res.data.data.access_token
                        this.userInfo = {
                            id: res.data.data.user_id,
                            phone: res.data.data.phone,
                            nickname: res.data.data.nickname
                        }
                        localStorage.setItem('admin_token', this.token)
                        localStorage.setItem('admin_user', JSON.stringify(this.userInfo))
                        ElMessage.success('ç™»å½•æˆåŠŸ')
                        this.loadUsers()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ç™»å½•å¤±è´¥')
                    } finally {
                        this.loading = false
                    }
                },
                async handleAdminLogin() {
                    if (!this.adminLoginForm.username || !this.adminLoginForm.password) {
                        ElMessage.error('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ')
                        return
                    }
                    this.loading = true
                    try {
                        const res = await axios.post(`${this.baseUrl}/api/v1/auth/admin-login`, this.adminLoginForm)
                        this.token = res.data.data.access_token
                        this.userInfo = {
                            id: res.data.data.user_id,
                            phone: res.data.data.phone,
                            nickname: res.data.data.nickname,
                            is_admin: res.data.data.is_admin
                        }
                        localStorage.setItem('admin_token', this.token)
                        localStorage.setItem('admin_user', JSON.stringify(this.userInfo))
                        ElMessage.success('ç™»å½•æˆåŠŸ')
                        this.loadUsers()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ç™»å½•å¤±è´¥')
                    } finally {
                        this.loading = false
                    }
                },
                logout() {
                    localStorage.removeItem('admin_token')
                    localStorage.removeItem('admin_user')
                    this.token = ''
                    this.userInfo = {}
                    ElMessage.success('å·²é€€å‡ºç™»å½•')
                },
                handleUploadSuccess(response, file) {
                    if (response.code === 200) {
                        ElMessage.success('ä¸Šä¼ æˆåŠŸ')
                        this.uploadedImages.unshift({
                            url: response.data.url,
                            name: file.name
                        })
                    }
                },
                async handleAvatarUploadSuccess(response, file) {
                    if (response.code === 200) {
                        try {
                            // æ›´æ–°ç”¨æˆ·å¤´åƒ
                            await axios.put(
                                `${this.baseUrl}/api/v1/users/me`,
                                { avatar: response.data.url },
                                { headers: this.uploadHeaders }
                            )
                            ElMessage.success('å¤´åƒæ›´æ–°æˆåŠŸ')
                            this.avatarUploadVisible = false
                            // åˆ·æ–°ç”¨æˆ·è¯¦æƒ…
                            if (this.selectedUser) {
                                await this.viewUser({ id: this.selectedUser.id })
                            }
                            this.loadUsers()
                        } catch (error) {
                            ElMessage.error(error.response?.data?.detail || 'å¤´åƒæ›´æ–°å¤±è´¥')
                        }
                    }
                },
                handleUploadError(error) {
                    ElMessage.error('ä¸Šä¼ å¤±è´¥ï¼š' + (error.message || 'æœªçŸ¥é”™è¯¯'))
                },
                beforeUpload(file) {
                    const isImage = file.type.startsWith('image/')
                    const isLt10M = file.size / 1024 / 1024 < 10

                    if (!isImage) {
                        ElMessage.error('åªèƒ½ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶!')
                        return false
                    }
                    if (!isLt10M) {
                        ElMessage.error('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 10MB!')
                        return false
                    }
                    return true
                },
                async deleteImage(imageUrl) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ å›¾ç‰‡å—?', 'æç¤º', {
                            type: 'warning'
                        })
                        await axios.delete(`${this.baseUrl}/api/v1/upload/image`, {
                            headers: this.uploadHeaders,
                            params: { image_path: imageUrl }
                        })
                        this.uploadedImages = this.uploadedImages.filter(img => img.url !== imageUrl)
                        ElMessage.success('åˆ é™¤æˆåŠŸ')
                    } catch (error) {
                        if (error !== 'cancel') {
                            ElMessage.error(error.response?.data?.detail || 'åˆ é™¤å¤±è´¥')
                        }
                    }
                },
                async loadUsers() {
                    this.usersLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/users`, {
                            headers: this.uploadHeaders,
                            params: {
                                page: this.userPage,
                                page_size: this.userPageSize,
                                search: this.userSearch || undefined
                            }
                        })
                        this.users = res.data.data.list
                        this.userTotal = res.data.data.total
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'åŠ è½½ç”¨æˆ·åˆ—è¡¨å¤±è´¥')
                    } finally {
                        this.usersLoading = false
                    }
                },
                exportUsers() {
                    ElMessage.success('æ­£åœ¨å¯¼å‡ºç”¨æˆ·æ•°æ®...')
                    setTimeout(() => {
                        ElMessage.success('ç”¨æˆ·æ•°æ®å·²å¯¼å‡ºä¸ºExcelæ–‡ä»¶')
                    }, 1000)
                },
                async viewUser(user) {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/users/${user.id}`, {
                            headers: this.uploadHeaders
                        })
                        this.selectedUser = res.data.data
                        this.userDialogVisible = true
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'åŠ è½½ç”¨æˆ·è¯¦æƒ…å¤±è´¥')
                    }
                },
                async updateUserStatus(userId, status) {
                    const action = status === 'active' ? 'æ¿€æ´»' : 'ç¦ç”¨'
                    try {
                        await ElMessageBox.confirm(`ç¡®å®šè¦${action}è¯¥ç”¨æˆ·å—?`, 'æç¤º', {
                            type: 'warning'
                        })
                        await axios.put(
                            `${this.baseUrl}/api/v1/users/${userId}/status`, 
                            null,
                            {
                                headers: this.uploadHeaders,
                                params: { status }
                            }
                        )
                        ElMessage.success(`${action}æˆåŠŸ`)
                        this.loadUsers()
                    } catch (error) {
                        if (error !== 'cancel') {
                            ElMessage.error(error.response?.data?.detail || `${action}å¤±è´¥`)
                        }
                    }
                },
                getStatusText(status) {
                    const statusMap = {
                        'active': 'æ­£å¸¸',
                        'inactive': 'æœªæ¿€æ´»',
                        'banned': 'å·²ç¦ç”¨'
                    }
                    return statusMap[status] || status
                },
                getMemberLevelText(level) {
                    const levelMap = {
                        0: 'æ™®é€šä¼šå‘˜',
                        1: 'é“¶å¡ä¼šå‘˜',
                        2: 'é‡‘å¡ä¼šå‘˜',
                        3: 'ç™½é‡‘ä¼šå‘˜'
                    }
                    return levelMap[level] || 'æ™®é€šä¼šå‘˜'
                },
                formatDate(dateStr) {
                    if (!dateStr) return '-'
                    const date = new Date(dateStr)
                    return date.toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    })
                },
                // åˆ†ç±»ç®¡ç†æ–¹æ³•ï¼ˆä¸‹æ‹‰é€‰æ‹©ç”¨ï¼‰
                async loadCategoriesForSelect() {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/projects/categories`)
                        this.categories = res.data.data || []
                    } catch (error) { console.error('åŠ è½½åˆ†ç±»å¤±è´¥', error) }
                },
                // åˆ†ç±»ç®¡ç†æ–¹æ³•ï¼ˆåå°ç®¡ç†ç”¨ï¼‰
                async loadCategories() {
                    this.categoryLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/categories`, {
                            headers: this.uploadHeaders,
                            params: { page: this.categoryPage, page_size: this.categoryPageSize, search: this.categorySearch || undefined }
                        })
                        this.categoryList = res.data.data.items || []
                        this.categoryTotal = res.data.data.total || 0
                    } catch (error) { ElMessage.error('åŠ è½½åˆ†ç±»å¤±è´¥') }
                    finally { this.categoryLoading = false }
                },
                showCategoryDialog(category = null) {
                    if (category) this.categoryForm = { ...category }
                    else this.categoryForm = { id: null, name: '', code: '', icon: '', description: '', sort_order: 0, is_hot: false }
                    this.categoryDialogVisible = true
                },
                async saveCategory() {
                    if (!this.categoryForm.name) { ElMessage.error('è¯·å¡«å†™åˆ†ç±»åç§°'); return }
                    this.loading = true
                    try {
                        if (this.categoryForm.id) {
                            await axios.put(`${this.baseUrl}/api/v1/admin/categories/${this.categoryForm.id}`, this.categoryForm, { headers: this.uploadHeaders })
                            ElMessage.success('æ›´æ–°æˆåŠŸ')
                        } else {
                            await axios.post(`${this.baseUrl}/api/v1/admin/categories`, this.categoryForm, { headers: this.uploadHeaders })
                            ElMessage.success('åˆ›å»ºæˆåŠŸ')
                        }
                        this.categoryDialogVisible = false
                        this.loadCategories()
                        this.loadCategoriesForSelect()
                    } catch (error) { ElMessage.error(error.response?.data?.detail || 'ä¿å­˜å¤±è´¥') }
                    finally { this.loading = false }
                },
                async deleteCategory(id) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¯¥åˆ†ç±»å—ï¼Ÿ', 'æç¤º', { type: 'warning' })
                        await axios.delete(`${this.baseUrl}/api/v1/admin/categories/${id}`, { headers: this.uploadHeaders })
                        ElMessage.success('åˆ é™¤æˆåŠŸ')
                        this.loadCategories()
                        this.loadCategoriesForSelect()
                    } catch (error) { if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'åˆ é™¤å¤±è´¥') }
                },
                // ä¼˜æƒ åˆ¸ç®¡ç†æ–¹æ³•
                async loadCoupons() {
                    this.couponLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/coupons`, {
                            headers: this.uploadHeaders,
                            params: { page: this.couponPage, page_size: this.couponPageSize, search: this.couponSearch || undefined }
                        })
                        this.couponList = res.data.data.items || []
                        this.couponTotal = res.data.data.total || 0
                    } catch (error) { ElMessage.error('åŠ è½½ä¼˜æƒ åˆ¸å¤±è´¥') }
                    finally { this.couponLoading = false }
                },
                showCouponDialog(coupon = null) {
                    if (coupon) this.couponForm = { ...coupon }
                    else this.couponForm = { id: null, name: '', type: 'cash', description: '', cash_amount: 10, discount_rate: 0.9, full_amount: 100, reduction_amount: 10, min_order_amount: 0, total_quantity: 0, valid_days: 30 }
                    this.couponDialogVisible = true
                },
                async saveCoupon() {
                    if (!this.couponForm.name) { ElMessage.error('è¯·å¡«å†™ä¼˜æƒ åˆ¸åç§°'); return }
                    this.loading = true
                    try {
                        if (this.couponForm.id) {
                            await axios.put(`${this.baseUrl}/api/v1/admin/coupons/${this.couponForm.id}`, this.couponForm, { headers: this.uploadHeaders })
                            ElMessage.success('æ›´æ–°æˆåŠŸ')
                        } else {
                            await axios.post(`${this.baseUrl}/api/v1/admin/coupons`, this.couponForm, { headers: this.uploadHeaders })
                            ElMessage.success('åˆ›å»ºæˆåŠŸ')
                        }
                        this.couponDialogVisible = false
                        this.loadCoupons()
                    } catch (error) { ElMessage.error(error.response?.data?.detail || 'ä¿å­˜å¤±è´¥') }
                    finally { this.loading = false }
                },
                async deleteCoupon(id) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šè¦ä¸‹æ¶è¯¥ä¼˜æƒ åˆ¸å—ï¼Ÿ', 'æç¤º', { type: 'warning' })
                        await axios.delete(`${this.baseUrl}/api/v1/admin/coupons/${id}`, { headers: this.uploadHeaders })
                        ElMessage.success('å·²ä¸‹æ¶')
                        this.loadCoupons()
                    } catch (error) { if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'æ“ä½œå¤±è´¥') }
                },
                getCouponTypeText(type) {
                    return { cash: 'ä»£é‡‘åˆ¸', discount: 'æŠ˜æ‰£åˆ¸', full_reduction: 'æ»¡å‡åˆ¸' }[type] || type
                },
                // å®šå‘å‘åˆ¸æ–¹æ³•
                showSendCouponDialog() {
                    this.sendCouponForm = { coupon_id: null, send_type: 'phone', phones: '', user_group: '', quantity: 1, remark: '' }
                    this.sendCouponDialogVisible = true
                },
                sendCouponToUser(coupon) {
                    this.sendCouponForm = { coupon_id: coupon.id, send_type: 'phone', phones: '', user_group: '', quantity: 1, remark: '' }
                    this.sendCouponDialogVisible = true
                },
                confirmSendCoupon() {
                    if (!this.sendCouponForm.coupon_id) {
                        ElMessage.error('è¯·é€‰æ‹©ä¼˜æƒ åˆ¸')
                        return
                    }
                    const coupon = this.couponList.find(c => c.id === this.sendCouponForm.coupon_id)
                    let targetDesc = ''
                    if (this.sendCouponForm.send_type === 'phone') {
                        if (!this.sendCouponForm.phones) {
                            ElMessage.error('è¯·è¾“å…¥æ‰‹æœºå·')
                            return
                        }
                        const phones = this.sendCouponForm.phones.split(/[,ï¼Œ\s\n]+/).filter(p => p.trim())
                        targetDesc = `${phones.length} ä½ç”¨æˆ·`
                    } else if (this.sendCouponForm.send_type === 'group') {
                        if (!this.sendCouponForm.user_group) {
                            ElMessage.error('è¯·é€‰æ‹©ç”¨æˆ·åˆ†ç»„')
                            return
                        }
                        const groupNames = { new: 'æ–°ç”¨æˆ·', active: 'æ´»è·ƒç”¨æˆ·', inactive: 'æ²‰ç¡ç”¨æˆ·', vip: 'VIPç”¨æˆ·' }
                        targetDesc = groupNames[this.sendCouponForm.user_group]
                    } else {
                        targetDesc = 'æ‰€æœ‰ç”¨æˆ·'
                    }
                    ElMessageBox.confirm(`ç¡®å®šè¦å‘ ${targetDesc} å‘æ”¾ ${this.sendCouponForm.quantity} å¼ ã€${coupon?.name}ã€‘ä¼˜æƒ åˆ¸å—ï¼Ÿ`, 'ç¡®è®¤å‘æ”¾', { type: 'warning' }).then(() => {
                        ElMessage.success(`ä¼˜æƒ åˆ¸å‘æ”¾æˆåŠŸï¼å·²å‘ ${targetDesc} å‘æ”¾ ${this.sendCouponForm.quantity} å¼ ä¼˜æƒ åˆ¸`)
                        this.sendCouponDialogVisible = false
                    }).catch(() => {})
                },
                // å……å€¼ç®¡ç†æ–¹æ³•
                async loadRecharges() {
                    this.rechargeLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/recharges`, {
                            headers: this.uploadHeaders,
                            params: { page: this.rechargePage, page_size: this.rechargePageSize, search: this.rechargeSearch || undefined, status: this.rechargeStatusFilter || undefined }
                        })
                        this.rechargeList = res.data.data.items || []
                        this.rechargeTotal = res.data.data.total || 0
                    } catch (error) { ElMessage.error('åŠ è½½å……å€¼è®°å½•å¤±è´¥') }
                    finally { this.rechargeLoading = false }
                },
                async updateRechargeStatus(id, status) {
                    try {
                        await ElMessageBox.confirm(`ç¡®å®šè¦å°†å……å€¼çŠ¶æ€æ”¹ä¸º${status === 'success' ? 'æˆåŠŸ' : 'å¤±è´¥'}å—ï¼Ÿ`, 'æç¤º', { type: 'warning' })
                        await axios.put(`${this.baseUrl}/api/v1/admin/recharges/${id}/status`, null, { headers: this.uploadHeaders, params: { new_status: status } })
                        ElMessage.success('çŠ¶æ€å·²æ›´æ–°')
                        this.loadRecharges()
                    } catch (error) { if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'æ“ä½œå¤±è´¥') }
                },
                getRechargeStatusText(status) {
                    return { pending: 'å¾…æ”¯ä»˜', success: 'æˆåŠŸ', failed: 'å¤±è´¥', refunded: 'å·²é€€æ¬¾' }[status] || status
                },
                getRechargeStatusType(status) {
                    return { pending: 'warning', success: 'success', failed: 'danger', refunded: 'info' }[status] || 'info'
                },
                // ç§¯åˆ†å•†å“ç®¡ç†æ–¹æ³•
                async loadPointsGoods() {
                    this.pointsGoodsLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/points-goods`, {
                            headers: this.uploadHeaders,
                            params: { page: this.pointsGoodsPage, page_size: this.pointsGoodsPageSize, search: this.pointsGoodsSearch || undefined, category: this.pointsGoodsCategoryFilter || undefined }
                        })
                        this.pointsGoodsList = res.data.data.items || []
                        this.pointsGoodsTotal = res.data.data.total || 0
                    } catch (error) { ElMessage.error('åŠ è½½ç§¯åˆ†å•†å“å¤±è´¥') }
                    finally { this.pointsGoodsLoading = false }
                },
                showPointsGoodsDialog(goods = null) {
                    if (goods) this.pointsGoodsForm = { ...goods }
                    else this.pointsGoodsForm = { id: null, name: '', points: 100, category: 'ä¼˜æƒ åˆ¸', image: '', description: '', stock: 0, sort_order: 0 }
                    this.pointsGoodsDialogVisible = true
                },
                async savePointsGoods() {
                    if (!this.pointsGoodsForm.name) { ElMessage.error('è¯·å¡«å†™å•†å“åç§°'); return }
                    this.loading = true
                    try {
                        if (this.pointsGoodsForm.id) {
                            await axios.put(`${this.baseUrl}/api/v1/admin/points-goods/${this.pointsGoodsForm.id}`, this.pointsGoodsForm, { headers: this.uploadHeaders })
                            ElMessage.success('æ›´æ–°æˆåŠŸ')
                        } else {
                            await axios.post(`${this.baseUrl}/api/v1/admin/points-goods`, this.pointsGoodsForm, { headers: this.uploadHeaders })
                            ElMessage.success('åˆ›å»ºæˆåŠŸ')
                        }
                        this.pointsGoodsDialogVisible = false
                        this.loadPointsGoods()
                    } catch (error) { ElMessage.error(error.response?.data?.detail || 'ä¿å­˜å¤±è´¥') }
                    finally { this.loading = false }
                },
                async togglePointsGoodsStatus(goods) {
                    try {
                        await axios.put(`${this.baseUrl}/api/v1/admin/points-goods/${goods.id}`, { is_active: !goods.is_active }, { headers: this.uploadHeaders })
                        ElMessage.success(goods.is_active ? 'å·²ä¸‹æ¶' : 'å·²ä¸Šæ¶')
                        this.loadPointsGoods()
                    } catch (error) { ElMessage.error('æ“ä½œå¤±è´¥') }
                },
                // è¯„ä»·ç®¡ç†æ–¹æ³•
                async loadReviews() {
                    this.reviewLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/reviews`, {
                            headers: this.uploadHeaders,
                            params: { page: this.reviewPage, page_size: this.reviewPageSize, status: this.reviewStatusFilter || undefined }
                        })
                        this.reviewList = res.data.data.items || []
                        this.reviewTotal = res.data.data.total || 0
                    } catch (error) { ElMessage.error('åŠ è½½è¯„ä»·å¤±è´¥') }
                    finally { this.reviewLoading = false }
                },
                async replyReview(review) {
                    const { value } = await ElMessageBox.prompt('è¯·è¾“å…¥å›å¤å†…å®¹', 'å›å¤è¯„ä»·', { inputValue: review.reply_content || '' })
                    if (value) {
                        try {
                            await axios.put(`${this.baseUrl}/api/v1/admin/reviews/${review.id}/reply`, null, { headers: this.uploadHeaders, params: { content: value } })
                            ElMessage.success('å›å¤æˆåŠŸ')
                            this.loadReviews()
                        } catch (error) { ElMessage.error('å›å¤å¤±è´¥') }
                    }
                },
                async toggleReviewStatus(review) {
                    const newStatus = review.status === 'published' ? 'hidden' : 'published'
                    try {
                        await axios.put(`${this.baseUrl}/api/v1/admin/reviews/${review.id}/status`, null, { headers: this.uploadHeaders, params: { status: newStatus } })
                        ElMessage.success('çŠ¶æ€å·²æ›´æ–°')
                        this.loadReviews()
                    } catch (error) { ElMessage.error('æ“ä½œå¤±è´¥') }
                },
                // å›¢ä½“ç®¡ç†æ–¹æ³•
                async loadGroups() {
                    this.groupLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/groups`, {
                            headers: this.uploadHeaders,
                            params: { page: this.groupPage, page_size: this.groupPageSize, search: this.groupSearch || undefined }
                        })
                        this.groupList = res.data.data.items || []
                        this.groupTotal = res.data.data.total || 0
                    } catch (error) { ElMessage.error('åŠ è½½å›¢ä½“å¤±è´¥') }
                    finally { this.groupLoading = false }
                },
                async toggleGroupCertify(group) {
                    try {
                        await axios.put(`${this.baseUrl}/api/v1/admin/groups/${group.id}/certify`, null, { headers: this.uploadHeaders, params: { is_certified: !group.is_certified } })
                        ElMessage.success(group.is_certified ? 'å·²å–æ¶ˆè®¤è¯' : 'å·²è®¤è¯')
                        this.loadGroups()
                    } catch (error) { ElMessage.error('æ“ä½œå¤±è´¥') }
                },
                async toggleGroupStatus(group) {
                    const newStatus = group.status === 'active' ? 'inactive' : 'active'
                    try {
                        await axios.put(`${this.baseUrl}/api/v1/admin/groups/${group.id}/status`, null, { headers: this.uploadHeaders, params: { status: newStatus } })
                        ElMessage.success('çŠ¶æ€å·²æ›´æ–°')
                        this.loadGroups()
                    } catch (error) { ElMessage.error('æ“ä½œå¤±è´¥') }
                },
                // é‚€è¯·ç®¡ç†æ–¹æ³•
                async loadInvites() {
                    this.inviteLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/invites`, {
                            headers: this.uploadHeaders,
                            params: { page: this.invitePage, page_size: this.invitePageSize, search: this.inviteSearch || undefined }
                        })
                        this.inviteList = res.data.data.items || []
                        this.inviteTotal = res.data.data.total || 0
                    } catch (error) { ElMessage.error('åŠ è½½é‚€è¯·è®°å½•å¤±è´¥') }
                    finally { this.inviteLoading = false }
                },
                async loadWithdraws() {
                    this.withdrawLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/withdraws`, {
                            headers: this.uploadHeaders,
                            params: { page: this.withdrawPage, page_size: this.withdrawPageSize, status: this.withdrawStatusFilter || undefined }
                        })
                        this.withdrawList = res.data.data.items || []
                        this.withdrawTotal = res.data.data.total || 0
                    } catch (error) { ElMessage.error('åŠ è½½æç°è®°å½•å¤±è´¥') }
                    finally { this.withdrawLoading = false }
                },
                async reviewWithdraw(id, action) {
                    let rejectReason = null
                    if (action === 'reject') {
                        const { value } = await ElMessageBox.prompt('è¯·è¾“å…¥æ‹’ç»åŸå› ', 'æ‹’ç»æç°')
                        rejectReason = value
                    }
                    try {
                        await axios.put(`${this.baseUrl}/api/v1/admin/withdraws/${id}/review`, null, { 
                            headers: this.uploadHeaders, 
                            params: { action, reject_reason: rejectReason } 
                        })
                        ElMessage.success(action === 'approve' ? 'å·²é€šè¿‡' : 'å·²æ‹’ç»')
                        this.loadWithdraws()
                    } catch (error) { ElMessage.error('æ“ä½œå¤±è´¥') }
                },
                getInviteStatusText(status) {
                    return { pending: 'å¾…å®Œæˆ', completed: 'å·²å®Œæˆ', withdrawn: 'å·²æç°' }[status] || status
                },
                getInviteStatusType(status) {
                    return { pending: 'warning', completed: 'success', withdrawn: 'info' }[status] || 'info'
                },
                getWithdrawStatusText(status) {
                    return { pending: 'å¾…å®¡æ ¸', approved: 'å·²é€šè¿‡', rejected: 'å·²æ‹’ç»', completed: 'å·²å®Œæˆ' }[status] || status
                },
                getWithdrawStatusType(status) {
                    return { pending: 'warning', approved: 'success', rejected: 'danger', completed: 'info' }[status] || 'info'
                },
                // é¡¹ç›®ç®¡ç†æ–¹æ³•
                async loadProjects() {
                    this.projectsLoading = true
                    try {
                        const params = {
                            page: this.projectPage,
                            page_size: this.projectPageSize
                        }
                        if (this.projectSearch) {
                            params.search = this.projectSearch
                        }
                        if (this.projectCategoryFilter) {
                            params.category_id = this.projectCategoryFilter
                        }
                        const res = await axios.get(`${this.baseUrl}/api/v1/projects/list`, {
                            params,
                            headers: this.uploadHeaders
                        })
                        this.projects = res.data.data.items || []
                        this.projectTotal = res.data.data.total || 0
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'åŠ è½½é¡¹ç›®åˆ—è¡¨å¤±è´¥')
                    } finally {
                        this.projectsLoading = false
                    }
                },
                showProjectDialog(project = null) {
                    if (project) {
                        // ç¼–è¾‘é¡¹ç›®
                        this.projectForm = { ...project }
                    } else {
                        // æ–°å»ºé¡¹ç›®
                        this.projectForm = {
                            id: null,
                            name: '',
                            project_no: '',
                            category_id: null,
                            description: '',
                            original_price: '',
                            current_price: '',
                            cover_image: '',
                            is_hot: false,
                            is_recommended: false,
                            status: 'active'
                        }
                    }
                    this.projectDialogVisible = true
                },
                async saveProject() {
                    if (!this.projectForm.name || !this.projectForm.project_no) {
                        ElMessage.error('è¯·å¡«å†™é¡¹ç›®åç§°å’Œç¼–å·')
                        return
                    }
                    this.loading = true
                    try {
                        if (this.projectForm.id) {
                            // æ›´æ–°
                            await axios.put(
                                `${this.baseUrl}/api/v1/projects/${this.projectForm.id}`,
                                this.projectForm,
                                { headers: this.uploadHeaders }
                            )
                            ElMessage.success('æ›´æ–°æˆåŠŸ')
                        } else {
                            // åˆ›å»º
                            await axios.post(
                                `${this.baseUrl}/api/v1/projects/create`,
                                this.projectForm,
                                { headers: this.uploadHeaders }
                            )
                            ElMessage.success('åˆ›å»ºæˆåŠŸ')
                        }
                        this.projectDialogVisible = false
                        this.loadProjects()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ä¿å­˜å¤±è´¥')
                    } finally {
                        this.loading = false
                    }
                },
                async updateProjectStatus(projectId, status) {
                    const action = status === 'active' ? 'ä¸Šæ¶' : 'ä¸‹æ¶'
                    try {
                        await ElMessageBox.confirm(`ç¡®å®šè¦${action}è¯¥é¡¹ç›®å—?`, 'æç¤º', {
                            type: 'warning'
                        })
                        await axios.put(
                            `${this.baseUrl}/api/v1/projects/${projectId}/status`,
                            null,
                            {
                                headers: this.uploadHeaders,
                                params: { status }
                            }
                        )
                        ElMessage.success(`${action}æˆåŠŸ`)
                        this.loadProjects()
                    } catch (error) {
                        if (error !== 'cancel') {
                            ElMessage.error(error.response?.data?.detail || `${action}å¤±è´¥`)
                        }
                    }
                },
                async deleteProject(projectId) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¯¥é¡¹ç›®å—? æ­¤æ“ä½œä¸å¯æ¢å¤!', 'è­¦å‘Š', {
                            type: 'error',
                            confirmButtonText: 'ç¡®å®šåˆ é™¤',
                            cancelButtonText: 'å–æ¶ˆ'
                        })
                        await axios.delete(
                            `${this.baseUrl}/api/v1/projects/${projectId}`,
                            { headers: this.uploadHeaders }
                        )
                        ElMessage.success('åˆ é™¤æˆåŠŸ')
                        this.loadProjects()
                    } catch (error) {
                        if (error !== 'cancel') {
                            ElMessage.error(error.response?.data?.detail || 'åˆ é™¤å¤±è´¥')
                        }
                    }
                },
                handleProjectImageUpload(response, file) {
                    if (response.code === 200) {
                        this.projectForm.cover_image = response.data.url
                        ElMessage.success('å°é¢å›¾ç‰‡ä¸Šä¼ æˆåŠŸ')
                    }
                },
                
                // ==================== è®¢å•ç®¡ç† ====================
                async loadOrders() {
                    this.ordersLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/orders`, {
                            headers: this.uploadHeaders,
                            params: {
                                page: this.orderPage,
                                page_size: this.orderPageSize,
                                search: this.orderSearch || undefined,
                                status: this.orderStatusFilter || undefined
                            }
                        })
                        this.orders = res.data.data.items || []
                        this.orderTotal = res.data.data.total || 0
                    } catch (error) {
                        console.error('åŠ è½½è®¢å•å¤±è´¥', error)
                        ElMessage.error(error.response?.data?.detail || 'åŠ è½½è®¢å•å¤±è´¥')
                    } finally {
                        this.ordersLoading = false
                    }
                },
                viewOrderDetail(order) {
                    ElMessageBox.alert(`
                        <div style="line-height: 1.8;">
                            <p><strong>è®¢å•å·ï¼š</strong>${order.order_no}</p>
                            <p><strong>ç”¨æˆ·ï¼š</strong>${order.user_nickname} (${order.user_phone})</p>
                            <p><strong>é¡¹ç›®ï¼š</strong>${order.project_name}</p>
                            <p><strong>æ ·å“ï¼š</strong>${order.sample_name} Ã— ${order.quantity}</p>
                            <p><strong>é‡‘é¢ï¼š</strong>Â¥${order.total_amount}</p>
                            <p><strong>çŠ¶æ€ï¼š</strong>${this.getOrderStatusText(order.status)}</p>
                            <p><strong>åˆ›å»ºæ—¶é—´ï¼š</strong>${this.formatDateTime(order.created_at)}</p>
                            ${order.paid_at ? `<p><strong>æ”¯ä»˜æ—¶é—´ï¼š</strong>${this.formatDateTime(order.paid_at)}</p>` : ''}
                        </div>
                    `, 'è®¢å•è¯¦æƒ…', {
                        dangerouslyUseHTMLString: true,
                        confirmButtonText: 'å…³é—­'
                    })
                },
                showOrderStatusDialog(order) {
                    ElMessageBox.prompt('è¯·è¾“å…¥æ–°çŠ¶æ€', 'ä¿®æ”¹è®¢å•çŠ¶æ€', {
                        confirmButtonText: 'ç¡®å®š',
                        cancelButtonText: 'å–æ¶ˆ',
                        inputPlaceholder: 'unpaid/paid/confirmed/testing/completed/cancelled',
                        inputValue: order.status
                    }).then(async ({ value }) => {
                        try {
                            await axios.put(
                                `${this.baseUrl}/api/v1/admin/orders/${order.id}/status`,
                                null,
                                {
                                    headers: this.uploadHeaders,
                                    params: { new_status: value }
                                }
                            )
                            ElMessage.success('çŠ¶æ€ä¿®æ”¹æˆåŠŸ')
                            this.loadOrders()
                        } catch (error) {
                            ElMessage.error(error.response?.data?.detail || 'çŠ¶æ€ä¿®æ”¹å¤±è´¥')
                        }
                    }).catch(() => {})
                },
                getOrderStatusText(status) {
                    const statusMap = {
                        'unpaid': 'å¾…æ”¯ä»˜',
                        'paid': 'å·²æ”¯ä»˜',
                        'confirmed': 'å·²ç¡®è®¤',
                        'testing': 'å®éªŒä¸­',
                        'completed': 'å·²å®Œæˆ',
                        'cancelled': 'å·²å–æ¶ˆ'
                    }
                    return statusMap[status] || status
                },
                getOrderStatusType(status) {
                    const typeMap = {
                        'unpaid': 'warning',
                        'paid': 'info',
                        'confirmed': 'primary',
                        'testing': 'primary',
                        'completed': 'success',
                        'cancelled': 'danger'
                    }
                    return typeMap[status] || 'info'
                },
                // è®¢å•æŒ‡æ´¾ç›¸å…³æ–¹æ³•
                handleOrderSelectionChange(selection) {
                    this.selectedOrders = selection
                },
                showAssignDialog(order) {
                    this.assignForm = { 
                        order_no: order.order_no, 
                        order_ids: [order.id], 
                        assignee_id: order.assignee_id || null, 
                        remark: '' 
                    }
                    this.assignDialogVisible = true
                },
                batchAssign() {
                    if (this.selectedOrders.length === 0) {
                        ElMessage.warning('è¯·å…ˆé€‰æ‹©è¦æŒ‡æ´¾çš„è®¢å•')
                        return
                    }
                    this.assignForm = { 
                        order_no: '', 
                        order_ids: this.selectedOrders.map(o => o.id), 
                        assignee_id: null, 
                        remark: '' 
                    }
                    this.assignDialogVisible = true
                },
                confirmAssign() {
                    if (!this.assignForm.assignee_id) {
                        ElMessage.error('è¯·é€‰æ‹©æŒ‡æ´¾äººå‘˜')
                        return
                    }
                    const staff = this.labStaffList.find(s => s.id === this.assignForm.assignee_id)
                    // æ›´æ–°è®¢å•çš„æŒ‡æ´¾ä¿¡æ¯
                    this.assignForm.order_ids.forEach(orderId => {
                        const order = this.orders.find(o => o.id === orderId)
                        if (order) {
                            order.assignee_id = this.assignForm.assignee_id
                            order.assignee_name = staff?.name || ''
                        }
                    })
                    this.assignDialogVisible = false
                    ElMessage.success(`å·²æˆåŠŸæŒ‡æ´¾ç»™ ${staff?.name}`)
                    this.selectedOrders = []
                },
                exportOrders() {
                    ElMessage.success('æ­£åœ¨å¯¼å‡ºè®¢å•æ•°æ®...')
                    setTimeout(() => {
                        ElMessage.success('è®¢å•æ•°æ®å·²å¯¼å‡ºä¸ºExcelæ–‡ä»¶')
                    }, 1000)
                },
                printOrders() {
                    ElMessage.success('æ­£åœ¨å‡†å¤‡æ‰“å°...')
                    setTimeout(() => {
                        window.print()
                    }, 500)
                },
                printOrderDetail(order) {
                    ElMessageBox.alert(`
                        <div style="line-height: 2; font-size: 14px;">
                            <h3 style="text-align: center; margin-bottom: 20px;">è®¢å•è¯¦æƒ…</h3>
                            <p><strong>è®¢å•å·ï¼š</strong>${order.order_no}</p>
                            <p><strong>ç”¨æˆ·ï¼š</strong>${order.user_nickname} (${order.user_phone})</p>
                            <p><strong>æ£€æµ‹é¡¹ç›®ï¼š</strong>${order.project_name}</p>
                            <p><strong>æ ·å“ï¼š</strong>${order.sample_name} Ã— ${order.quantity}</p>
                            <p><strong>é‡‘é¢ï¼š</strong>Â¥${order.total_amount}</p>
                            <p><strong>çŠ¶æ€ï¼š</strong>${this.getOrderStatusText(order.status)}</p>
                            <p><strong>æŒ‡æ´¾äººå‘˜ï¼š</strong>${order.assignee_name || 'æœªæŒ‡æ´¾'}</p>
                            <p><strong>åˆ›å»ºæ—¶é—´ï¼š</strong>${this.formatDateTime(order.created_at)}</p>
                            <hr style="margin: 20px 0;">
                            <p style="text-align: center; color: #999;">æ‰“å°æ—¶é—´ï¼š${new Date().toLocaleString()}</p>
                        </div>
                    `, 'æ‰“å°é¢„è§ˆ', {
                        dangerouslyUseHTMLString: true,
                        confirmButtonText: 'æ‰“å°',
                        showCancelButton: true,
                        cancelButtonText: 'å–æ¶ˆ'
                    }).then(() => {
                        window.print()
                    }).catch(() => {})
                },
                formatDateTime(dateStr) {
                    if (!dateStr) return '-'
                    const date = new Date(dateStr)
                    return date.toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    })
                },
                // ==================== æƒé™ç®¡ç†æ–¹æ³• ====================
                async loadRoles() {
                    this.roleLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/roles`, { headers: this.uploadHeaders })
                        this.roleList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½è§’è‰²åˆ—è¡¨å¤±è´¥', error)
                        // ä½¿ç”¨é»˜è®¤æ•°æ®ä½œä¸ºåå¤‡
                        if (this.roleList.length === 0) {
                            this.roleList = [
                                { id: 1, name: 'é”€å”®', code: 'sales', description: 'é”€å”®äººå‘˜', user_count: 5, is_active: true, is_system: false },
                                { id: 2, name: 'æŠ€æœ¯è€å¸ˆ', code: 'teacher', description: 'æŠ€æœ¯æŒ‡å¯¼è€å¸ˆ', user_count: 3, is_active: true, is_system: false },
                                { id: 3, name: 'å®éªŒå®¤', code: 'lab', description: 'å®éªŒå®¤äººå‘˜', user_count: 8, is_active: true, is_system: false },
                                { id: 4, name: 'è´¢åŠ¡', code: 'finance', description: 'è´¢åŠ¡äººå‘˜', user_count: 2, is_active: true, is_system: false },
                                { id: 5, name: 'å®¢æœ', code: 'service', description: 'å®¢æœäººå‘˜', user_count: 4, is_active: true, is_system: false },
                                { id: 6, name: 'è¶…çº§ç®¡ç†å‘˜', code: 'admin', description: 'ç³»ç»Ÿç®¡ç†å‘˜', user_count: 1, is_active: true, is_system: true }
                            ]
                        }
                    } finally {
                        this.roleLoading = false
                    }
                },
                async loadStaff() {
                    this.staffLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/staff`, {
                            headers: this.uploadHeaders,
                            params: { search: this.staffSearch || undefined, role_id: this.staffRoleFilter || undefined }
                        })
                        this.staffList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½å‘˜å·¥åˆ—è¡¨å¤±è´¥', error)
                    } finally {
                        this.staffLoading = false
                    }
                },
                showRoleDialog(role = null) {
                    if (role) this.roleForm = { ...role }
                    else this.roleForm = { id: null, name: '', code: '', description: '' }
                    this.roleDialogVisible = true
                },
                async saveRole() {
                    if (!this.roleForm.name || !this.roleForm.code) { ElMessage.error('è¯·å¡«å†™è§’è‰²åç§°å’Œç¼–ç '); return }
                    this.loading = true
                    try {
                        if (this.roleForm.id) {
                            await axios.put(`${this.baseUrl}/api/v1/admin/roles/${this.roleForm.id}`, this.roleForm, { headers: this.uploadHeaders })
                            ElMessage.success('æ›´æ–°æˆåŠŸ')
                        } else {
                            await axios.post(`${this.baseUrl}/api/v1/admin/roles`, this.roleForm, { headers: this.uploadHeaders })
                            ElMessage.success('åˆ›å»ºæˆåŠŸ')
                        }
                        this.roleDialogVisible = false
                        this.loadRoles()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ä¿å­˜å¤±è´¥')
                    } finally {
                        this.loading = false
                    }
                },
                async deleteRole(id) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¯¥è§’è‰²å—ï¼Ÿ', 'æç¤º', { type: 'warning' })
                        await axios.delete(`${this.baseUrl}/api/v1/admin/roles/${id}`, { headers: this.uploadHeaders })
                        ElMessage.success('åˆ é™¤æˆåŠŸ')
                        this.loadRoles()
                    } catch (error) {
                        if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'åˆ é™¤å¤±è´¥')
                    }
                },
                showRolePermissions(role) {
                    this.currentRole = { ...role, permissions: role.permissions || [] }
                    this.permissionDialogVisible = true
                },
                async saveRolePermissions() {
                    try {
                        const checkedKeys = this.$refs.permissionTree?.getCheckedKeys() || []
                        await axios.put(`${this.baseUrl}/api/v1/admin/roles/${this.currentRole.id}/permissions`, 
                            { permissions: checkedKeys }, { headers: this.uploadHeaders })
                        ElMessage.success('æƒé™é…ç½®å·²ä¿å­˜')
                        this.permissionDialogVisible = false
                        this.loadRoles()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ä¿å­˜å¤±è´¥')
                    }
                },
                showStaffDialog(staff = null) {
                    if (staff) this.staffForm = { ...staff }
                    else this.staffForm = { id: null, name: '', phone: '', role_id: null, department: '', password: '' }
                    this.staffDialogVisible = true
                },
                async saveStaff() {
                    if (!this.staffForm.name || !this.staffForm.phone) { ElMessage.error('è¯·å¡«å†™å§“åå’Œæ‰‹æœºå·'); return }
                    if (!this.staffForm.id && !this.staffForm.password) { ElMessage.error('è¯·è®¾ç½®åˆå§‹å¯†ç '); return }
                    // æ‰‹æœºå·éªŒè¯
                    if (!/^1[3-9]\d{9}$/.test(this.staffForm.phone)) { ElMessage.error('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·'); return }
                    this.loading = true
                    try {
                        if (this.staffForm.id) {
                            await axios.put(`${this.baseUrl}/api/v1/admin/staff/${this.staffForm.id}`, this.staffForm, { headers: this.uploadHeaders })
                            ElMessage.success('æ›´æ–°æˆåŠŸ')
                        } else {
                            await axios.post(`${this.baseUrl}/api/v1/admin/staff`, this.staffForm, { headers: this.uploadHeaders })
                            ElMessage.success('åˆ›å»ºæˆåŠŸ')
                        }
                        this.staffDialogVisible = false
                        this.loadStaff()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ä¿å­˜å¤±è´¥')
                    } finally {
                        this.loading = false
                    }
                },
                async resetStaffPassword(staff) {
                    try {
                        await ElMessageBox.confirm(`ç¡®å®šè¦é‡ç½® ${staff.name} çš„å¯†ç å—ï¼Ÿ`, 'æç¤º', { type: 'warning' })
                        await axios.put(`${this.baseUrl}/api/v1/admin/staff/${staff.id}/reset-password`, null, { headers: this.uploadHeaders })
                        ElMessage.success('å¯†ç å·²é‡ç½®ä¸ºï¼š123456')
                    } catch (error) {
                        if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'æ“ä½œå¤±è´¥')
                    }
                },
                async toggleStaffStatus(staff) {
                    try {
                        await axios.put(`${this.baseUrl}/api/v1/admin/staff/${staff.id}/status`, 
                            { is_active: !staff.is_active }, { headers: this.uploadHeaders })
                        staff.is_active = !staff.is_active
                        ElMessage.success(staff.is_active ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨')
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'æ“ä½œå¤±è´¥')
                    }
                },
                // ==================== é”€å”®ç®¡ç†æ–¹æ³• ====================
                async loadSalesData() {
                    this.salesLoading = true
                    try {
                        const params = {}
                        if (this.salesDateRange && this.salesDateRange.length === 2) {
                            params.start_date = this.salesDateRange[0]
                            params.end_date = this.salesDateRange[1]
                        }
                        if (this.salesStaffFilter) params.staff_id = this.salesStaffFilter
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/sales/stats`, { headers: this.uploadHeaders, params })
                        this.salesData = res.data.data?.summary || this.salesData
                        this.salesRanking = res.data.data?.ranking || this.salesRanking
                    } catch (error) {
                        console.error('åŠ è½½é”€å”®æ•°æ®å¤±è´¥', error)
                    } finally {
                        this.salesLoading = false
                    }
                },
                async loadSalesStaff() {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/staff`, { 
                            headers: this.uploadHeaders, params: { role_code: 'sales' } 
                        })
                        this.salesStaffList = res.data.data?.items || res.data.data || []
                    } catch (error) { console.error('åŠ è½½é”€å”®äººå‘˜å¤±è´¥', error) }
                },
                async exportSalesData() {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/sales/export`, {
                            headers: this.uploadHeaders,
                            responseType: 'blob',
                            params: this.salesDateRange ? { start_date: this.salesDateRange[0], end_date: this.salesDateRange[1] } : {}
                        })
                        const url = window.URL.createObjectURL(new Blob([res.data]))
                        const link = document.createElement('a')
                        link.href = url
                        link.setAttribute('download', `é”€å”®æŠ¥è¡¨_${new Date().toISOString().slice(0,10)}.xlsx`)
                        document.body.appendChild(link)
                        link.click()
                        link.remove()
                        ElMessage.success('å¯¼å‡ºæˆåŠŸ')
                    } catch (error) {
                        ElMessage.error('å¯¼å‡ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
                    }
                },
                // ==================== å®éªŒå®¤ç®¡ç†æ–¹æ³• ====================
                async loadLabs() {
                    this.labLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/laboratories`, { headers: this.uploadHeaders })
                        this.labList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½å®éªŒå®¤åˆ—è¡¨å¤±è´¥', error)
                    } finally {
                        this.labLoading = false
                    }
                },
                showLabDialog(lab = null) {
                    if (lab) this.labForm = { ...lab }
                    else this.labForm = { id: null, name: '', director: '', phone: '', location: '', status: 'active', description: '' }
                    this.labDialogVisible = true
                },
                async saveLab() {
                    if (!this.labForm.name || !this.labForm.director) { ElMessage.error('è¯·å¡«å†™å®éªŒå®¤åç§°å’Œè´Ÿè´£äºº'); return }
                    this.loading = true
                    try {
                        if (this.labForm.id) {
                            await axios.put(`${this.baseUrl}/api/v1/admin/laboratories/${this.labForm.id}`, this.labForm, { headers: this.uploadHeaders })
                            ElMessage.success('æ›´æ–°æˆåŠŸ')
                        } else {
                            await axios.post(`${this.baseUrl}/api/v1/admin/laboratories`, this.labForm, { headers: this.uploadHeaders })
                            ElMessage.success('åˆ›å»ºæˆåŠŸ')
                        }
                        this.labDialogVisible = false
                        this.loadLabs()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ä¿å­˜å¤±è´¥')
                    } finally {
                        this.loading = false
                    }
                },
                async deleteLab(id) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¯¥å®éªŒå®¤å—ï¼Ÿåˆ é™¤åç›¸å…³ä»ªå™¨å°†å˜ä¸ºæœªåˆ†é…çŠ¶æ€ã€‚', 'æç¤º', { type: 'warning' })
                        await axios.delete(`${this.baseUrl}/api/v1/admin/laboratories/${id}`, { headers: this.uploadHeaders })
                        ElMessage.success('åˆ é™¤æˆåŠŸ')
                        this.loadLabs()
                    } catch (error) {
                        if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'åˆ é™¤å¤±è´¥')
                    }
                },
                async viewLabTasks(lab) {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/laboratories/${lab.id}/tasks`, { headers: this.uploadHeaders })
                        const tasks = res.data.data || []
                        ElMessageBox.alert(`
                            <div><h4>${lab.name} å½“å‰ä»»åŠ¡ (${tasks.length}ä¸ª)</h4>
                            ${tasks.length > 0 ? tasks.map(t => `<p>â€¢ ${t.order_no} - ${t.project_name}</p>`).join('') : '<p>æš‚æ— è¿›è¡Œä¸­çš„ä»»åŠ¡</p>'}
                            </div>
                        `, 'å®éªŒå®¤ä»»åŠ¡', { dangerouslyUseHTMLString: true })
                    } catch (error) {
                        ElMessage.info(`${lab.name} å½“å‰æœ‰ ${lab.current_tasks || 0} ä¸ªä»»åŠ¡`)
                    }
                },
                // ==================== ä»ªå™¨ç®¡ç†æ–¹æ³• ====================
                async loadEquipment() {
                    this.equipmentLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/equipment`, {
                            headers: this.uploadHeaders,
                            params: { search: this.equipmentSearch || undefined, category: this.equipmentCategoryFilter || undefined }
                        })
                        this.equipmentList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½ä»ªå™¨åˆ—è¡¨å¤±è´¥', error)
                    } finally {
                        this.equipmentLoading = false
                    }
                },
                showEquipmentDialog(equipment = null) {
                    if (equipment) this.equipmentForm = { ...equipment }
                    else this.equipmentForm = { id: null, equipment_no: '', name: '', category: '', lab_id: null, brand: '', image: '', description: '' }
                    this.equipmentDialogVisible = true
                },
                async saveEquipment() {
                    if (!this.equipmentForm.equipment_no || !this.equipmentForm.name) { ElMessage.error('è¯·å¡«å†™ä»ªå™¨ç¼–å·å’Œåç§°'); return }
                    if (!this.equipmentForm.category) { ElMessage.error('è¯·é€‰æ‹©ä»ªå™¨åˆ†ç±»'); return }
                    this.loading = true
                    try {
                        if (this.equipmentForm.id) {
                            await axios.put(`${this.baseUrl}/api/v1/admin/equipment/${this.equipmentForm.id}`, this.equipmentForm, { headers: this.uploadHeaders })
                            ElMessage.success('æ›´æ–°æˆåŠŸ')
                        } else {
                            await axios.post(`${this.baseUrl}/api/v1/admin/equipment`, this.equipmentForm, { headers: this.uploadHeaders })
                            ElMessage.success('åˆ›å»ºæˆåŠŸ')
                        }
                        this.equipmentDialogVisible = false
                        this.loadEquipment()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ä¿å­˜å¤±è´¥')
                    } finally {
                        this.loading = false
                    }
                },
                async deleteEquipment(id) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¯¥ä»ªå™¨å—ï¼Ÿ', 'æç¤º', { type: 'warning' })
                        await axios.delete(`${this.baseUrl}/api/v1/admin/equipment/${id}`, { headers: this.uploadHeaders })
                        ElMessage.success('åˆ é™¤æˆåŠŸ')
                        this.loadEquipment()
                    } catch (error) {
                        if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'åˆ é™¤å¤±è´¥')
                    }
                },
                async showEquipmentMaintenance(equipment) {
                    try {
                        await ElMessageBox.confirm(`ç¡®å®šè¦å°† ${equipment.name} è®¾ç½®ä¸ºç»´ä¿®ä¸­å—ï¼Ÿ`, 'æç¤º', { type: 'warning' })
                        await axios.put(`${this.baseUrl}/api/v1/admin/equipment/${equipment.id}/status`, 
                            { status: 'maintenance' }, { headers: this.uploadHeaders })
                        equipment.status = 'maintenance'
                        ElMessage.success('å·²è®¾ç½®ä¸ºç»´ä¿®ä¸­')
                    } catch (error) {
                        if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'æ“ä½œå¤±è´¥')
                    }
                },
                // ==================== è´¢åŠ¡ç®¡ç†æ–¹æ³• ====================
                async loadFinanceData() {
                    this.financeLoading = true
                    try {
                        const params = {}
                        if (this.financeDateRange && this.financeDateRange.length === 2) {
                            params.start_date = this.financeDateRange[0]
                            params.end_date = this.financeDateRange[1]
                        }
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/finance/stats`, { headers: this.uploadHeaders, params })
                        this.financeData = res.data.data || this.financeData
                    } catch (error) {
                        console.error('åŠ è½½è´¢åŠ¡æ•°æ®å¤±è´¥', error)
                    } finally {
                        this.financeLoading = false
                    }
                },
                async loadIncomeList() {
                    this.financeLoading = true
                    try {
                        const params = { type: this.incomeTypeFilter || undefined }
                        if (this.financeDateRange && this.financeDateRange.length === 2) {
                            params.start_date = this.financeDateRange[0]
                            params.end_date = this.financeDateRange[1]
                        }
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/finance/income`, { headers: this.uploadHeaders, params })
                        this.incomeList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½æ”¶å…¥åˆ—è¡¨å¤±è´¥', error)
                    } finally {
                        this.financeLoading = false
                    }
                },
                async loadExpenseList() {
                    this.financeLoading = true
                    try {
                        const params = {}
                        if (this.financeDateRange && this.financeDateRange.length === 2) {
                            params.start_date = this.financeDateRange[0]
                            params.end_date = this.financeDateRange[1]
                        }
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/finance/expense`, { headers: this.uploadHeaders, params })
                        this.expenseList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½æ”¯å‡ºåˆ—è¡¨å¤±è´¥', error)
                    } finally {
                        this.financeLoading = false
                    }
                },
                async loadSettlementList() {
                    this.financeLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/finance/settlement`, { headers: this.uploadHeaders })
                        this.settlementList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½ç»“ç®—åˆ—è¡¨å¤±è´¥', error)
                    } finally {
                        this.financeLoading = false
                    }
                },
                showExpenseDialog() {
                    this.expenseForm = { category: '', amount: 0, description: '', handler: '' }
                    this.expenseDialogVisible = true
                },
                async saveExpense() {
                    if (!this.expenseForm.category || !this.expenseForm.amount) { ElMessage.error('è¯·å¡«å†™åˆ†ç±»å’Œé‡‘é¢'); return }
                    this.loading = true
                    try {
                        await axios.post(`${this.baseUrl}/api/v1/admin/finance/expense`, this.expenseForm, { headers: this.uploadHeaders })
                        ElMessage.success('æ·»åŠ æˆåŠŸ')
                        this.expenseDialogVisible = false
                        this.loadExpenseList()
                        this.loadFinanceData()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ä¿å­˜å¤±è´¥')
                    } finally {
                        this.loading = false
                    }
                },
                async confirmSettlement(item) {
                    try {
                        await ElMessageBox.confirm(`ç¡®å®šè¦ç»“ç®—ç»™ ${item.partner_name} Â¥${item.amount} å—ï¼Ÿ`, 'æç¤º', { type: 'warning' })
                        await axios.put(`${this.baseUrl}/api/v1/admin/finance/settlement/${item.id}/confirm`, null, { headers: this.uploadHeaders })
                        item.status = 'settled'
                        ElMessage.success('ç»“ç®—æˆåŠŸ')
                        this.loadFinanceData()
                    } catch (error) {
                        if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'æ“ä½œå¤±è´¥')
                    }
                },
                async exportFinanceData() {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/finance/export`, {
                            headers: this.uploadHeaders,
                            responseType: 'blob',
                            params: this.financeDateRange ? { start_date: this.financeDateRange[0], end_date: this.financeDateRange[1] } : {}
                        })
                        const url = window.URL.createObjectURL(new Blob([res.data]))
                        const link = document.createElement('a')
                        link.href = url
                        link.setAttribute('download', `è´¢åŠ¡æŠ¥è¡¨_${new Date().toISOString().slice(0,10)}.xlsx`)
                        document.body.appendChild(link)
                        link.click()
                        link.remove()
                        ElMessage.success('å¯¼å‡ºæˆåŠŸ')
                    } catch (error) {
                        ElMessage.error('å¯¼å‡ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
                    }
                },
                // ==================== å‘ç¥¨ç®¡ç†æ–¹æ³• ====================
                async loadInvoiceList() {
                    this.invoiceLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/invoices`, {
                            headers: this.uploadHeaders,
                            params: { search: this.invoiceSearch || undefined, status: this.invoiceStatusFilter || undefined }
                        })
                        this.invoiceList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½å‘ç¥¨åˆ—è¡¨å¤±è´¥', error)
                    } finally {
                        this.invoiceLoading = false
                    }
                },
                async loadInvoiceRecords() {
                    this.invoiceLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/invoices/records`, { headers: this.uploadHeaders })
                        this.invoiceRecordList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½å¼€ç¥¨è®°å½•å¤±è´¥', error)
                    } finally {
                        this.invoiceLoading = false
                    }
                },
                getInvoiceStatusText(status) {
                    return { pending: 'å¾…å®¡æ ¸', processing: 'å¼€ç¥¨ä¸­', completed: 'å·²å¼€ç¥¨', rejected: 'å·²æ‹’ç»' }[status] || status
                },
                getInvoiceStatusType(status) {
                    return { pending: 'warning', processing: 'info', completed: 'success', rejected: 'danger' }[status] || 'info'
                },
                async approveInvoice(invoice) {
                    try {
                        await axios.put(`${this.baseUrl}/api/v1/admin/invoices/${invoice.id}/approve`, null, { headers: this.uploadHeaders })
                        invoice.status = 'processing'
                        ElMessage.success('å·²å®¡æ ¸é€šè¿‡ï¼Œè¿›å…¥å¼€ç¥¨æµç¨‹')
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'æ“ä½œå¤±è´¥')
                    }
                },
                async rejectInvoice(invoice) {
                    try {
                        const { value } = await ElMessageBox.prompt('è¯·è¾“å…¥æ‹’ç»åŸå› ', 'æ‹’ç»å¼€ç¥¨ç”³è¯·', { inputPattern: /.+/, inputErrorMessage: 'è¯·è¾“å…¥æ‹’ç»åŸå› ' })
                        await axios.put(`${this.baseUrl}/api/v1/admin/invoices/${invoice.id}/reject`, { reason: value }, { headers: this.uploadHeaders })
                        invoice.status = 'rejected'
                        ElMessage.success('å·²æ‹’ç»')
                    } catch (error) {
                        if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'æ“ä½œå¤±è´¥')
                    }
                },
                async confirmInvoice(invoice) {
                    try {
                        const { value } = await ElMessageBox.prompt('è¯·è¾“å…¥å‘ç¥¨å·', 'ç¡®è®¤å¼€ç¥¨', { inputPattern: /.+/, inputErrorMessage: 'è¯·è¾“å…¥å‘ç¥¨å·' })
                        await axios.put(`${this.baseUrl}/api/v1/admin/invoices/${invoice.id}/confirm`, { invoice_no: value }, { headers: this.uploadHeaders })
                        invoice.invoice_no = value
                        invoice.status = 'completed'
                        ElMessage.success('å¼€ç¥¨æˆåŠŸ')
                    } catch (error) {
                        if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'æ“ä½œå¤±è´¥')
                    }
                },
                viewInvoiceDetail(invoice) {
                    ElMessageBox.alert(`
                        <div style="line-height: 1.8;">
                            <p><strong>å‘ç¥¨å·ï¼š</strong>${invoice.invoice_no || 'æœªå¼€ç¥¨'}</p>
                            <p><strong>è®¢å•å·ï¼š</strong>${invoice.order_no}</p>
                            <p><strong>å‘ç¥¨æŠ¬å¤´ï¼š</strong>${invoice.title}</p>
                            <p><strong>ç¨å·ï¼š</strong>${invoice.tax_no}</p>
                            <p><strong>é‡‘é¢ï¼š</strong>Â¥${invoice.amount}</p>
                            <p><strong>ç±»å‹ï¼š</strong>${invoice.type === 'special' ? 'å¢å€¼ç¨ä¸“ç”¨å‘ç¥¨' : 'å¢å€¼ç¨æ™®é€šå‘ç¥¨'}</p>
                            <p><strong>çŠ¶æ€ï¼š</strong>${this.getInvoiceStatusText(invoice.status)}</p>
                        </div>
                    `, 'å‘ç¥¨è¯¦æƒ…', { dangerouslyUseHTMLString: true })
                },
                async downloadInvoice(invoice) {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/invoices/${invoice.id}/download`, {
                            headers: this.uploadHeaders,
                            responseType: 'blob'
                        })
                        const url = window.URL.createObjectURL(new Blob([res.data]))
                        const link = document.createElement('a')
                        link.href = url
                        link.setAttribute('download', `å‘ç¥¨_${invoice.invoice_no}.pdf`)
                        document.body.appendChild(link)
                        link.click()
                        link.remove()
                        ElMessage.success('ä¸‹è½½æˆåŠŸ')
                    } catch (error) {
                        ElMessage.error('ä¸‹è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
                    }
                },
                async exportInvoiceData() {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/invoices/export`, {
                            headers: this.uploadHeaders,
                            responseType: 'blob'
                        })
                        const url = window.URL.createObjectURL(new Blob([res.data]))
                        const link = document.createElement('a')
                        link.href = url
                        link.setAttribute('download', `å‘ç¥¨æ•°æ®_${new Date().toISOString().slice(0,10)}.xlsx`)
                        document.body.appendChild(link)
                        link.click()
                        link.remove()
                        ElMessage.success('å¯¼å‡ºæˆåŠŸ')
                    } catch (error) {
                        ElMessage.error('å¯¼å‡ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
                    }
                },
                // ==================== å®¢æœç®¡ç†æ–¹æ³• ====================
                async loadChatList() {
                    this.chatLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/chats`, {
                            headers: this.uploadHeaders,
                            params: { search: this.chatSearch || undefined, status: this.chatStatusFilter || undefined }
                        })
                        this.chatList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½å’¨è¯¢åˆ—è¡¨å¤±è´¥', error)
                    } finally {
                        this.chatLoading = false
                    }
                },
                async loadPhraseList() {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/phrases`, { headers: this.uploadHeaders })
                        this.phraseList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½å¸¸ç”¨è¯­å¤±è´¥', error)
                    }
                },
                async openChatDialog(chat) {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/chats/${chat.id}/messages`, { headers: this.uploadHeaders })
                        this.currentChat = { ...chat, messages: res.data.data || [] }
                        this.chatDialogVisible = true
                    } catch (error) {
                        this.currentChat = {
                            ...chat,
                            messages: [
                                { id: 1, content: 'æ‚¨å¥½ï¼Œè¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨ï¼Ÿ', is_staff: true, created_at: new Date().toISOString() }
                            ]
                        }
                        this.chatDialogVisible = true
                    }
                },
                async closeChat(chat) {
                    try {
                        await axios.put(`${this.baseUrl}/api/v1/admin/chats/${chat.id}/close`, null, { headers: this.uploadHeaders })
                        chat.status = 'completed'
                        ElMessage.success('å·²å®Œæˆ')
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'æ“ä½œå¤±è´¥')
                    }
                },
                usePhrase(content) {
                    this.replyContent = content
                    this.selectedPhrase = ''
                },
                async sendReply() {
                    if (!this.replyContent) { ElMessage.error('è¯·è¾“å…¥å›å¤å†…å®¹'); return }
                    this.currentChat.messages.push({
                        id: Date.now(),
                        content: this.replyContent,
                        is_staff: true,
                        created_at: new Date().toISOString()
                    })
                    this.replyContent = ''
                    ElMessage.success('å‘é€æˆåŠŸ')
                },
                showPhraseDialog(phrase = null) {
                    if (phrase) this.phraseForm = { ...phrase }
                    else this.phraseForm = { id: null, title: '', content: '', category: 'greeting' }
                    this.phraseDialogVisible = true
                },
                savePhrase() {
                    if (!this.phraseForm.title || !this.phraseForm.content) { ElMessage.error('è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹'); return }
                    if (this.phraseForm.id) {
                        const idx = this.phraseList.findIndex(p => p.id === this.phraseForm.id)
                        if (idx > -1) this.phraseList[idx] = { ...this.phraseList[idx], ...this.phraseForm }
                    } else {
                        this.phraseList.push({ ...this.phraseForm, id: Date.now(), use_count: 0 })
                    }
                    this.phraseDialogVisible = false
                    ElMessage.success('ä¿å­˜æˆåŠŸ')
                },
                deletePhrase(id) {
                    this.phraseList = this.phraseList.filter(p => p.id !== id)
                    ElMessage.success('åˆ é™¤æˆåŠŸ')
                },
                // ==================== è½®æ’­å›¾ç®¡ç†æ–¹æ³• ====================
                async loadBanners() {
                    this.bannerLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/banners`, { headers: this.uploadHeaders })
                        this.bannerList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½è½®æ’­å›¾å¤±è´¥', error)
                    } finally {
                        this.bannerLoading = false
                    }
                },
                showBannerDialog(banner = null) {
                    if (banner) this.bannerForm = { ...banner }
                    else this.bannerForm = { id: null, image: '', title: '', link: '', sort_order: 0, is_active: true }
                    this.bannerDialogVisible = true
                },
                async saveBanner() {
                    if (!this.bannerForm.image) { ElMessage.error('è¯·ä¸Šä¼ å›¾ç‰‡'); return }
                    this.loading = true
                    try {
                        if (this.bannerForm.id) {
                            await axios.put(`${this.baseUrl}/api/v1/admin/banners/${this.bannerForm.id}`, this.bannerForm, { headers: this.uploadHeaders })
                            ElMessage.success('æ›´æ–°æˆåŠŸ')
                        } else {
                            await axios.post(`${this.baseUrl}/api/v1/admin/banners`, this.bannerForm, { headers: this.uploadHeaders })
                            ElMessage.success('åˆ›å»ºæˆåŠŸ')
                        }
                        this.bannerDialogVisible = false
                        this.loadBanners()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ä¿å­˜å¤±è´¥')
                    } finally {
                        this.loading = false
                    }
                },
                handleBannerUpload(response) {
                    if (response.code === 200) {
                        this.bannerForm.image = response.data.url
                        ElMessage.success('å›¾ç‰‡ä¸Šä¼ æˆåŠŸ')
                    } else {
                        ElMessage.error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥')
                    }
                },
                async toggleBannerStatus(banner) {
                    try {
                        await axios.put(`${this.baseUrl}/api/v1/admin/banners/${banner.id}/status`, 
                            { is_active: banner.is_active }, { headers: this.uploadHeaders })
                        ElMessage.success(banner.is_active ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨')
                    } catch (error) {
                        banner.is_active = !banner.is_active
                        ElMessage.error(error.response?.data?.detail || 'æ“ä½œå¤±è´¥')
                    }
                },
                async deleteBanner(id) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¯¥è½®æ’­å›¾å—ï¼Ÿ', 'æç¤º', { type: 'warning' })
                        await axios.delete(`${this.baseUrl}/api/v1/admin/banners/${id}`, { headers: this.uploadHeaders })
                        ElMessage.success('åˆ é™¤æˆåŠŸ')
                        this.loadBanners()
                    } catch (error) {
                        if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'åˆ é™¤å¤±è´¥')
                    }
                },
                // ==================== å…¬å‘Šç®¡ç†æ–¹æ³• ====================
                async loadAnnouncements() {
                    this.announcementLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/announcements`, { headers: this.uploadHeaders })
                        this.announcementList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½å…¬å‘Šå¤±è´¥', error)
                    } finally {
                        this.announcementLoading = false
                    }
                },
                showAnnouncementDialog(announcement = null) {
                    if (announcement) this.announcementForm = { ...announcement }
                    else this.announcementForm = { id: null, title: '', content: '', type: 'normal', is_active: true }
                    this.announcementDialogVisible = true
                },
                async saveAnnouncement() {
                    if (!this.announcementForm.title || !this.announcementForm.content) { ElMessage.error('è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹'); return }
                    this.loading = true
                    try {
                        if (this.announcementForm.id) {
                            await axios.put(`${this.baseUrl}/api/v1/admin/announcements/${this.announcementForm.id}`, this.announcementForm, { headers: this.uploadHeaders })
                            ElMessage.success('æ›´æ–°æˆåŠŸ')
                        } else {
                            await axios.post(`${this.baseUrl}/api/v1/admin/announcements`, this.announcementForm, { headers: this.uploadHeaders })
                            ElMessage.success('å‘å¸ƒæˆåŠŸ')
                        }
                        this.announcementDialogVisible = false
                        this.loadAnnouncements()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ä¿å­˜å¤±è´¥')
                    } finally {
                        this.loading = false
                    }
                },
                async toggleAnnouncementStatus(announcement) {
                    try {
                        await axios.put(`${this.baseUrl}/api/v1/admin/announcements/${announcement.id}/status`, 
                            { is_active: announcement.is_active }, { headers: this.uploadHeaders })
                        ElMessage.success(announcement.is_active ? 'å·²å‘å¸ƒ' : 'å·²ä¸‹æ¶')
                    } catch (error) {
                        announcement.is_active = !announcement.is_active
                        ElMessage.error(error.response?.data?.detail || 'æ“ä½œå¤±è´¥')
                    }
                },
                async deleteAnnouncement(id) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¯¥å…¬å‘Šå—ï¼Ÿ', 'æç¤º', { type: 'warning' })
                        await axios.delete(`${this.baseUrl}/api/v1/admin/announcements/${id}`, { headers: this.uploadHeaders })
                        ElMessage.success('åˆ é™¤æˆåŠŸ')
                        this.loadAnnouncements()
                    } catch (error) {
                        if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'åˆ é™¤å¤±è´¥')
                    }
                },
                // ==================== å¸®åŠ©ä¸­å¿ƒæ–¹æ³• ====================
                async loadHelp() {
                    this.helpLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/help-articles`, {
                            headers: this.uploadHeaders,
                            params: { category: this.helpCategoryFilter || undefined }
                        })
                        this.helpList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½å¸®åŠ©æ–‡ç« å¤±è´¥', error)
                    } finally {
                        this.helpLoading = false
                    }
                },
                showHelpDialog(help = null) {
                    if (help) this.helpForm = { ...help }
                    else this.helpForm = { id: null, title: '', content: '', category: 'guide', sort_order: 0, is_active: true }
                    this.helpDialogVisible = true
                },
                async saveHelp() {
                    if (!this.helpForm.title || !this.helpForm.content) { ElMessage.error('è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹'); return }
                    this.loading = true
                    try {
                        if (this.helpForm.id) {
                            await axios.put(`${this.baseUrl}/api/v1/admin/help-articles/${this.helpForm.id}`, this.helpForm, { headers: this.uploadHeaders })
                            ElMessage.success('æ›´æ–°æˆåŠŸ')
                        } else {
                            await axios.post(`${this.baseUrl}/api/v1/admin/help-articles`, this.helpForm, { headers: this.uploadHeaders })
                            ElMessage.success('åˆ›å»ºæˆåŠŸ')
                        }
                        this.helpDialogVisible = false
                        this.loadHelp()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ä¿å­˜å¤±è´¥')
                    } finally {
                        this.loading = false
                    }
                },
                async deleteHelp(id) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¯¥æ–‡ç« å—ï¼Ÿ', 'æç¤º', { type: 'warning' })
                        await axios.delete(`${this.baseUrl}/api/v1/admin/help-articles/${id}`, { headers: this.uploadHeaders })
                        ElMessage.success('åˆ é™¤æˆåŠŸ')
                        this.loadHelp()
                    } catch (error) {
                        if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'åˆ é™¤å¤±è´¥')
                    }
                },
                // ==================== åŠ ç›Ÿç®¡ç†æ–¹æ³• ====================
                async loadFranchise() {
                    this.franchiseLoading = true
                    try {
                        const [appRes, franchiseeRes] = await Promise.all([
                            axios.get(`${this.baseUrl}/api/v1/admin/franchise/applications`, {
                                headers: this.uploadHeaders,
                                params: { status: this.franchiseStatusFilter || undefined }
                            }),
                            axios.get(`${this.baseUrl}/api/v1/admin/franchise/franchisees`, { headers: this.uploadHeaders })
                        ])
                        this.franchiseApplicationList = appRes.data.data?.items || appRes.data.data || []
                        this.franchiseeList = franchiseeRes.data.data?.items || franchiseeRes.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½åŠ ç›Ÿæ•°æ®å¤±è´¥', error)
                    } finally {
                        this.franchiseLoading = false
                    }
                },
                async approveFranchise(app) {
                    try {
                        await axios.put(`${this.baseUrl}/api/v1/admin/franchise/applications/${app.id}/approve`, null, { headers: this.uploadHeaders })
                        app.status = 'approved'
                        ElMessage.success('å·²é€šè¿‡')
                        this.loadFranchise()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'æ“ä½œå¤±è´¥')
                    }
                },
                async rejectFranchise(app) {
                    try {
                        const { value } = await ElMessageBox.prompt('è¯·è¾“å…¥æ‹’ç»åŸå› ', 'æ‹’ç»ç”³è¯·', { inputPattern: /.+/, inputErrorMessage: 'è¯·è¾“å…¥æ‹’ç»åŸå› ' })
                        await axios.put(`${this.baseUrl}/api/v1/admin/franchise/applications/${app.id}/reject`, { reason: value }, { headers: this.uploadHeaders })
                        app.status = 'rejected'
                        ElMessage.success('å·²æ‹’ç»')
                    } catch (error) {
                        if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'æ“ä½œå¤±è´¥')
                    }
                },
                viewFranchiseDetail(app) {
                    ElMessageBox.alert(`
                        <div style="line-height: 1.8;">
                            <p><strong>å…¬å¸åç§°ï¼š</strong>${app.company_name}</p>
                            <p><strong>è”ç³»äººï¼š</strong>${app.contact_name}</p>
                            <p><strong>è”ç³»ç”µè¯ï¼š</strong>${app.contact_phone}</p>
                            <p><strong>æ‰€åœ¨åŸå¸‚ï¼š</strong>${app.city}</p>
                            <p><strong>ç»è¥ç±»å‹ï¼š</strong>${app.business_type}</p>
                            <p><strong>ç”³è¯·æ—¶é—´ï¼š</strong>${this.formatDateTime(app.created_at)}</p>
                        </div>
                    `, 'åŠ ç›Ÿç”³è¯·è¯¦æƒ…', { dangerouslyUseHTMLString: true })
                },
                editFranchisee(franchisee) {
                    this.franchiseeForm = { ...franchisee }
                    this.franchiseeDialogVisible = true
                },
                async toggleFranchiseeStatus(franchisee) {
                    try {
                        await axios.put(`${this.baseUrl}/api/v1/admin/franchise/franchisees/${franchisee.id}/status`, 
                            { is_active: !franchisee.is_active }, { headers: this.uploadHeaders })
                        franchisee.is_active = !franchisee.is_active
                        ElMessage.success(franchisee.is_active ? 'å·²å¯ç”¨' : 'å·²åœç”¨')
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'æ“ä½œå¤±è´¥')
                    }
                },
                // ==================== æ•°æ®åˆ†ææ–¹æ³• ====================
                async loadAnalyticsData() {
                    try {
                        const params = {}
                        if (this.analyticsDateRange && this.analyticsDateRange.length === 2) {
                            params.start_date = this.analyticsDateRange[0]
                            params.end_date = this.analyticsDateRange[1]
                        }
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/analytics`, { headers: this.uploadHeaders, params })
                        if (res.data.data) {
                            this.analyticsData = { ...this.analyticsData, ...res.data.data }
                        }
                    } catch (error) {
                        console.error('åŠ è½½åˆ†ææ•°æ®å¤±è´¥', error)
                    }
                },
                async exportAnalyticsData() {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/analytics/export`, {
                            headers: this.uploadHeaders,
                            responseType: 'blob',
                            params: this.analyticsDateRange ? { start_date: this.analyticsDateRange[0], end_date: this.analyticsDateRange[1] } : {}
                        })
                        const url = window.URL.createObjectURL(new Blob([res.data]))
                        const link = document.createElement('a')
                        link.href = url
                        link.setAttribute('download', `æ•°æ®åˆ†ææŠ¥è¡¨_${new Date().toISOString().slice(0,10)}.xlsx`)
                        document.body.appendChild(link)
                        link.click()
                        link.remove()
                        ElMessage.success('å¯¼å‡ºæˆåŠŸ')
                    } catch (error) {
                        ElMessage.error('å¯¼å‡ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
                    }
                },
                // ==================== æŠ˜æ‰£è®¾ç½®æ–¹æ³• ====================
                async loadDiscounts() {
                    this.discountLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/discounts`, { headers: this.uploadHeaders })
                        this.discountList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½æŠ˜æ‰£åˆ—è¡¨å¤±è´¥', error)
                    } finally {
                        this.discountLoading = false
                    }
                },
                showDiscountDialog(discount = null) {
                    if (discount) this.discountForm = { ...discount, dateRange: [discount.start_date, discount.end_date] }
                    else this.discountForm = { id: null, name: '', discount_rate: 0.9, apply_to: 'all', dateRange: null, is_active: true }
                    this.discountDialogVisible = true
                },
                async saveDiscount() {
                    if (!this.discountForm.name || !this.discountForm.dateRange) { ElMessage.error('è¯·å¡«å†™æŠ˜æ‰£åç§°å’Œæœ‰æ•ˆæœŸ'); return }
                    const [start_date, end_date] = this.discountForm.dateRange
                    const data = { ...this.discountForm, start_date, end_date }
                    delete data.dateRange
                    this.loading = true
                    try {
                        if (this.discountForm.id) {
                            await axios.put(`${this.baseUrl}/api/v1/admin/discounts/${this.discountForm.id}`, data, { headers: this.uploadHeaders })
                            ElMessage.success('æ›´æ–°æˆåŠŸ')
                        } else {
                            await axios.post(`${this.baseUrl}/api/v1/admin/discounts`, data, { headers: this.uploadHeaders })
                            ElMessage.success('åˆ›å»ºæˆåŠŸ')
                        }
                        this.discountDialogVisible = false
                        this.loadDiscounts()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ä¿å­˜å¤±è´¥')
                    } finally {
                        this.loading = false
                    }
                },
                async toggleDiscountStatus(discount) {
                    try {
                        await axios.put(`${this.baseUrl}/api/v1/admin/discounts/${discount.id}/status`, 
                            { is_active: discount.is_active }, { headers: this.uploadHeaders })
                        ElMessage.success(discount.is_active ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨')
                    } catch (error) {
                        discount.is_active = !discount.is_active
                        ElMessage.error(error.response?.data?.detail || 'æ“ä½œå¤±è´¥')
                    }
                },
                async deleteDiscount(id) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¯¥æŠ˜æ‰£æ´»åŠ¨å—ï¼Ÿ', 'æç¤º', { type: 'warning' })
                        await axios.delete(`${this.baseUrl}/api/v1/admin/discounts/${id}`, { headers: this.uploadHeaders })
                        ElMessage.success('åˆ é™¤æˆåŠŸ')
                        this.loadDiscounts()
                    } catch (error) {
                        if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'åˆ é™¤å¤±è´¥')
                    }
                },
                // ==================== æŠ½å¥–æ´»åŠ¨æ–¹æ³• ====================
                async loadLotteries() {
                    this.lotteryLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/lotteries`, { headers: this.uploadHeaders })
                        this.lotteryList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½æŠ½å¥–æ´»åŠ¨å¤±è´¥', error)
                    } finally {
                        this.lotteryLoading = false
                    }
                },
                showLotteryDialog(lottery = null) {
                    if (lottery) this.lotteryForm = { ...lottery }
                    else this.lotteryForm = { id: null, name: '', start_date: '', end_date: '' }
                    this.lotteryDialogVisible = true
                },
                async viewLotteryPrizes(lottery) {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/lotteries/${lottery.id}/prizes`, { headers: this.uploadHeaders })
                        const prizes = res.data.data || []
                        ElMessageBox.alert(`
                            <div><h4>${lottery.name} å¥–å“é…ç½®</h4>
                            ${prizes.length > 0 ? prizes.map(p => `<p>â€¢ ${p.name} - æ¦‚ç‡${p.probability}% - å‰©ä½™${p.remaining}</p>`).join('') : '<p>æš‚æ— å¥–å“é…ç½®</p>'}
                            </div>
                        `, 'å¥–å“é…ç½®', { dangerouslyUseHTMLString: true })
                    } catch (error) {
                        ElMessage.info(`${lottery.name} å¥–å“é…ç½®`)
                    }
                },
                async viewLotteryRecords(lottery) {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/lotteries/${lottery.id}/records`, { headers: this.uploadHeaders })
                        const records = res.data.data || []
                        ElMessageBox.alert(`
                            <div><h4>${lottery.name} ä¸­å¥–è®°å½• (${records.length}æ¡)</h4>
                            ${records.length > 0 ? records.slice(0, 10).map(r => `<p>â€¢ ${r.user_name} - ${r.prize_name} - ${this.formatDateTime(r.created_at)}</p>`).join('') : '<p>æš‚æ— ä¸­å¥–è®°å½•</p>'}
                            </div>
                        `, 'ä¸­å¥–è®°å½•', { dangerouslyUseHTMLString: true })
                    } catch (error) {
                        ElMessage.info(`${lottery.name} ä¸­å¥–è®°å½•`)
                    }
                },
                // ==================== äºŒç»´ç æ¨å¹¿æ–¹æ³• ====================
                async loadQrcodes() {
                    this.qrcodeLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/qrcodes`, { headers: this.uploadHeaders })
                        this.qrcodeList = res.data.data?.items || res.data.data || []
                    } catch (error) {
                        console.error('åŠ è½½äºŒç»´ç å¤±è´¥', error)
                    } finally {
                        this.qrcodeLoading = false
                    }
                },
                showQrcodeDialog() {
                    this.qrcodeForm = { name: '', scene: 'register', target_id: null }
                    this.qrcodeDialogVisible = true
                },
                async generateQrcode() {
                    if (!this.qrcodeForm.name) { ElMessage.error('è¯·å¡«å†™åç§°'); return }
                    this.loading = true
                    try {
                        const res = await axios.post(`${this.baseUrl}/api/v1/admin/qrcodes`, this.qrcodeForm, { headers: this.uploadHeaders })
                        ElMessage.success('äºŒç»´ç ç”ŸæˆæˆåŠŸ')
                        this.qrcodeDialogVisible = false
                        this.loadQrcodes()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ç”Ÿæˆå¤±è´¥')
                    } finally {
                        this.loading = false
                    }
                },
                async downloadQrcode(qrcode) {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/qrcodes/${qrcode.id}/download`, {
                            headers: this.uploadHeaders,
                            responseType: 'blob'
                        })
                        const url = window.URL.createObjectURL(new Blob([res.data]))
                        const link = document.createElement('a')
                        link.href = url
                        link.setAttribute('download', `äºŒç»´ç _${qrcode.name}.png`)
                        document.body.appendChild(link)
                        link.click()
                        link.remove()
                        ElMessage.success('ä¸‹è½½æˆåŠŸ')
                    } catch (error) {
                        // å¦‚æœAPIä¸å¯ç”¨ï¼Œä½¿ç”¨å›¾ç‰‡URLç›´æ¥ä¸‹è½½
                        if (qrcode.qrcode_url) {
                            const link = document.createElement('a')
                            link.href = qrcode.qrcode_url
                            link.setAttribute('download', `äºŒç»´ç _${qrcode.name}.png`)
                            link.click()
                        } else {
                            ElMessage.error('ä¸‹è½½å¤±è´¥')
                        }
                    }
                },
                copyQrcodeLink(qrcode) {
                    const link = qrcode.share_url || `${window.location.origin}/share?qr=${qrcode.id}`
                    navigator.clipboard.writeText(link).then(() => {
                        ElMessage.success('é“¾æ¥å·²å¤åˆ¶')
                    }).catch(() => {
                        // å…¼å®¹æ—§æµè§ˆå™¨
                        const textarea = document.createElement('textarea')
                        textarea.value = link
                        document.body.appendChild(textarea)
                        textarea.select()
                        document.execCommand('copy')
                        document.body.removeChild(textarea)
                        ElMessage.success('é“¾æ¥å·²å¤åˆ¶')
                    })
                },
                async deleteQrcode(id) {
                    try {
                        await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¯¥äºŒç»´ç å—ï¼Ÿ', 'æç¤º', { type: 'warning' })
                        await axios.delete(`${this.baseUrl}/api/v1/admin/qrcodes/${id}`, { headers: this.uploadHeaders })
                        ElMessage.success('åˆ é™¤æˆåŠŸ')
                        this.loadQrcodes()
                    } catch (error) {
                        if (error !== 'cancel') ElMessage.error(error.response?.data?.detail || 'åˆ é™¤å¤±è´¥')
                    }
                },
                // ==================== ç§¯åˆ†è®¾ç½®æ–¹æ³• ====================
                async savePointsSettings() {
                    this.loading = true
                    try {
                        await axios.put(`${this.baseUrl}/api/v1/admin/settings/points`, this.pointsSettings, { headers: this.uploadHeaders })
                        ElMessage.success('ç§¯åˆ†è®¾ç½®å·²ä¿å­˜')
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ä¿å­˜å¤±è´¥')
                    } finally {
                        this.loading = false
                    }
                },
                // ==================== è®¢å•æŒ‡æ´¾APIæ–¹æ³• ====================
                async confirmAssignAPI() {
                    if (!this.assignForm.assignee_id) {
                        ElMessage.error('è¯·é€‰æ‹©æŒ‡æ´¾äººå‘˜')
                        return
                    }
                    this.loading = true
                    try {
                        await axios.post(`${this.baseUrl}/api/v1/admin/orders/assign`, {
                            order_ids: this.assignForm.order_ids,
                            assignee_id: this.assignForm.assignee_id,
                            remark: this.assignForm.remark
                        }, { headers: this.uploadHeaders })
                        const staff = this.labStaffList.find(s => s.id === this.assignForm.assignee_id)
                        ElMessage.success(`å·²æˆåŠŸæŒ‡æ´¾ç»™ ${staff?.name}`)
                        this.assignDialogVisible = false
                        this.selectedOrders = []
                        this.loadOrders()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'æŒ‡æ´¾å¤±è´¥')
                    } finally {
                        this.loading = false
                    }
                },
                // ==================== å¯¼å‡ºæ–¹æ³• ====================
                async exportUsers() {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/users/export`, {
                            headers: this.uploadHeaders,
                            responseType: 'blob'
                        })
                        const url = window.URL.createObjectURL(new Blob([res.data]))
                        const link = document.createElement('a')
                        link.href = url
                        link.setAttribute('download', `ç”¨æˆ·æ•°æ®_${new Date().toISOString().slice(0,10)}.xlsx`)
                        document.body.appendChild(link)
                        link.click()
                        link.remove()
                        ElMessage.success('å¯¼å‡ºæˆåŠŸ')
                    } catch (error) {
                        ElMessage.error('å¯¼å‡ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
                    }
                },
                async exportOrders() {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/orders/export`, {
                            headers: this.uploadHeaders,
                            responseType: 'blob',
                            params: { search: this.orderSearch || undefined, status: this.orderStatusFilter || undefined }
                        })
                        const url = window.URL.createObjectURL(new Blob([res.data]))
                        const link = document.createElement('a')
                        link.href = url
                        link.setAttribute('download', `è®¢å•æ•°æ®_${new Date().toISOString().slice(0,10)}.xlsx`)
                        document.body.appendChild(link)
                        link.click()
                        link.remove()
                        ElMessage.success('å¯¼å‡ºæˆåŠŸ')
                    } catch (error) {
                        ElMessage.error('å¯¼å‡ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
                    }
                },
                // ==================== åŠ è½½å®éªŒå®¤å‘˜å·¥ ====================
                async loadLabStaff() {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/admin/staff`, {
                            headers: this.uploadHeaders,
                            params: { role_code: 'lab' }
                        })
                        this.labStaffList = res.data.data?.items || res.data.data || this.labStaffList
                    } catch (error) {
                        console.error('åŠ è½½å®éªŒå®¤äººå‘˜å¤±è´¥', error)
                    }
                }
            }
        }).use(ElementPlus).mount('#app')
    </script>
</body>
</html>
