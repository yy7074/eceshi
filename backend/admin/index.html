<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁßëÁ†îÊ£ÄÊµãÊúçÂä°Âπ≥Âè∞ - ÂêéÂè∞ÁÆ°ÁêÜ</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/element-plus"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-plus/dist/index.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB',
                'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .login-box {
            width: 450px;
            padding: 40px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        .admin-layout {
            height: 100vh;
        }
        .admin-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            background: #001529;
            color: white;
            height: 60px;
        }
        .admin-header h2 {
            margin: 0;
            font-size: 18px;
        }
        .admin-container {
            height: calc(100vh - 60px);
        }
        .admin-aside {
            background: #001529;
            color: white;
        }
        .admin-aside .el-menu {
            border-right: none;
            background-color: #001529;
        }
        .admin-main {
            background: #f0f2f5;
            overflow-y: auto;
            padding: 20px;
        }
        .page-header {
            background: white;
            padding: 16px 24px;
            margin-bottom: 16px;
            border-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.03);
        }
        .page-header h3 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
            color: #262626;
        }
        .content-card {
            background: white;
            border-radius: 4px;
            padding: 24px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.03);
            margin-bottom: 16px;
        }
        .image-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        .image-item {
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            overflow: hidden;
            transition: all 0.3s;
        }
        .image-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        .image-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        .image-item-footer {
            padding: 8px;
            background: #f5f5f5;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ÁôªÂΩïÈ°µÈù¢ -->
        <div v-if="!token" class="login-container">
            <div class="login-box">
                <h2 style="text-align: center; margin-bottom: 30px;">üî¨ ÂêéÂè∞ÁÆ°ÁêÜÁôªÂΩï</h2>
                
                <el-tabs v-model="loginType">
                    <!-- ÁÆ°ÁêÜÂëòÁôªÂΩï -->
                    <el-tab-pane label="ÁÆ°ÁêÜÂëòÁôªÂΩï" name="admin">
                        <el-form :model="adminLoginForm" @submit.prevent="handleAdminLogin">
                            <el-form-item label="Áî®Êà∑Âêç">
                                <el-input v-model="adminLoginForm.username" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç"></el-input>
                            </el-form-item>
                            <el-form-item label="ÂØÜÁ†Å">
                                <el-input 
                                    v-model="adminLoginForm.password" 
                                    type="password" 
                                    placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å"
                                    show-password
                                    @keyup.enter="handleAdminLogin"></el-input>
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" @click="handleAdminLogin" style="width: 100%;" :loading="loading">
                                    ÁôªÂΩï
                                </el-button>
                            </el-form-item>
                            <el-alert title="ÈªòËÆ§Ë¥¶Âè∑: admin / 123456" type="info" :closable="false" show-icon />
                        </el-form>
                    </el-tab-pane>
                    
                    <!-- Áü≠‰ø°ÁôªÂΩï -->
                    <el-tab-pane label="Áü≠‰ø°ÁôªÂΩï" name="sms">
                        <el-form :model="loginForm" @submit.prevent="handleLogin">
                            <el-form-item label="ÊâãÊú∫Âè∑">
                                <el-input v-model="loginForm.phone" placeholder="ËØ∑ËæìÂÖ•ÊâãÊú∫Âè∑"></el-input>
                            </el-form-item>
                            <el-form-item label="È™åËØÅÁ†Å">
                                <el-input v-model="loginForm.sms_code" placeholder="ËØ∑ËæìÂÖ•È™åËØÅÁ†Å">
                                    <template #append>
                                        <el-button @click="sendSms" :disabled="countdown > 0">
                                            {{ countdown > 0 ? `${countdown}ÁßíÂêéÈáçËØï` : 'Ëé∑ÂèñÈ™åËØÅÁ†Å' }}
                                        </el-button>
                                    </template>
                                </el-input>
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" @click="handleLogin" style="width: 100%;" :loading="loading">
                                    ÁôªÂΩï
                                </el-button>
                            </el-form-item>
                        </el-form>
                    </el-tab-pane>
                </el-tabs>
            </div>
        </div>

        <!-- ÂêéÂè∞ÁÆ°ÁêÜ‰∏ªÁïåÈù¢ -->
        <el-container v-else class="admin-layout">
            <!-- È°∂ÈÉ® -->
            <el-header class="admin-header" height="60px">
                <div>
                    <h2>üî¨ ÁßëÁ†îÊ£ÄÊµãÊúçÂä°Âπ≥Âè∞ - ÂêéÂè∞ÁÆ°ÁêÜ</h2>
                </div>
                <div>
                    <el-dropdown>
                        <span style="cursor: pointer; color: white;">
                            {{ userInfo.nickname || 'ÁÆ°ÁêÜÂëò' }}
                            <el-icon style="margin-left: 5px;"><arrow-down /></el-icon>
                        </span>
                        <template #dropdown>
                            <el-dropdown-menu>
                                <el-dropdown-item @click="logout">
                                    <el-icon><switch-button /></el-icon>
                                    ÈÄÄÂá∫ÁôªÂΩï
                                </el-dropdown-item>
                            </el-dropdown-menu>
                        </template>
                    </el-dropdown>
                </div>
            </el-header>

            <!-- ‰∏ª‰Ωì -->
            <el-container class="admin-container">
                <!-- Â∑¶‰æßËèúÂçï -->
                <el-aside class="admin-aside" width="200px">
                    <el-menu
                        :default-active="activeMenu"
                        background-color="#001529"
                        text-color="#fff"
                        active-text-color="#409EFF"
                        @select="handleMenuSelect">
                        <el-menu-item index="users">
                            <el-icon><user /></el-icon>
                            <span>Áî®Êà∑ÁÆ°ÁêÜ</span>
                        </el-menu-item>
                        <el-menu-item index="projects">
                            <el-icon><picture /></el-icon>
                            <span>È°πÁõÆÁÆ°ÁêÜ</span>
                        </el-menu-item>
                        <el-menu-item index="orders">
                            <el-icon><document /></el-icon>
                            <span>ËÆ¢ÂçïÁÆ°ÁêÜ</span>
                        </el-menu-item>
                        <el-menu-item index="settings">
                            <el-icon><setting /></el-icon>
                            <span>Á≥ªÁªüËÆæÁΩÆ</span>
                        </el-menu-item>
                    </el-menu>
                </el-aside>

                <!-- Âè≥‰æßÂÜÖÂÆπ -->
                <el-main class="admin-main">
                    <!-- Áî®Êà∑ÁÆ°ÁêÜ -->
                    <div v-show="activeMenu === 'users'">
                        <div class="page-header">
                            <h3>üë• Áî®Êà∑ÁÆ°ÁêÜ</h3>
                        </div>

                        <div class="content-card">
                            <div style="margin-bottom: 20px;">
                                <el-input 
                                    v-model="userSearch" 
                                    placeholder="ÊêúÁ¥¢ÊâãÊú∫Âè∑ÊàñÊòµÁß∞"
                                    style="width: 300px; margin-right: 10px;"
                                    @change="loadUsers">
                                    <template #prefix>
                                        <el-icon><search /></el-icon>
                                    </template>
                                </el-input>
                                <el-button type="primary" @click="loadUsers">ÊêúÁ¥¢</el-button>
                                <el-button @click="userSearch=''; loadUsers()">ÈáçÁΩÆ</el-button>
                            </div>

                            <el-table :data="users" style="width: 100%" v-loading="usersLoading">
                                <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                <el-table-column label="Â§¥ÂÉè" width="80">
                                    <template #default="scope">
                                        <el-avatar 
                                            :size="40" 
                                            :src="scope.row.avatar ? baseUrl + scope.row.avatar : undefined">
                                            {{ scope.row.nickname ? scope.row.nickname[0] : '?' }}
                                        </el-avatar>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="nickname" label="ÊòµÁß∞" width="120"></el-table-column>
                                <el-table-column prop="phone" label="ÊâãÊú∫Âè∑" width="130">
                                    <template #default="scope">
                                        {{ scope.row.phone || 'Êú™ÁªëÂÆö' }}
                                    </template>
                                </el-table-column>
                                <el-table-column label="ÁôªÂΩïÊñπÂºè" width="100">
                                    <template #default="scope">
                                        <el-tag v-if="scope.row.wechat_openid" type="success" size="small">ÂæÆ‰ø°</el-tag>
                                        <el-tag v-if="scope.row.phone" type="info" size="small">ÊâãÊú∫</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="credit_limit" label="‰ø°Áî®È¢ùÂ∫¶" width="100">
                                    <template #default="scope">
                                        ¬•{{ scope.row.credit_limit }}
                                    </template>
                                </el-table-column>
                                <el-table-column prop="total_spent" label="Á¥ØËÆ°Ê∂àË¥π" width="100">
                                    <template #default="scope">
                                        ¬•{{ scope.row.total_spent }}
                                    </template>
                                </el-table-column>
                                <el-table-column prop="total_orders" label="ËÆ¢ÂçïÊï∞" width="80"></el-table-column>
                                <el-table-column label="Áä∂ÊÄÅ" width="80">
                                    <template #default="scope">
                                        <el-tag 
                                            :type="scope.row.status === 'active' ? 'success' : 'danger'" 
                                            size="small">
                                            {{ getStatusText(scope.row.status) }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="created_at" label="Ê≥®ÂÜåÊó∂Èó¥" width="170">
                                    <template #default="scope">
                                        {{ formatDate(scope.row.created_at) }}
                                    </template>
                                </el-table-column>
                                <el-table-column label="Êìç‰Ωú" width="200" fixed="right">
                                    <template #default="scope">
                                        <el-button type="primary" size="small" @click="viewUser(scope.row)">
                                            Êü•Áúã
                                        </el-button>
                                        <el-button 
                                            v-if="scope.row.status === 'active'"
                                            type="danger" 
                                            size="small" 
                                            @click="updateUserStatus(scope.row.id, 'banned')">
                                            Á¶ÅÁî®
                                        </el-button>
                                        <el-button 
                                            v-else
                                            type="success" 
                                            size="small" 
                                            @click="updateUserStatus(scope.row.id, 'active')">
                                            ÊøÄÊ¥ª
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <el-pagination
                                v-model:current-page="userPage"
                                v-model:page-size="userPageSize"
                                :page-sizes="[10, 20, 50, 100]"
                                :total="userTotal"
                                layout="total, sizes, prev, pager, next, jumper"
                                @size-change="loadUsers"
                                @current-change="loadUsers"
                                style="margin-top: 20px; justify-content: center;">
                            </el-pagination>

                            <!-- Áî®Êà∑ËØ¶ÊÉÖÂØπËØùÊ°Ü -->
                            <el-dialog v-model="userDialogVisible" title="Áî®Êà∑ËØ¶ÊÉÖ" width="700px">
                                <div v-if="selectedUser" style="display: flex; gap: 20px;">
                                    <!-- Â∑¶‰æßÂ§¥ÂÉè -->
                                    <div style="flex-shrink: 0; text-align: center;">
                                        <el-avatar 
                                            :size="120" 
                                            :src="selectedUser.avatar ? baseUrl + selectedUser.avatar : undefined"
                                            style="margin-bottom: 12px;">
                                            {{ selectedUser.nickname ? selectedUser.nickname[0] : '?' }}
                                        </el-avatar>
                                        <div>
                                            <el-button size="small" @click="avatarUploadVisible = true; currentEditUserId = selectedUser.id">
                                                ‰øÆÊîπÂ§¥ÂÉè
                                            </el-button>
                                        </div>
                                    </div>
                                    
                                    <!-- Âè≥‰æßËØ¶ÊÉÖ -->
                                    <div style="flex: 1;">
                                        <el-descriptions :column="2" border>
                                            <el-descriptions-item label="Áî®Êà∑ID">{{ selectedUser.id }}</el-descriptions-item>
                                            <el-descriptions-item label="ÊòµÁß∞">{{ selectedUser.nickname }}</el-descriptions-item>
                                            <el-descriptions-item label="ÊâãÊú∫Âè∑">{{ selectedUser.phone || 'Êú™ÁªëÂÆö' }}</el-descriptions-item>
                                            <el-descriptions-item label="ÈÇÆÁÆ±">{{ selectedUser.email || 'Êú™Â°´ÂÜô' }}</el-descriptions-item>
                                            <el-descriptions-item label="ÂæÆ‰ø°OpenID" :span="2">
                                                {{ selectedUser.wechat_openid || 'Êú™ÁªëÂÆö' }}
                                            </el-descriptions-item>
                                            <el-descriptions-item label="ÂÆûÂêçËÆ§ËØÅ">
                                                <el-tag :type="selectedUser.is_certified ? 'success' : 'info'" size="small">
                                                    {{ selectedUser.is_certified ? 'Â∑≤ËÆ§ËØÅ' : 'Êú™ËÆ§ËØÅ' }}
                                                </el-tag>
                                            </el-descriptions-item>
                                            <el-descriptions-item label="‰ºöÂëòÁ≠âÁ∫ß">
                                                {{ getMemberLevelText(selectedUser.membership_level) }}
                                            </el-descriptions-item>
                                            <el-descriptions-item label="‰ø°Áî®È¢ùÂ∫¶">¬•{{ selectedUser.credit_limit }}</el-descriptions-item>
                                            <el-descriptions-item label="Â∑≤Áî®È¢ùÂ∫¶">¬•{{ selectedUser.used_credit }}</el-descriptions-item>
                                            <el-descriptions-item label="È¢Ñ‰ªò‰ΩôÈ¢ù">¬•{{ selectedUser.prepaid_balance }}</el-descriptions-item>
                                            <el-descriptions-item label="ÁßØÂàÜ‰ΩôÈ¢ù">{{ selectedUser.points_balance }}</el-descriptions-item>
                                            <el-descriptions-item label="Á¥ØËÆ°Ê∂àË¥π">¬•{{ selectedUser.total_spent }}</el-descriptions-item>
                                            <el-descriptions-item label="ËÆ¢ÂçïÊÄªÊï∞">{{ selectedUser.total_orders }}</el-descriptions-item>
                                            <el-descriptions-item label="Ë¥¶Êà∑Áä∂ÊÄÅ">
                                                <el-tag :type="selectedUser.status === 'active' ? 'success' : 'danger'" size="small">
                                                    {{ getStatusText(selectedUser.status) }}
                                                </el-tag>
                                            </el-descriptions-item>
                                            <el-descriptions-item label="Ê≥®ÂÜåÊó∂Èó¥">{{ formatDate(selectedUser.created_at) }}</el-descriptions-item>
                                            <el-descriptions-item label="ÊúÄÂêéÁôªÂΩï">{{ formatDate(selectedUser.last_login_at) }}</el-descriptions-item>
                                        </el-descriptions>
                                    </div>
                                </div>
                            </el-dialog>

                            <!-- ‰øÆÊîπÂ§¥ÂÉèÂØπËØùÊ°Ü -->
                            <el-dialog v-model="avatarUploadVisible" title="‰øÆÊîπÁî®Êà∑Â§¥ÂÉè" width="400px">
                                <el-upload
                                    drag
                                    :action="uploadUrl"
                                    :headers="uploadHeaders"
                                    :on-success="handleAvatarUploadSuccess"
                                    :before-upload="beforeUpload"
                                    accept="image/*">
                                    <el-icon class="el-icon--upload"><upload-filled /></el-icon>
                                    <div class="el-upload__text">
                                        Â∞ÜÂ§¥ÂÉèÊãñÂà∞Ê≠§Â§ÑÔºåÊàñ<em>ÁÇπÂáª‰∏ä‰º†</em>
                                    </div>
                                    <template #tip>
                                        <div class="el-upload__tip">
                                            Âª∫ËÆÆÂ∞∫ÂØ∏ 200x200pxÔºåÊîØÊåÅ jpg/png Ê†ºÂºè
                                        </div>
                                    </template>
                                </el-upload>
                            </el-dialog>
                        </div>
                    </div>

                    <!-- È°πÁõÆÁÆ°ÁêÜ -->
                    <div v-show="activeMenu === 'projects'">
                        <div class="page-header">
                            <h3>üì∏ È°πÁõÆÁÆ°ÁêÜ</h3>
                        </div>
                        
                        <div class="content-card">
                            <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <el-input 
                                        v-model="projectSearch" 
                                        placeholder="ÊêúÁ¥¢È°πÁõÆÂêçÁß∞ÊàñÁºñÂè∑"
                                        style="width: 300px; margin-right: 10px;"
                                        @change="loadProjects">
                                        <template #prefix>
                                            <el-icon><search /></el-icon>
                                        </template>
                                    </el-input>
                                    <el-select v-model="projectCategoryFilter" placeholder="ÈÄâÊã©ÂàÜÁ±ª" style="width: 150px; margin-right: 10px;" @change="loadProjects" clearable>
                                        <el-option v-for="cat in categories" :key="cat.id" :label="cat.name" :value="cat.id"></el-option>
                                    </el-select>
                                    <el-button type="primary" @click="loadProjects">ÊêúÁ¥¢</el-button>
                                    <el-button @click="projectSearch=''; projectCategoryFilter=null; loadProjects()">ÈáçÁΩÆ</el-button>
                                </div>
                                <el-button type="primary" @click="showProjectDialog()">
                                    <el-icon><plus /></el-icon> Ê∑ªÂä†È°πÁõÆ
                                </el-button>
                            </div>

                            <el-table :data="projects" style="width: 100%" v-loading="projectsLoading">
                                <el-table-column prop="id" label="ID" width="60"></el-table-column>
                                <el-table-column label="Â∞ÅÈù¢" width="80">
                                    <template #default="scope">
                                        <el-image 
                                            v-if="scope.row.cover_image"
                                            :src="scope.row.cover_image" 
                                            style="width: 60px; height: 60px; border-radius: 4px;"
                                            fit="cover"
                                            :preview-src-list="[scope.row.cover_image]">
                                        </el-image>
                                        <span v-else style="color: #ccc;">Êó†</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="project_no" label="ÁºñÂè∑" width="100"></el-table-column>
                                <el-table-column prop="name" label="È°πÁõÆÂêçÁß∞" width="200" show-overflow-tooltip></el-table-column>
                                <el-table-column prop="category_name" label="ÂàÜÁ±ª" width="120"></el-table-column>
                                <el-table-column label="‰ª∑Ê†º" width="120">
                                    <template #default="scope">
                                        <div>¬•{{ scope.row.current_price }}</div>
                                        <div style="font-size: 12px; color: #999; text-decoration: line-through;">¬•{{ scope.row.original_price }}</div>
                                    </template>
                                </el-table-column>
                                <el-table-column label="Ê†áÁ≠æ" width="120">
                                    <template #default="scope">
                                        <el-tag v-if="scope.row.is_hot" type="danger" size="small" style="margin-right: 5px;">ÁÉ≠Èó®</el-tag>
                                        <el-tag v-if="scope.row.is_recommended" type="warning" size="small">Êé®Ëçê</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="ÁªüËÆ°" width="100">
                                    <template #default="scope">
                                        <div style="font-size: 12px;">ÊµèËßà: {{ scope.row.view_count }}</div>
                                        <div style="font-size: 12px;">È¢ÑÁ∫¶: {{ scope.row.booking_count }}</div>
                                    </template>
                                </el-table-column>
                                <el-table-column label="Áä∂ÊÄÅ" width="80">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.status === 'active' ? 'success' : 'info'" size="small">
                                            {{ scope.row.status === 'active' ? '‰∏äÊû∂' : '‰∏ãÊû∂' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="Êìç‰Ωú" width="240" fixed="right">
                                    <template #default="scope">
                                        <el-button type="primary" size="small" @click="showProjectDialog(scope.row)">ÁºñËæë</el-button>
                                        <el-button 
                                            v-if="scope.row.status === 'active'"
                                            type="warning" 
                                            size="small" 
                                            @click="updateProjectStatus(scope.row.id, 'inactive')">
                                            ‰∏ãÊû∂
                                        </el-button>
                                        <el-button 
                                            v-else
                                            type="success" 
                                            size="small" 
                                            @click="updateProjectStatus(scope.row.id, 'active')">
                                            ‰∏äÊû∂
                                        </el-button>
                                        <el-button type="danger" size="small" @click="deleteProject(scope.row.id)">Âà†Èô§</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <el-pagination
                                v-model:current-page="projectPage"
                                v-model:page-size="projectPageSize"
                                :page-sizes="[10, 20, 50]"
                                :total="projectTotal"
                                layout="total, sizes, prev, pager, next, jumper"
                                @size-change="loadProjects"
                                @current-change="loadProjects"
                                style="margin-top: 20px; justify-content: center;">
                            </el-pagination>

                            <!-- Ê∑ªÂä†/ÁºñËæëÈ°πÁõÆÂØπËØùÊ°Ü -->
                            <el-dialog 
                                v-model="projectDialogVisible" 
                                :title="projectForm.id ? 'ÁºñËæëÈ°πÁõÆ' : 'Ê∑ªÂä†È°πÁõÆ'" 
                                width="600px">
                                <el-form :model="projectForm" label-width="120px">
                                    <el-form-item label="È°πÁõÆÁºñÂè∑" required>
                                        <el-input v-model="projectForm.project_no" placeholder="Â¶Ç: PRJ001" :disabled="!!projectForm.id"></el-input>
                                    </el-form-item>
                                    <el-form-item label="È°πÁõÆÂêçÁß∞" required>
                                        <el-input v-model="projectForm.name" placeholder="ËØ∑ËæìÂÖ•È°πÁõÆÂêçÁß∞"></el-input>
                                    </el-form-item>
                                    <el-form-item label="ÂàÜÁ±ª" required>
                                        <el-select v-model="projectForm.category_id" placeholder="ËØ∑ÈÄâÊã©ÂàÜÁ±ª" style="width: 100%;">
                                            <el-option v-for="cat in categories" :key="cat.id" :label="cat.name" :value="cat.id"></el-option>
                                        </el-select>
                                    </el-form-item>
                                    <el-form-item label="Âéü‰ª∑" required>
                                        <el-input-number v-model="projectForm.original_price" :min="0" :precision="2" style="width: 100%;"></el-input-number>
                                    </el-form-item>
                                    <el-form-item label="Áé∞‰ª∑" required>
                                        <el-input-number v-model="projectForm.current_price" :min="0" :precision="2" style="width: 100%;"></el-input-number>
                                    </el-form-item>
                                    <el-form-item label="Âçï‰Ωç">
                                        <el-input v-model="projectForm.unit" placeholder="Â¶Ç: Ê†∑ÂìÅ„ÄÅÊ¨°"></el-input>
                                    </el-form-item>
                                    <el-form-item label="ÊúçÂä°Âë®Êúü">
                                        <div style="display: flex; gap: 10px; align-items: center;">
                                            <el-input-number v-model="projectForm.service_cycle_min" :min="1" placeholder="ÊúÄÁü≠"></el-input-number>
                                            <span>~</span>
                                            <el-input-number v-model="projectForm.service_cycle_max" :min="1" placeholder="ÊúÄÈïø"></el-input-number>
                                            <span>Â∑•‰ΩúÊó•</span>
                                        </div>
                                    </el-form-item>
                                    <el-form-item label="‰ª™Âô®ÂêçÁß∞">
                                        <el-input v-model="projectForm.equipment_name" placeholder="ËØ∑ËæìÂÖ•‰ª™Âô®ÂêçÁß∞"></el-input>
                                    </el-form-item>
                                    <el-form-item label="È°πÁõÆ‰ªãÁªç">
                                        <el-input v-model="projectForm.introduction" type="textarea" :rows="3" placeholder="ËØ∑ËæìÂÖ•È°πÁõÆ‰ªãÁªç"></el-input>
                                    </el-form-item>
                                    <el-form-item label="Ê†∑ÂìÅË¶ÅÊ±Ç">
                                        <el-input v-model="projectForm.sample_requirements" type="textarea" :rows="3" placeholder="ËØ∑ËæìÂÖ•Ê†∑ÂìÅË¶ÅÊ±Ç"></el-input>
                                    </el-form-item>
                                    <el-form-item label="Â∞ÅÈù¢Âõæ">
                                        <div>
                                            <el-input v-model="projectForm.cover_image" placeholder="ÂõæÁâáURL" style="margin-bottom: 10px;"></el-input>
                                            <el-upload
                                                :action="uploadUrl"
                                                :headers="uploadHeaders"
                                                :on-success="handleProjectImageUpload"
                                                :show-file-list="false"
                                                accept="image/*">
                                                <el-button size="small" type="primary">‰∏ä‰º†Â∞ÅÈù¢Âõæ</el-button>
                                            </el-upload>
                                            <el-image 
                                                v-if="projectForm.cover_image"
                                                :src="projectForm.cover_image" 
                                                style="width: 100px; height: 100px; margin-top: 10px;"
                                                fit="cover">
                                            </el-image>
                                        </div>
                                    </el-form-item>
                                    <el-form-item label="Ê†áÁ≠æ">
                                        <el-checkbox v-model="projectForm.is_hot">ÁÉ≠Èó®</el-checkbox>
                                        <el-checkbox v-model="projectForm.is_recommended">Êé®Ëçê</el-checkbox>
                                    </el-form-item>
                                    <el-form-item label="ÊéíÂ∫è">
                                        <el-input-number v-model="projectForm.sort_order" :min="0"></el-input-number>
                                    </el-form-item>
                                </el-form>
                                <template #footer>
                                    <el-button @click="projectDialogVisible = false">ÂèñÊ∂à</el-button>
                                    <el-button type="primary" @click="saveProject" :loading="loading">‰øùÂ≠ò</el-button>
                                </template>
                            </el-dialog>
                        </div>
                    </div>

                    <!-- ËÆ¢ÂçïÁÆ°ÁêÜ -->
                    <div v-show="activeMenu === 'orders'">
                        <div class="page-header">
                            <h3>üì¶ ËÆ¢ÂçïÁÆ°ÁêÜ</h3>
                        </div>
                        <div class="content-card">
                            <el-empty description="ËÆ¢ÂçïÁÆ°ÁêÜÂäüËÉΩÂºÄÂèë‰∏≠..." />
                        </div>
                    </div>

                    <!-- Á≥ªÁªüËÆæÁΩÆ -->
                    <div v-show="activeMenu === 'settings'">
                        <div class="page-header">
                            <h3>‚öôÔ∏è Á≥ªÁªüËÆæÁΩÆ</h3>
                        </div>
                        <div class="content-card">
                            <el-descriptions title="Á≥ªÁªü‰ø°ÊÅØ" :column="2" border>
                                <el-descriptions-item label="Á≥ªÁªüÂêçÁß∞">ÁßëÁ†îÊ£ÄÊµãÊúçÂä°Âπ≥Âè∞</el-descriptions-item>
                                <el-descriptions-item label="ÁâàÊú¨">v1.0.0</el-descriptions-item>
                                <el-descriptions-item label="ÂêéÁ´ØÂú∞ÂùÄ">{{ baseUrl }}</el-descriptions-item>
                                <el-descriptions-item label="ÂΩìÂâçÁÆ°ÁêÜÂëò">{{ userInfo.nickname }}</el-descriptions-item>
                            </el-descriptions>
                        </div>
                    </div>
                </el-main>
            </el-container>
        </el-container>
    </div>

    <script>
        const { createApp } = Vue
        const { ElMessage, ElMessageBox } = ElementPlus

        createApp({
            data() {
                return {
                    baseUrl: 'https://catdog.dachaonet.com',
                    token: localStorage.getItem('admin_token') || '',
                    userInfo: JSON.parse(localStorage.getItem('admin_user') || '{}'),
                    loginType: 'admin',
                    adminLoginForm: {
                        username: '',
                        password: ''
                    },
                    loginForm: {
                        phone: '',
                        sms_code: ''
                    },
                    countdown: 0,
                    loading: false,
                    activeMenu: 'users', // ÈªòËÆ§Áî®Êà∑ÁÆ°ÁêÜ
                    uploadedImages: [],
                    users: [],
                    usersLoading: false,
                    userSearch: '',
                    userPage: 1,
                    userPageSize: 20,
                    userTotal: 0,
                    userDialogVisible: false,
                    selectedUser: null,
                    avatarUploadVisible: false,
                    currentEditUserId: null,
                    // È°πÁõÆÁÆ°ÁêÜ
                    projects: [],
                    projectsLoading: false,
                    projectSearch: '',
                    projectCategoryFilter: null,
                    projectPage: 1,
                    projectPageSize: 20,
                    projectTotal: 0,
                    projectDialogVisible: false,
                    projectForm: {
                        id: null,
                        name: '',
                        project_no: '',
                        category_id: null,
                        description: '',
                        original_price: '',
                        current_price: '',
                        cover_image: '',
                        is_hot: false,
                        is_recommended: false,
                        status: 'active'
                    },
                    categories: []
                }
            },
            computed: {
                uploadUrl() {
                    return `${this.baseUrl}/api/v1/upload/image`
                },
                uploadHeaders() {
                    return {
                        'Authorization': `Bearer ${this.token}`
                    }
                }
            },
            mounted() {
                if (this.token) {
                    this.loadUsers()
                    this.loadCategories()
                }
            },
            methods: {
                handleMenuSelect(index) {
                    this.activeMenu = index
                    if (index === 'users' && this.users.length === 0) {
                        this.loadUsers()
                    } else if (index === 'projects') {
                        this.loadProjects()
                    }
                },
                copyImageUrl(url) {
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(url).then(() => {
                            ElMessage.success('ÂõæÁâáURLÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø')
                        }).catch(() => {
                            ElMessage.error('Â§çÂà∂Â§±Ë¥•')
                        })
                    } else {
                        // ÂÖºÂÆπÊóßÊµèËßàÂô®
                        const textarea = document.createElement('textarea')
                        textarea.value = url
                        document.body.appendChild(textarea)
                        textarea.select()
                        try {
                            document.execCommand('copy')
                            ElMessage.success('ÂõæÁâáURLÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø')
                        } catch (err) {
                            ElMessage.error('Â§çÂà∂Â§±Ë¥•')
                        }
                        document.body.removeChild(textarea)
                    }
                },
                async sendSms() {
                    if (!this.loginForm.phone) {
                        ElMessage.error('ËØ∑ËæìÂÖ•ÊâãÊú∫Âè∑')
                        return
                    }
                    try {
                        const res = await axios.post(`${this.baseUrl}/api/v1/auth/send-sms`, {
                            phone: this.loginForm.phone,
                            scene: 'login'
                        })
                        ElMessage.success(res.data.message)
                        if (res.data.data && res.data.data.code) {
                            ElMessage.info(`ÂºÄÂèëÊ®°ÂºèÈ™åËØÅÁ†ÅÔºö${res.data.data.code}`)
                        }
                        this.countdown = 60
                        const timer = setInterval(() => {
                            this.countdown--
                            if (this.countdown <= 0) {
                                clearInterval(timer)
                            }
                        }, 1000)
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ÂèëÈÄÅÂ§±Ë¥•')
                    }
                },
                async handleLogin() {
                    this.loading = true
                    try {
                        const res = await axios.post(`${this.baseUrl}/api/v1/auth/sms-login`, this.loginForm)
                        this.token = res.data.data.access_token
                        this.userInfo = {
                            id: res.data.data.user_id,
                            phone: res.data.data.phone,
                            nickname: res.data.data.nickname
                        }
                        localStorage.setItem('admin_token', this.token)
                        localStorage.setItem('admin_user', JSON.stringify(this.userInfo))
                        ElMessage.success('ÁôªÂΩïÊàêÂäü')
                        this.loadUsers()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ÁôªÂΩïÂ§±Ë¥•')
                    } finally {
                        this.loading = false
                    }
                },
                async handleAdminLogin() {
                    if (!this.adminLoginForm.username || !this.adminLoginForm.password) {
                        ElMessage.error('ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÂíåÂØÜÁ†Å')
                        return
                    }
                    this.loading = true
                    try {
                        const res = await axios.post(`${this.baseUrl}/api/v1/auth/admin-login`, this.adminLoginForm)
                        this.token = res.data.data.access_token
                        this.userInfo = {
                            id: res.data.data.user_id,
                            phone: res.data.data.phone,
                            nickname: res.data.data.nickname,
                            is_admin: res.data.data.is_admin
                        }
                        localStorage.setItem('admin_token', this.token)
                        localStorage.setItem('admin_user', JSON.stringify(this.userInfo))
                        ElMessage.success('ÁôªÂΩïÊàêÂäü')
                        this.loadUsers()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'ÁôªÂΩïÂ§±Ë¥•')
                    } finally {
                        this.loading = false
                    }
                },
                logout() {
                    localStorage.removeItem('admin_token')
                    localStorage.removeItem('admin_user')
                    this.token = ''
                    this.userInfo = {}
                    ElMessage.success('Â∑≤ÈÄÄÂá∫ÁôªÂΩï')
                },
                handleUploadSuccess(response, file) {
                    if (response.code === 200) {
                        ElMessage.success('‰∏ä‰º†ÊàêÂäü')
                        this.uploadedImages.unshift({
                            url: response.data.url,
                            name: file.name
                        })
                    }
                },
                async handleAvatarUploadSuccess(response, file) {
                    if (response.code === 200) {
                        try {
                            // Êõ¥Êñ∞Áî®Êà∑Â§¥ÂÉè
                            await axios.put(
                                `${this.baseUrl}/api/v1/users/me`,
                                { avatar: response.data.url },
                                { headers: this.uploadHeaders }
                            )
                            ElMessage.success('Â§¥ÂÉèÊõ¥Êñ∞ÊàêÂäü')
                            this.avatarUploadVisible = false
                            // Âà∑Êñ∞Áî®Êà∑ËØ¶ÊÉÖ
                            if (this.selectedUser) {
                                await this.viewUser({ id: this.selectedUser.id })
                            }
                            this.loadUsers()
                        } catch (error) {
                            ElMessage.error(error.response?.data?.detail || 'Â§¥ÂÉèÊõ¥Êñ∞Â§±Ë¥•')
                        }
                    }
                },
                handleUploadError(error) {
                    ElMessage.error('‰∏ä‰º†Â§±Ë¥•Ôºö' + (error.message || 'Êú™Áü•ÈîôËØØ'))
                },
                beforeUpload(file) {
                    const isImage = file.type.startsWith('image/')
                    const isLt10M = file.size / 1024 / 1024 < 10

                    if (!isImage) {
                        ElMessage.error('Âè™ËÉΩ‰∏ä‰º†ÂõæÁâáÊñá‰ª∂!')
                        return false
                    }
                    if (!isLt10M) {
                        ElMessage.error('ÂõæÁâáÂ§ßÂ∞è‰∏çËÉΩË∂ÖËøá 10MB!')
                        return false
                    }
                    return true
                },
                async deleteImage(imageUrl) {
                    try {
                        await ElMessageBox.confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÂº†ÂõæÁâáÂêó?', 'ÊèêÁ§∫', {
                            type: 'warning'
                        })
                        await axios.delete(`${this.baseUrl}/api/v1/upload/image`, {
                            headers: this.uploadHeaders,
                            params: { image_path: imageUrl }
                        })
                        this.uploadedImages = this.uploadedImages.filter(img => img.url !== imageUrl)
                        ElMessage.success('Âà†Èô§ÊàêÂäü')
                    } catch (error) {
                        if (error !== 'cancel') {
                            ElMessage.error(error.response?.data?.detail || 'Âà†Èô§Â§±Ë¥•')
                        }
                    }
                },
                async loadUsers() {
                    this.usersLoading = true
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/users/list`, {
                            headers: this.uploadHeaders,
                            params: {
                                page: this.userPage,
                                page_size: this.userPageSize,
                                search: this.userSearch || undefined
                            }
                        })
                        this.users = res.data.data.list
                        this.userTotal = res.data.data.total
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'Âä†ËΩΩÁî®Êà∑ÂàóË°®Â§±Ë¥•')
                    } finally {
                        this.usersLoading = false
                    }
                },
                async viewUser(user) {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/users/${user.id}`, {
                            headers: this.uploadHeaders
                        })
                        this.selectedUser = res.data.data
                        this.userDialogVisible = true
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'Âä†ËΩΩÁî®Êà∑ËØ¶ÊÉÖÂ§±Ë¥•')
                    }
                },
                async updateUserStatus(userId, status) {
                    const action = status === 'active' ? 'ÊøÄÊ¥ª' : 'Á¶ÅÁî®'
                    try {
                        await ElMessageBox.confirm(`Á°ÆÂÆöË¶Å${action}ËØ•Áî®Êà∑Âêó?`, 'ÊèêÁ§∫', {
                            type: 'warning'
                        })
                        await axios.put(
                            `${this.baseUrl}/api/v1/users/${userId}/status`, 
                            null,
                            {
                                headers: this.uploadHeaders,
                                params: { status }
                            }
                        )
                        ElMessage.success(`${action}ÊàêÂäü`)
                        this.loadUsers()
                    } catch (error) {
                        if (error !== 'cancel') {
                            ElMessage.error(error.response?.data?.detail || `${action}Â§±Ë¥•`)
                        }
                    }
                },
                getStatusText(status) {
                    const statusMap = {
                        'active': 'Ê≠£Â∏∏',
                        'inactive': 'Êú™ÊøÄÊ¥ª',
                        'banned': 'Â∑≤Á¶ÅÁî®'
                    }
                    return statusMap[status] || status
                },
                getMemberLevelText(level) {
                    const levelMap = {
                        0: 'ÊôÆÈÄö‰ºöÂëò',
                        1: 'Èì∂Âç°‰ºöÂëò',
                        2: 'ÈáëÂç°‰ºöÂëò',
                        3: 'ÁôΩÈáë‰ºöÂëò'
                    }
                    return levelMap[level] || 'ÊôÆÈÄö‰ºöÂëò'
                },
                formatDate(dateStr) {
                    if (!dateStr) return '-'
                    const date = new Date(dateStr)
                    return date.toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    })
                },
                // È°πÁõÆÁÆ°ÁêÜÊñπÊ≥ï
                async loadCategories() {
                    try {
                        const res = await axios.get(`${this.baseUrl}/api/v1/projects/categories`)
                        this.categories = res.data.data || []
                    } catch (error) {
                        console.error('Âä†ËΩΩÂàÜÁ±ªÂ§±Ë¥•', error)
                    }
                },
                async loadProjects() {
                    this.projectsLoading = true
                    try {
                        const params = {
                            page: this.projectPage,
                            page_size: this.projectPageSize
                        }
                        if (this.projectSearch) {
                            params.search = this.projectSearch
                        }
                        if (this.projectCategoryFilter) {
                            params.category_id = this.projectCategoryFilter
                        }
                        const res = await axios.get(`${this.baseUrl}/api/v1/projects/list`, {
                            params,
                            headers: this.uploadHeaders
                        })
                        this.projects = res.data.data.items || []
                        this.projectTotal = res.data.data.total || 0
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || 'Âä†ËΩΩÈ°πÁõÆÂàóË°®Â§±Ë¥•')
                    } finally {
                        this.projectsLoading = false
                    }
                },
                showProjectDialog(project = null) {
                    if (project) {
                        // ÁºñËæëÈ°πÁõÆ
                        this.projectForm = { ...project }
                    } else {
                        // Êñ∞Âª∫È°πÁõÆ
                        this.projectForm = {
                            id: null,
                            name: '',
                            project_no: '',
                            category_id: null,
                            description: '',
                            original_price: '',
                            current_price: '',
                            cover_image: '',
                            is_hot: false,
                            is_recommended: false,
                            status: 'active'
                        }
                    }
                    this.projectDialogVisible = true
                },
                async saveProject() {
                    if (!this.projectForm.name || !this.projectForm.project_no) {
                        ElMessage.error('ËØ∑Â°´ÂÜôÈ°πÁõÆÂêçÁß∞ÂíåÁºñÂè∑')
                        return
                    }
                    this.loading = true
                    try {
                        if (this.projectForm.id) {
                            // Êõ¥Êñ∞
                            await axios.put(
                                `${this.baseUrl}/api/v1/projects/${this.projectForm.id}`,
                                this.projectForm,
                                { headers: this.uploadHeaders }
                            )
                            ElMessage.success('Êõ¥Êñ∞ÊàêÂäü')
                        } else {
                            // ÂàõÂª∫
                            await axios.post(
                                `${this.baseUrl}/api/v1/projects/create`,
                                this.projectForm,
                                { headers: this.uploadHeaders }
                            )
                            ElMessage.success('ÂàõÂª∫ÊàêÂäü')
                        }
                        this.projectDialogVisible = false
                        this.loadProjects()
                    } catch (error) {
                        ElMessage.error(error.response?.data?.detail || '‰øùÂ≠òÂ§±Ë¥•')
                    } finally {
                        this.loading = false
                    }
                },
                async updateProjectStatus(projectId, status) {
                    const action = status === 'active' ? '‰∏äÊû∂' : '‰∏ãÊû∂'
                    try {
                        await ElMessageBox.confirm(`Á°ÆÂÆöË¶Å${action}ËØ•È°πÁõÆÂêó?`, 'ÊèêÁ§∫', {
                            type: 'warning'
                        })
                        await axios.put(
                            `${this.baseUrl}/api/v1/projects/${projectId}/status`,
                            null,
                            {
                                headers: this.uploadHeaders,
                                params: { status }
                            }
                        )
                        ElMessage.success(`${action}ÊàêÂäü`)
                        this.loadProjects()
                    } catch (error) {
                        if (error !== 'cancel') {
                            ElMessage.error(error.response?.data?.detail || `${action}Â§±Ë¥•`)
                        }
                    }
                },
                async deleteProject(projectId) {
                    try {
                        await ElMessageBox.confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËØ•È°πÁõÆÂêó? Ê≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç!', 'Ë≠¶Âëä', {
                            type: 'error',
                            confirmButtonText: 'Á°ÆÂÆöÂà†Èô§',
                            cancelButtonText: 'ÂèñÊ∂à'
                        })
                        await axios.delete(
                            `${this.baseUrl}/api/v1/projects/${projectId}`,
                            { headers: this.uploadHeaders }
                        )
                        ElMessage.success('Âà†Èô§ÊàêÂäü')
                        this.loadProjects()
                    } catch (error) {
                        if (error !== 'cancel') {
                            ElMessage.error(error.response?.data?.detail || 'Âà†Èô§Â§±Ë¥•')
                        }
                    }
                },
                handleProjectImageUpload(response, file) {
                    if (response.code === 200) {
                        this.projectForm.cover_image = response.data.url
                        ElMessage.success('Â∞ÅÈù¢ÂõæÁâá‰∏ä‰º†ÊàêÂäü')
                    }
                }
            }
        }).use(ElementPlus).mount('#app')
    </script>
</body>
</html>
