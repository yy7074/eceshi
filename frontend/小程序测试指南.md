# 小程序测试指南

## 📱 环境准备

### 1. 安装 HBuilderX
- 下载地址：https://www.dcloud.io/hbuilderx.html
- 推荐版本：最新稳定版

### 2. 安装微信开发者工具（如果需要真机测试）
- 下载地址：https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html

## 🚀 快速启动

### 方式一：H5开发模式（推荐测试）

```bash
# 进入前端目录
cd /Users/yy/Documents/GitHub/eceshi/frontend

# 安装依赖（首次运行）
npm install

# 启动H5开发服务器
npm run dev:h5
```

启动后浏览器会自动打开 `http://localhost:5173`

### 方式二：微信小程序模式

```bash
# 进入前端目录
cd /Users/yy/Documents/GitHub/eceshi/frontend

# 编译微信小程序
npm run dev:mp-weixin
```

然后使用微信开发者工具打开 `frontend/unpackage/dist/dev/mp-weixin` 目录

### 方式三：HBuilderX 可视化

1. 使用 HBuilderX 打开 `frontend` 目录
2. 点击菜单：运行 -> 运行到浏览器 -> Chrome
3. 或者：运行 -> 运行到小程序模拟器 -> 微信开发者工具

## 🧪 测试步骤

### 1️⃣ 确保后端服务运行

```bash
cd /Users/yy/Documents/GitHub/eceshi/backend
python -m app.main
```

确保服务运行在 **3000端口**，可通过 `http://catdog.dachaonet.com` 访问

### 2️⃣ 测试短信登录功能

#### 步骤：
1. 打开小程序/H5页面
2. 进入登录页面
3. 切换到"验证码登录" Tab
4. 输入手机号：`18663764585`
5. 点击"获取验证码"
6. 查看后端控制台输出的验证码（开发模式固定为 `123456`）
7. 输入验证码
8. 勾选用户协议
9. 点击"登录"

#### 预期结果：
- ✅ 发送验证码成功提示
- ✅ 60秒倒计时
- ✅ 登录成功，跳转到首页
- ✅ 用户信息正确显示
- ✅ 如果是新手机号，自动注册并登录

### 3️⃣ 测试密码登录功能

如果已经注册过：
1. 切换到"密码登录" Tab
2. 输入手机号和密码
3. 勾选用户协议
4. 点击"登录"

## 🔍 API配置说明

API基础地址已配置为：`https://catdog.dachaonet.com` ✅ HTTPS

如需修改，编辑 `frontend/utils/request.js`：

```javascript
// 开发环境API地址
const DEV_BASE_URL = 'https://catdog.dachaonet.com'
```

## 📊 可用测试接口

### 认证相关
- `POST /api/v1/auth/send-sms` - 发送短信验证码
- `POST /api/v1/auth/sms-login` - 短信登录（自动注册）
- `POST /api/v1/auth/register` - 用户注册
- `POST /api/v1/auth/login` - 密码登录

### 用户相关
- `GET /api/v1/users/me` - 获取当前用户信息
- `PUT /api/v1/users/me` - 更新用户信息

### 项目相关
- `GET /api/v1/projects/list` - 获取项目列表
- `GET /api/v1/projects/{id}` - 获取项目详情

### 订单相关
- `POST /api/v1/orders/calculate` - 计算订单费用
- `POST /api/v1/orders/create` - 创建订单
- `GET /api/v1/orders/list` - 获取订单列表
- `GET /api/v1/orders/{id}` - 获取订单详情

### 支付相关
- `POST /api/v1/payments/create` - 创建支付（支持支付宝）
- `GET /api/v1/payments/{id}/status` - 查询支付状态

## 🐛 调试技巧

### 1. 查看网络请求
- **H5模式**：浏览器按 F12 -> Network 标签
- **微信开发者工具**：调试器 -> Network 标签

### 2. 查看控制台日志
- 所有API错误都会在控制台输出
- 登录成功会保存token到本地存储

### 3. 清除缓存
```javascript
// 在控制台执行
uni.clearStorageSync()
```

### 4. 查看存储的数据
```javascript
// 查看token
console.log(uni.getStorageSync('token'))

// 查看用户信息
console.log(uni.getStorageSync('userInfo'))
```

## 📱 测试账号

### 测试手机号
- `18663764585` - 已有账号（或自动注册）

### 开发环境验证码
- 固定验证码：`123456`
- 验证码有效期：5分钟

## ⚠️ 常见问题

### 1. API请求失败
**原因**：后端服务未启动或端口不对
**解决**：确保后端运行在3000端口

### 2. 验证码发送失败
**原因**：阿里云短信配置未设置
**解决**：开发模式会返回固定验证码123456，生产环境需要配置真实的阿里云密钥

### 3. 登录后跳转404
**原因**：首页路由未配置
**解决**：检查 `pages.json` 中的路由配置

### 4. 跨域问题（仅H5）
**原因**：浏览器CORS限制
**解决**：
- 方法1：后端已配置CORS，应该没问题
- 方法2：使用微信开发者工具测试（没有跨域限制）
- 方法3：Chrome添加 `--disable-web-security` 参数

## 🎯 测试清单

- [ ] H5模式启动成功
- [ ] 登录页面正常显示
- [ ] 短信验证码发送成功
- [ ] 验证码倒计时正常
- [ ] 短信登录成功
- [ ] 新用户自动注册
- [ ] Token保存成功
- [ ] 登录后跳转首页
- [ ] 用户信息正常显示
- [ ] 项目列表正常加载
- [ ] 订单功能正常
- [ ] 支付宝支付流程正常

## 📞 技术支持

如有问题，请检查：
1. 后端服务日志：`/Users/yy/Documents/GitHub/eceshi/backend/server.log`
2. 浏览器控制台错误信息
3. 网络请求返回的错误详情

---

**祝测试顺利！** 🎉

