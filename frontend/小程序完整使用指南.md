# 小程序完整使用指南

## 🚀 快速开始

### 1. 环境准备
- 微信开发者工具
- 后端服务已启动（端口3000）
- API地址：`https://catdog.dachaonet.com`

### 2. 启动小程序
```bash
cd /Users/yy/Documents/GitHub/eceshi/frontend
# 在微信开发者工具中打开项目
# 点击【编译】按钮
```

## 📱 功能导航

### 底部Tab栏
1. **首页** - 浏览项目、快捷入口
2. **分类** - 按分类浏览项目
3. **订单** - 查看和管理订单
4. **个人中心** - 用户信息和设置

## 📋 功能详细说明

### 一、首页功能

#### 1. 顶部搜索栏
- 点击显示"搜索功能开发中"提示
- **状态**：占位功能

#### 2. 四个快捷入口
| 图标 | 名称 | 功能 | 是否需要登录 |
|------|------|------|-------------|
| 🔬 | 送测样品 | 跳转到分类页 | ❌ |
| 🎯 | 优惠券 | 查看我的优惠券 | ✅ |
| 👥 | 创建团体 | 创建团购团体 | ✅ |
| 📍 | 我的积分 | 查看积分明细 | ✅ |

**使用方法**：
- 点击相应图标
- 未登录功能会弹出登录提示
- 登录后跳转到对应页面

#### 3. 活动Banner
- 展示当前活动信息
- **状态**：静态展示

#### 4. 分类导航（8宫格）
- 显示前8个分类
- 数据从后端API加载
- 点击跳转到分类页

#### 5. 增值活动区域
- 展示增值服务
- **状态**：静态展示

#### 6. 项目列表（2列）
- 显示热门项目
- 点击图片/名称 → 项目详情
- 点击"立即预约" → 预约页面

---

### 二、分类页面

#### 布局
- **左侧**：分类菜单
- **右侧**：项目列表

#### 功能
1. 点击左侧分类切换
2. 右侧显示对应分类的项目
3. 项目卡片显示：
   - 项目图片
   - 项目名称
   - 已测次数
   - 满意度
   - "立即预约"按钮

#### 操作
- 点击项目 → 项目详情
- 点击"立即预约" → 预约页面

---

### 三、项目详情页

#### 顶部信息
- 项目轮播图
- 项目名称
- 实验室名称
- 满意度
- 价格（原价、现价）
- 已预约人数

#### 服务信息
- 项目编号
- 仪器型号
- 服务周期
- 计费单位

#### Tab详情
| Tab | 内容 |
|-----|------|
| 项目介绍 | 项目的详细介绍 |
| 样品要求 | 样品的要求说明 |
| 预约须知 | 预约注意事项 |
| 常见问题 | FAQ列表 |

#### 底部操作
- **收藏** - 收藏/取消收藏
- **客服** - 拨打客服电话
- **立即预约** - 跳转预约页面（需登录）

---

### 四、预约流程（3步骤）

#### 步骤1：填写样品信息

**必填项**：
- ✅ 样品名称
- ✅ 样品状态

**选填项**：
- 样品数量（默认1）
- 样品成分
- 危险性
- 存放要求
- 备注

**操作**：
- 点击"下一步"进入步骤2
- 点击"存为草稿"保存表单

#### 步骤2：完善配送信息

**必填项**：
- ✅ 收货地址
- ✅ 送达日期

**选填项**：
- 寄送方式（默认快递）
- 配送备注

**地址操作**：
- 点击地址卡片 → 选择/添加地址
- 未选择时显示"添加收货地址"

**操作**：
- 点击"上一步"返回步骤1
- 点击"下一步"进入步骤3
- 点击"存为草稿"保存表单

#### 步骤3：提交文档和支付

**订单信息**（确认）：
- 项目名称
- 样品数量
- 寄送方式
- 收货地址

**附件上传**（选填）：
- 点击上传区域选择图片
- 支持多张图片
- 可删除已上传文件

**费用明细**：
- 测试费用
- 样品数量
- 配送费用
- **总计**（红色高亮）

**支付方式**：
- 微信支付（默认）
- 支付宝支付

**操作**：
- 点击"上一步"返回步骤2
- 点击"提交订单" → 上传附件 → 创建订单 → 调起支付
- 点击"存为草稿"保存表单

---

### 五、订单管理

#### 订单列表

**Tab筛选**：
| Tab | 状态 | 说明 |
|-----|------|------|
| 全部 | all | 所有订单 |
| 待支付 | unpaid | 未支付的订单 |
| 待确认 | paid | 已支付待确认 |
| 实验中 | testing | 正在实验 |
| 已完成 | completed | 已完成 |

**订单卡片信息**：
- 订单号
- 订单状态
- 项目图片
- 项目名称
- 样品数量
- 订单日期
- 总金额

**订单操作**：
- **待支付**：立即支付、取消订单
- **已完成**：评价、再次预约

**其他功能**：
- 下拉刷新
- 上拉加载更多
- 点击订单 → 订单详情

#### 订单详情

**显示内容**：
1. 订单状态卡片
   - 状态图标
   - 状态文本
   - 状态描述

2. 项目信息
   - 项目图片
   - 项目名称
   - 实验室名称
   - 样品数量

3. 样品信息
   - 样品名称
   - 样品成分
   - 样品状态
   - 备注

4. 配送信息
   - 收货人信息
   - 收货地址
   - 寄送方式
   - 期望送达日期

5. 物流信息（如有）
   - 物流公司
   - 快递单号（可复制）

6. 费用明细
   - 测试费用
   - 配送费用
   - 总计

7. 订单信息
   - 订单号
   - 创建时间
   - 支付时间
   - 完成时间

**底部操作**：
- **待支付**：取消订单、立即支付
- **已完成**：联系客服、再次预约

---

### 六、地址管理

#### 地址列表
- 显示所有收货地址
- 默认地址标记
- 空状态提示

#### 地址卡片信息
- 收件人姓名
- 手机号
- 完整地址

#### 地址操作
- **编辑** - 修改地址信息
- **删除** - 删除地址（需确认）
- **设为默认** - 设置默认地址

#### 添加/编辑地址

**必填项**：
- ✅ 收件人（最多20字符）
- ✅ 手机号（11位，1开头）
- ✅ 省市区
- ✅ 详细地址

**选填项**：
- 设为默认地址（勾选框）

**验证规则**：
- 手机号格式验证
- 收件人不能为空
- 省市区必须选择
- 详细地址不能为空

---

### 七、个人中心

#### 用户信息卡片
- 头像
- 会员编号
- 专属顾问信息
- 编辑按钮 → 个人资料编辑

#### 账户金额（4个）
1. **可用信用** - 点击查看详情
2. **个人预付** - 点击查看详情（带说明图标ⓘ）
3. **可开票** - 点击查看详情
4. **个人欠款** - 点击查看详情

#### 我的订单
- 5个订单状态入口
  - 待支付
  - 待确认
  - 待实验
  - 实验中
  - 已完成
- "全部订单"入口

**跳转方式**：
- 点击状态入口 → 订单页面（自动筛选对应状态）
- 点击"全部订单" → 订单页面（显示全部）

#### 服务与工具（12个功能）

| 图标 | 名称 | 标签 | 功能 | 需要登录 |
|------|------|------|------|---------|
| 👤 | 实名认证 | NEW | 提交身份证认证 | ✅ |
| 👥 | 我的团体 | - | 查看团体信息 | ✅ |
| 👥 | 邀请好友 | 返利 | 邀请获得返利 | ✅ |
| ⭐ | 我的积分 | 上新 | 查看积分明细 | ✅ |
| 💰 | 我的钱包 | - | 查看钱包余额 | ✅ |
| 🧾 | 我的发票 | - | 发票管理 | ✅ |
| 🎫 | 优惠券 | 领券 | 查看优惠券 | ✅ |
| 📊 | 预付记录 | - | 预付记录 | ✅ |
| 🎁 | 中奖记录 | - | 查看中奖 | ✅ |
| 🎯 | 下单抽奖 | - | 参与抽奖 | ✅ |
| 💬 | 建议/投诉 | - | 提交反馈 | ✅ |
| ⚙️ | 设置 | - | 应用设置 | ✅ |

**当前状态**：
- ✅ 已实现：实名认证、我的团体、我的积分、优惠券
- 🚧 开发中：其他功能显示"功能开发中"提示

---

### 八、个人资料编辑

#### 可编辑项
1. **头像**
   - 点击头像选择图片
   - 自动上传到服务器
   - 实时预览

2. **昵称**
   - 文本输入
   - 最多20字符
   - 必填项

3. **手机号**
   - 显示已绑定
   - 不可修改

4. **性别**
   - 选择器（保密/男/女）
   - 可选项

5. **邮箱**
   - 文本输入
   - 邮箱格式验证
   - 选填项

#### 操作
- 点击"保存"提交修改
- 保存成功后返回个人中心

---

### 九、实名认证

#### 认证状态
- **未认证** - 显示认证表单
- **审核中** - 显示审核中状态
- **已认证** - 显示认证信息
- **审核未通过** - 显示拒绝原因，可重新提交

#### 认证表单

**必填项**：
- ✅ 真实姓名（最多20字符）
- ✅ 身份证号（18位，格式验证）
- ✅ 身份证正面照片
- ✅ 身份证反面照片

**上传照片**：
- 点击上传区域选择图片
- 支持相册和相机
- 自动上传到服务器

**温馨提示**：
1. 请确保身份证照片清晰完整
2. 请上传本人真实身份证
3. 您的信息将严格保密

#### 已认证信息
- 真实姓名
- 身份证号（脱敏显示：`前6位********后4位`）
- 认证时间

---

### 十、其他功能页面

#### 1. 优惠券页面
- **状态**：占位页面
- **显示**：暂无可用优惠券
- **操作**：返回首页按钮

#### 2. 团体页面
- **状态**：占位页面
- **显示**：暂无团体
- **操作**：创建团体按钮、返回首页按钮

#### 3. 积分页面
- **状态**：基础实现
- **显示**：
  - 我的积分卡片
  - 积分记录列表
  - 空状态提示
- **操作**：
  - 积分兑换按钮
  - 积分规则按钮

---

## 🔐 登录和认证

### 登录方式
1. **短信验证码登录**
   - 输入手机号
   - 点击"发送验证码"（60秒倒计时）
   - 输入验证码
   - 自动登录/注册

2. **微信一键登录**
   - 点击"微信登录"按钮
   - 使用微信授权
   - 自动获取用户信息

### Token管理
- 登录后自动存储Token
- 所有需要认证的API自动携带Token
- Token无效时提示重新登录

---

## ⚠️ 注意事项

### 1. TabBar页面跳转
- 跳转到首页/分类/订单/个人中心必须使用 `uni.switchTab`
- 不能使用 `uni.navigateTo`
- TabBar页面不能直接传参，需要用本地存储

### 2. 登录状态
- 以下功能需要登录：
  - 预约下单
  - 查看订单
  - 个人资料编辑
  - 实名认证
  - 优惠券
  - 积分
  - 团体

### 3. 图片加载
- 所有图片URL从后端API获取
- 使用 `picsum.photos` 作为占位图
- 不再使用 `example.com` 链接

### 4. 缓存清理
如遇到数据缓存问题：
1. 微信开发者工具 → 工具 → 清除缓存
2. 模拟器右上角 → ... → 清除缓存
3. 重新编译

---

## 🧪 测试清单

### 基础功能测试
- [ ] 首页加载正常
- [ ] 四个快捷入口可点击
- [ ] 分类导航可点击切换
- [ ] 项目列表正常显示
- [ ] 点击项目查看详情

### 预约流程测试
- [ ] 步骤1表单填写和验证
- [ ] 步骤2地址选择和配送信息
- [ ] 步骤3文件上传和支付选择
- [ ] 草稿保存和恢复
- [ ] 订单提交成功

### 订单管理测试
- [ ] 订单列表加载
- [ ] Tab状态筛选
- [ ] 订单详情查看
- [ ] 订单操作（支付、取消）

### 个人中心测试
- [ ] 用户信息展示
- [ ] 账户金额展示
- [ ] 订单入口跳转
- [ ] 服务功能入口
- [ ] 资料编辑保存
- [ ] 实名认证提交

### 地址管理测试
- [ ] 地址列表展示
- [ ] 添加新地址
- [ ] 编辑地址
- [ ] 删除地址
- [ ] 设为默认

---

## 📞 技术支持

### API地址
- 开发环境：`https://catdog.dachaonet.com`
- 端口：3000

### 常见问题

**Q: 小程序加载空白？**
A: 检查后端服务是否启动，API地址是否正确

**Q: 图片加载失败？**
A: 检查图片URL是否有效，清除缓存后重试

**Q: 跳转报错 `navigateTo:fail`？**
A: 检查是否跳转到tabBar页面，应使用 `switchTab`

**Q: Token失效？**
A: 重新登录获取新Token

---

**最后更新**：2025年10月19日  
**版本**：v1.0  
**状态**：核心功能已完成，可投入测试
