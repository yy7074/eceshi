# 📱 科研检测小程序 - 完整使用指南

## 🎯 小程序概述

这是一个基于 uni-app 开发的科研检测服务小程序，支持：
- 🔐 多种登录方式（短信/密码/微信）
- 🔬 项目浏览和搜索
- 📝 在线预约检测服务
- 📦 订单管理和跟踪
- 👤 个人中心管理

---

## 🚀 快速启动

### 方式一：使用启动脚本（推荐）

```bash
cd /Users/yy/Documents/GitHub/eceshi/frontend

# 运行启动脚本
./start.sh

# 选择启动模式
# 1 - H5开发模式（浏览器预览）
# 2 - 微信小程序编译（微信开发者工具）
```

### 方式二：手动启动

#### H5开发模式
```bash
npm run dev:h5
```
访问: http://localhost:5173

#### 微信小程序模式
```bash
npm run dev:mp-weixin
```
编译输出: `unpackage/dist/dev/mp-weixin`

---

## 🔧 微信开发者工具配置

### 1. 打开微信开发者工具

下载地址: https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html

### 2. 导入项目

```
项目目录: /Users/yy/Documents/GitHub/eceshi/frontend/unpackage/dist/dev/mp-weixin
AppID: wx2ef4744e64c7bc45
项目名称: 科研检测服务平台
```

### 3. 配置合法域名

在微信公众平台配置以下域名：

**request合法域名**:
- `https://catdog.dachaonet.com`

**uploadFile合法域名**:
- `https://catdog.dachaonet.com`

**downloadFile合法域名**:
- `https://catdog.dachaonet.com`

> 💡 开发阶段可以在微信开发者工具中勾选"不校验合法域名"

---

## 📱 小程序页面结构

### 主要页面（pages）

#### 1. 首页 (`pages/index/index`)
- 显示项目分类
- 热门项目推荐
- 搜索功能
- Tab导航

#### 2. 分类页 (`pages/category/category`)
- 项目分类列表
- 分类筛选
- 项目搜索

#### 3. 登录页 (`pages/login/login`)
- 短信验证码登录（自动注册）
- 密码登录
- 微信登录（仅小程序环境）
- 用户协议

#### 4. 订单页 (`pages/order/order`)
- 订单列表
- 订单状态筛选
- 订单搜索

#### 5. 个人中心 (`pages/user/user`)
- 用户信息展示
- 账户余额
- 功能入口（地址管理、实名认证等）

### 分包页面（pagesA）

#### 1. 预约页面 (`pagesA/booking/booking`)
- 项目详情展示
- 样品信息填写
- 配送方式选择
- 费用计算
- 提交订单

#### 2. 订单详情 (`pagesA/order-detail/order-detail`)
- 订单完整信息
- 订单状态跟踪
- 操作按钮（取消、支付等）

#### 3. 地址管理 (`pagesA/address/address`)
- 地址列表
- 添加/编辑地址
- 设置默认地址

#### 4. 实名认证 (`pagesA/certification/certification`)
- 提交认证信息
- 查看认证状态

#### 5. 支付页面 (`pagesA/payment/payment`)
- 支付方式选择
- 支付流程

---

## 🔐 登录功能测试

### 1. 短信验证码登录（推荐）

**步骤**:
1. 打开小程序，点击"我的"进入登录页
2. 选择"验证码登录" Tab
3. 输入手机号: `18663764585`
4. 点击"获取验证码"
5. 输入验证码: `123456`（开发模式固定）
6. 勾选用户协议
7. 点击"登录"

**特点**:
- ✅ 新手机号自动注册
- ✅ 无需记住密码
- ✅ 开发模式验证码固定为 123456

### 2. 微信登录（仅小程序环境）

**步骤**:
1. 在微信开发者工具或真机中打开小程序
2. 进入登录页
3. 点击"微信登录"按钮
4. 自动完成授权和登录

**配置**:
```javascript
// 已配置
WECHAT_APPID: wx2ef4744e64c7bc45
WECHAT_SECRET: 80d47eff16201ebcd596c40d591d86dc
```

### 3. 密码登录

**步骤**:
1. 选择"密码登录" Tab
2. 输入手机号和密码
3. 点击"登录"

> 💡 首次使用建议用短信验证码登录，系统会自动注册

---

## 🔬 项目浏览和预约流程

### 1. 浏览项目

**首页浏览**:
- 首页显示热门项目和分类
- 点击分类查看该分类下的所有项目
- 使用搜索框搜索项目

**项目列表**:
- 显示项目卡片（图片、名称、价格）
- 支持分类筛选
- 支持关键词搜索

### 2. 查看项目详情

点击项目卡片进入详情页：
- 项目基本信息（名称、编号、价格）
- 项目介绍
- 服务周期
- 样品要求
- 检测参数
- 预约须知

### 3. 预约流程

**步骤**:

1. **在项目详情页点击"立即预约"**
   - 跳转到预约页面

2. **填写样品信息**
   - 样品数量
   - 样品名称
   - 样品编号
   - 样品规格
   - 测试位点
   - 可添加多个样品

3. **配置测试参数**
   - 数据范围
   - 光圈设置
   - 测试点数
   - 测试温度
   - 激光功率
   - 特殊要求

4. **选择配送方式**
   - 自送样品（免费）
   - 快递寄送（需选择收货地址）
   - 平台上门取样（+50元）

5. **其他选项**
   - 是否加急（缩短50%周期，+30%费用）
   - 订单备注

6. **确认费用并提交**
   - 查看费用明细
   - 点击"提交订单"
   - 跳转到订单详情或支付页面

---

## 📦 订单管理

### 查看订单列表

**位置**: 底部Tab"订单"

**功能**:
- 查看所有订单
- 按状态筛选（全部/待支付/进行中/已完成）
- 搜索订单（订单号、项目名称）
- 显示订单基本信息

### 订单详情

**功能**:
- 查看完整订单信息
- 订单状态跟踪
- 样品信息
- 配送信息
- 费用明细

**操作**:
- 取消订单（待支付状态）
- 去支付（待支付状态）
- 查看报告（已完成状态）
- 申请退款（特定状态）

---

## 👤 个人中心

### 功能列表

1. **账户信息**
   - 头像和昵称
   - 手机号
   - 会员等级

2. **账户余额**
   - 预付余额
   - 信用额度
   - 积分余额

3. **功能入口**
   - 地址管理
   - 实名认证
   - 优惠券（待开发）
   - 我的收藏（待开发）
   - 设置

4. **快捷入口**
   - 待支付订单
   - 进行中订单
   - 已完成订单

---

## 🛠️ API配置

### 后端API地址

```javascript
// frontend/utils/request.js
const BASE_URL = 'https://catdog.dachaonet.com'
```

### 主要API接口

```javascript
// 认证相关
/api/v1/auth/send-sms         // 发送短信验证码
/api/v1/auth/sms-login        // 短信登录
/api/v1/auth/wechat-login     // 微信登录
/api/v1/auth/login            // 密码登录

// 用户相关
/api/v1/users/me              // 获取用户信息
/api/v1/users/balance         // 获取账户余额

// 项目相关
/api/v1/projects/categories   // 获取分类
/api/v1/projects/list         // 获取项目列表
/api/v1/projects/{id}         // 获取项目详情

// 订单相关
/api/v1/orders/create         // 创建订单
/api/v1/orders/list           // 获取订单列表
/api/v1/orders/{id}           // 获取订单详情
```

---

## 🔍 调试技巧

### 1. 查看网络请求

在微信开发者工具中：
- 打开"调试器"
- 切换到"Network"标签
- 查看API请求和响应

### 2. 查看Storage

```javascript
// 查看token
console.log(uni.getStorageSync('token'))

// 查看用户信息
console.log(uni.getStorageSync('userInfo'))

// 清除缓存
uni.clearStorageSync()
```

### 3. 常见问题

**Q: 微信登录失败？**
A: 
- 确保在微信开发者工具或真机环境
- 检查AppID配置
- 确认后端微信配置正确

**Q: 图片不显示？**
A:
- 检查图片URL是否正确
- 确认域名在合法域名列表中
- 检查网络连接

**Q: 接口调用失败？**
A:
- 确认后端服务已启动
- 检查API地址配置
- 查看Network请求详情
- 检查是否需要登录（token）

---

## 📊 小程序数据流

```
用户操作
   ↓
Vue组件(*.vue)
   ↓
API调用(utils/api.js)
   ↓
请求封装(utils/request.js)
   ↓
后端API(FastAPI)
   ↓
数据库(MySQL)
```

---

## 🎨 小程序特色

### 1. 响应式设计
- 适配各种屏幕尺寸
- 优化的移动端交互

### 2. 优雅的UI
- 清晰的视觉层次
- 流畅的动画效果
- 友好的提示信息

### 3. 完善的状态管理
- Vuex状态管理
- 本地缓存
- 用户登录状态持久化

### 4. 错误处理
- 统一的错误提示
- 网络异常处理
- Token过期自动跳转登录

---

## 📝 开发说明

### 目录结构

```
frontend/
├── pages/              # 主包页面
│   ├── index/         # 首页
│   ├── category/      # 分类
│   ├── login/         # 登录
│   ├── order/         # 订单
│   ├── project/       # 项目详情
│   └── user/          # 个人中心
├── pagesA/            # 分包页面
│   ├── booking/       # 预约
│   ├── order-detail/  # 订单详情
│   ├── address/       # 地址管理
│   ├── certification/ # 实名认证
│   └── payment/       # 支付
├── utils/             # 工具类
│   ├── api.js        # API接口定义
│   └── request.js    # 请求封装
├── store/             # Vuex状态管理
├── static/            # 静态资源
├── App.vue            # 应用入口
├── main.js            # 主入口
├── pages.json         # 页面配置
└── manifest.json      # 应用配置
```

### 添加新页面

1. 在`pages`或`pagesA`目录创建页面文件夹
2. 在`pages.json`中注册页面
3. 在`utils/api.js`中添加API接口（如需要）

### 添加新API

```javascript
// utils/api.js
export default {
  // 添加新接口
  newApi(data) {
    return request.post('/api/v1/new-endpoint', data)
  }
}
```

---

## 🚀 部署发布

### 1. 小程序审核前准备

- [ ] 完善小程序信息
- [ ] 上传Logo和截图
- [ ] 配置服务类目
- [ ] 设置合法域名
- [ ] 完成隐私政策
- [ ] 测试所有功能

### 2. 版本发布

```bash
# 编译生产版本
npm run build:mp-weixin

# 在微信开发者工具中
# 1. 点击"上传"
# 2. 填写版本号和项目备注
# 3. 上传代码
# 4. 在微信公众平台提交审核
```

---

## 🎯 测试清单

### 功能测试

- [ ] 短信登录（新用户自动注册）
- [ ] 密码登录
- [ ] 微信登录
- [ ] 项目浏览和搜索
- [ ] 项目详情查看
- [ ] 在线预约流程
- [ ] 订单列表查看
- [ ] 订单详情查看
- [ ] 地址管理（增删改查）
- [ ] 个人信息查看
- [ ] 退出登录

### 兼容性测试

- [ ] iOS真机测试
- [ ] Android真机测试
- [ ] 微信开发者工具测试
- [ ] 不同网络环境测试

---

## 📞 技术支持

**相关文档**:
- 后端API文档: http://localhost:3000/api/docs
- 完整测试说明: `/完整测试说明.md`
- 快速开始指南: `/快速开始指南.md`

**开发环境**:
- 后端服务: http://localhost:3000
- API基础URL: https://catdog.dachaonet.com
- 小程序AppID: wx2ef4744e64c7bc45

---

## 🎉 总结

✅ **小程序已完成，功能齐全！**

- 🔐 多种登录方式
- 🔬 完整的项目浏览和预约流程
- 📦 订单管理系统
- 👤 个人中心功能
- 💳 支付集成（待完善）

**可以开始使用了！** 🚀

---

*最后更新: 2025-10-19*

