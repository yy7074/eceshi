# 小程序登录测试指南

## 🚀 快速登录步骤

### 1. 确保后端服务运行

```bash
# 检查后端是否运行
lsof -i :3000

# 如果没有运行，启动后端
cd /Users/yy/Documents/GitHub/eceshi/backend
python -m app.main
```

### 2. 打开小程序

在HBuilderX中：
- 点击"运行" → "运行到小程序模拟器" → "微信开发者工具"

### 3. 登录操作

#### 方式一：使用admin账号（推荐）

1. 点击底部"我的"标签
2. 如果未登录，会自动跳转到登录页
3. 选择"密码登录"
4. 输入：
   - 手机号：`admin`
   - 密码：`123456`
5. 点击"登录"

#### 方式二：注册新用户

1. 在登录页选择"验证码登录"
2. 输入手机号（如：`13800138001`）
3. 点击"获取验证码"
4. 查看后端控制台输出的验证码
5. 输入验证码
6. 点击"登录"（会自动注册）

---

## 🔍 验证登录成功

登录成功后，您应该能看到：

1. **个人中心页面**
   - 显示用户头像
   - 显示昵称/手机号
   - 显示余额信息

2. **其他功能正常**
   - 优惠券页面能加载数据
   - 邀请页面能显示统计
   - 订单页面能查看订单

---

## 🐛 常见问题

### 问题1：一直显示401错误

**原因**：没有登录或token过期

**解决**：
1. 清除缓存：在微信开发者工具中点击"清缓存" → "全部清除"
2. 重新登录

### 问题2：获取验证码失败

**原因**：后端服务未启动

**解决**：
```bash
cd /Users/yy/Documents/GitHub/eceshi/backend
python -m app.main
```

### 问题3：登录后还是401

**原因**：API地址配置错误

**检查**：
```javascript
// frontend/utils/request.js
const BASE_URL = 'https://catdog.dachaonet.com'
```

如果要使用本地后端，改为：
```javascript
const BASE_URL = 'http://localhost:3000'
```

---

## 📝 测试用户信息

### 管理员账号
- 手机号：`admin`
- 密码：`123456`
- 权限：超级管理员

### 测试用户（可自行注册）
- 手机号：`13800138001` ~ `13800138009`
- 通过短信验证码登录（自动注册）

---

## 🎯 登录后可测试的功能

### 1. 个人中心
- ✅ 查看用户信息
- ✅ 查看余额
- ✅ 实名认证
- ✅ 地址管理

### 2. 优惠券
- ✅ 查看可领取优惠券
- ✅ 领取优惠券
- ✅ 查看我的优惠券

### 3. 团队功能
- ✅ 创建团队
- ✅ 查看我的团队
- ✅ 邀请成员

### 4. 邀请返利
- ✅ 查看邀请统计
- ✅ 查看邀请记录
- ✅ 申请提现

### 5. 订单管理
- ✅ 创建订单
- ✅ 查看订单列表
- ✅ 查看订单详情

---

## 🔧 调试技巧

### 1. 查看Storage

在微信开发者工具中：
1. 点击"调试器"
2. 选择"Storage"标签
3. 查看是否有`token`和`userInfo`

### 2. 查看Network

1. 点击"Network"标签
2. 查看API请求
3. 检查请求头是否包含`Authorization: Bearer xxx`

### 3. 查看Console

1. 点击"Console"标签
2. 查看是否有错误信息
3. 查看API调用日志

---

## 📞 API地址配置

### 当前配置（生产环境）
```
https://catdog.dachaonet.com
```

### 本地开发配置
如果要使用本地后端，修改 `frontend/utils/request.js`：

```javascript
// 开发环境
const BASE_URL = 'http://localhost:3000'

// 生产环境
// const BASE_URL = 'https://catdog.dachaonet.com'
```

---

## ✅ 登录成功标志

登录成功后，Storage中应该有：

```javascript
{
  "token": "eyJhbGciOiJIUzI1NiIs...",
  "userInfo": {
    "id": 12,
    "phone": "admin",
    "nickname": "管理员",
    "prepaid_balance": 0.00
  }
}
```

所有API请求的Header中应该包含：
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
```

---

## 🎉 总结

1. **确保后端运行**：`python -m app.main`
2. **打开小程序**：HBuilderX运行到微信开发者工具
3. **登录账号**：使用`admin/123456`
4. **测试功能**：优惠券、团队、邀请等功能

登录后，所有401错误都会消失！
