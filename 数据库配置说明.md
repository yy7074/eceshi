# æ•°æ®åº“é…ç½®è¯´æ˜Ž

## å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆ
- æ•°æ®åº“è¿žæŽ¥ä»£ç 
- æ•°æ®åº“æ¨¡åž‹å®šä¹‰
- MySQLå·²å®‰è£…ï¼š`/opt/homebrew/bin/mysql`

### âš ï¸ éœ€è¦é…ç½®
1. é…ç½®çŽ¯å¢ƒå˜é‡ï¼ˆ`.env`ï¼‰
2. åˆ›å»ºæ•°æ®åº“å’Œè¡¨
3. æµ‹è¯•æ•°æ®åº“è¿žæŽ¥

---

## ðŸ”§ å¿«é€Ÿé…ç½®æ­¥éª¤

### æ­¥éª¤1: é…ç½®çŽ¯å¢ƒå˜é‡

```bash
cd backend

# åˆ›å»º .env æ–‡ä»¶
cat > .env << 'EOF'
# åº”ç”¨é…ç½®
APP_NAME=ç§‘ç ”æ£€æµ‹æœåŠ¡å¹³å°
APP_VERSION=1.0.0
DEBUG=True
SECRET_KEY=dev-secret-key-2024

# æœåŠ¡å™¨é…ç½®
HOST=0.0.0.0
PORT=8000

# æ•°æ®åº“é…ç½®ï¼ˆè¯·ä¿®æ”¹å¯†ç ï¼‰
DATABASE_URL=mysql+pymysql://root:YOUR_PASSWORD@localhost:3306/eceshi?charset=utf8mb4
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=20

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# JWTé…ç½®
JWT_SECRET_KEY=jwt-secret-key-2024
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=1440

# CORSé…ç½®
CORS_ORIGINS=http://localhost:3000,http://localhost:8080,http://localhost:8081
EOF

# âš ï¸ é‡è¦ï¼šä¿®æ”¹ DATABASE_URL ä¸­çš„å¯†ç 
# å°† YOUR_PASSWORD æ›¿æ¢ä¸ºæ‚¨çš„MySQLå¯†ç 
nano .env  # æˆ–ä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨
```

### æ­¥éª¤2: åˆå§‹åŒ–æ•°æ®åº“

```bash
cd backend

# å®‰è£…ä¾èµ–ï¼ˆå¦‚æžœè¿˜æœªå®‰è£…ï¼‰
pip install -r requirements.txt

# è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
python init_db.py
```

**æˆåŠŸè¾“å‡ºç¤ºä¾‹**ï¼š
```
ðŸš€ å¼€å§‹åˆå§‹åŒ–æ•°æ®åº“...

ðŸ“¦ æ­¥éª¤1: åˆ›å»ºæ•°æ®åº“
âœ… æ•°æ®åº“ 'eceshi' åˆ›å»ºæˆåŠŸï¼ˆæˆ–å·²å­˜åœ¨ï¼‰

ðŸ“¦ æ­¥éª¤2: åˆ›å»ºæ•°æ®åº“è¡¨
âœ… æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ

ðŸ“‹ å·²åˆ›å»ºçš„è¡¨ï¼š
  - users
  - user_certification

âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼
```

### æ­¥éª¤3: å¯åŠ¨åŽç«¯æœåŠ¡

```bash
# å¯åŠ¨æœåŠ¡
uvicorn app.main:app --reload

# è®¿é—®APIæ–‡æ¡£
# http://localhost:8000/api/docs
```

---

## ðŸ“‹ æ•°æ®åº“è¡¨ç»“æž„

### å·²åˆ›å»ºçš„è¡¨

#### 1. usersï¼ˆç”¨æˆ·è¡¨ï¼‰
| å­—æ®µ | ç±»åž‹ | è¯´æ˜Ž |
|------|------|------|
| id | INT | ä¸»é”® |
| phone | VARCHAR(20) | æ‰‹æœºå·ï¼ˆå”¯ä¸€ï¼‰ |
| password | VARCHAR(255) | å¯†ç å“ˆå¸Œ |
| nickname | VARCHAR(50) | æ˜µç§° |
| avatar | VARCHAR(255) | å¤´åƒURL |
| is_certified | BOOLEAN | æ˜¯å¦å®žåè®¤è¯ |
| membership_level | ENUM | ä¼šå‘˜ç­‰çº§ |
| credit_limit | DECIMAL(10,2) | ä¿¡ç”¨é¢åº¦ |
| prepaid_balance | DECIMAL(10,2) | é¢„ä»˜ä½™é¢ |
| points_balance | INT | ç§¯åˆ†ä½™é¢ |
| total_spent | DECIMAL(10,2) | ç´¯è®¡æ¶ˆè´¹ |
| status | ENUM | ç”¨æˆ·çŠ¶æ€ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | æ›´æ–°æ—¶é—´ |

#### 2. user_certificationï¼ˆç”¨æˆ·è®¤è¯è¡¨ï¼‰
| å­—æ®µ | ç±»åž‹ | è¯´æ˜Ž |
|------|------|------|
| id | INT | ä¸»é”® |
| user_id | INT | ç”¨æˆ·ID |
| enrollment_year | VARCHAR(10) | å…¥å­¦å¹´ä»½ |
| university | VARCHAR(100) | é«˜æ ¡ |
| department | VARCHAR(100) | é™¢ç³» |
| supervisor_name | VARCHAR(50) | å¯¼å¸ˆå§“å |
| status | VARCHAR(20) | å®¡æ ¸çŠ¶æ€ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |
| certified_at | DATETIME | è®¤è¯æ—¶é—´ |

---

## ðŸ” æ•°æ®åº“æ£€æŸ¥å‘½ä»¤

### æ£€æŸ¥æ•°æ®åº“
```bash
mysql -u root -p
```

```sql
-- æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“
SHOW DATABASES;

-- ä½¿ç”¨eceshiæ•°æ®åº“
USE eceshi;

-- æŸ¥çœ‹æ‰€æœ‰è¡¨
SHOW TABLES;

-- æŸ¥çœ‹usersè¡¨ç»“æž„
DESCRIBE users;

-- æŸ¥çœ‹ç”¨æˆ·æ•°æ®
SELECT id, phone, nickname, is_certified, membership_level, created_at FROM users;
```

---

## âŒ å¸¸è§é—®é¢˜

### Q1: æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥
**é”™è¯¯**: `Access denied for user 'root'@'localhost'`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥MySQLå¯†ç 
mysql -u root -p

# å¦‚æžœå¿˜è®°å¯†ç ï¼Œé‡ç½®MySQLå¯†ç 
# Macç³»ç»Ÿï¼š
brew services stop mysql
mysqld_safe --skip-grant-tables &
mysql -u root
```
```sql
ALTER USER 'root'@'localhost' IDENTIFIED BY 'new_password';
FLUSH PRIVILEGES;
```

### Q2: æ— æ³•è¿žæŽ¥åˆ°MySQL
**æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€**:
```bash
# Mac (Homebrew)
brew services list
brew services start mysql

# æ£€æŸ¥ç«¯å£
lsof -i :3306
```

### Q3: å­—ç¬¦ç¼–ç é—®é¢˜
ç¡®ä¿æ•°æ®åº“å’Œè¡¨éƒ½ä½¿ç”¨ `utf8mb4`:
```sql
ALTER DATABASE eceshi CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

---

## ðŸ§ª æµ‹è¯•æ•°æ®åº“è¿žæŽ¥

åˆ›å»ºæµ‹è¯•è„šæœ¬ `test_db.py`:
```python
from app.core.database import engine
from sqlalchemy import text

try:
    with engine.connect() as conn:
        result = conn.execute(text("SELECT 1"))
        print("âœ… æ•°æ®åº“è¿žæŽ¥æˆåŠŸï¼")
        
        result = conn.execute(text("SELECT DATABASE()"))
        db_name = result.scalar()
        print(f"ðŸ“¦ å½“å‰æ•°æ®åº“ï¼š{db_name}")
        
        result = conn.execute(text("SHOW TABLES"))
        tables = [row[0] for row in result]
        print(f"ðŸ“‹ æ•°æ®åº“è¡¨ï¼š{tables}")
except Exception as e:
    print(f"âŒ æ•°æ®åº“è¿žæŽ¥å¤±è´¥ï¼š{e}")
```

è¿è¡Œæµ‹è¯•ï¼š
```bash
cd backend
python test_db.py
```

---

## ðŸ“Š åŽç»­æ•°æ®åº“è¡¨ï¼ˆå¾…åˆ›å»ºï¼‰

æ ¹æ®å¼€å‘è®¡åˆ’ï¼Œè¿˜éœ€è¦åˆ›å»ºä»¥ä¸‹è¡¨ï¼š

### ç¬¬äºŒè¿­ä»£
- ordersï¼ˆè®¢å•è¡¨ï¼‰
- order_samplesï¼ˆè®¢å•æ ·å“è¡¨ï¼‰
- order_feesï¼ˆè®¢å•è´¹ç”¨è¡¨ï¼‰
- paymentsï¼ˆæ”¯ä»˜è®°å½•è¡¨ï¼‰

### ç¬¬ä¸‰è¿­ä»£
- laboratoriesï¼ˆå®žéªŒå®¤è¡¨ï¼‰
- equipmentï¼ˆè®¾å¤‡è¡¨ï¼‰
- test_dataï¼ˆæµ‹è¯•æ•°æ®è¡¨ï¼‰
- test_reportsï¼ˆæµ‹è¯•æŠ¥å‘Šè¡¨ï¼‰

### æ›´å¤šè¡¨
è¯¦è§ï¼š[å¼€å‘è®¡åˆ’.md](../å¼€å‘è®¡åˆ’.md) ç¬¬ä¸‰ç«  æ•°æ®åº“è®¾è®¡

---

## âœ… æ£€æŸ¥æ¸…å•

é…ç½®å®ŒæˆåŽï¼Œè¯·ç¡®è®¤ï¼š

- [ ] MySQLæœåŠ¡å·²å¯åŠ¨
- [ ] `.env` æ–‡ä»¶å·²åˆ›å»ºå¹¶é…ç½®æ­£ç¡®
- [ ] æ•°æ®åº“ `eceshi` å·²åˆ›å»º
- [ ] è¡¨ `users` å’Œ `user_certification` å·²åˆ›å»º
- [ ] åŽç«¯æœåŠ¡å¯ä»¥æ­£å¸¸å¯åŠ¨
- [ ] APIæ–‡æ¡£å¯ä»¥è®¿é—®ï¼ˆhttp://localhost:8000/api/docsï¼‰

---

**å®Œæˆä»¥ä¸Šæ­¥éª¤åŽï¼Œæ•°æ®åº“å°±é…ç½®å¥½äº†ï¼** ðŸŽ‰

